

        OvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvel
        v                                                              v
        e       »OÆW«Â¤O¯f¬r¬ã¨s²ÕÂ´ ²Ä ‘D ´Á Âø»x      P.002          e
        l       [¨¾¬r]                                                 l
        O                                                              O
        v       Â²©öªº±½¬rµ{¦¡?                         Zhugh Jin      v
        e       E-Mail: jiachi.bbs@csie.nctu.edu.tw                    e
        l                                                              l
        OvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvel

        (Dark Killer »¡©ú: ª÷ÂÍ¦b§ë½Z®É TPVO ©|¥¼§ï²Õ¬° OVEL,TP , ¦]¦¹³o
                           ­Ó±½¬rµ{¦¡©Ò¥Îªº Mark ¤´¬° TPVO...)

        °ò¥»¤W... §Ú¬O¤£¼ö¤¤¼g AV ªº... ¥i¬O¤SÄ±±o§Ú­Ì¼g¬rµ¹¤Hªº·PÄ±
        ¬OµL©Ò¨Æ¨Æ, °£¤F¼g¬r¤§¥~¤°»ò¤]¤£·|? ©Î³\¦³¨Ç¯f¬r§@ªÌ¯u±o¦p¦¹
        , ¦ý¨Ã¤£ªí¥Ü©Ò¦³ªº¯f¬r§@ªÌ¤]¦p¦¹¡C¼g¬r¨Ã¤£¬O§Ú­Ìªº±M§Q, ¥ô¦ó
        ¤H³£¥i¥H, ¦P²z¼g¨¾¬rµ{¦¡¤]¤£¬O¨º¨Ç¤½¥q¤~ºâ¥¿²Î! Á¿ÃøÅ¥ÂI, ´N
        ¬O¦]¬°¥L­Ì¦æ¾P¼s§i¦n, ¤£µM¤]¬O¤@µL¥i¨ú¡C¥H¤@¯ë user ªº²´¥ú¨Ó
        ¬Ý! ¥L­Ìª¾¹D¤°»ò¥s§@ CPU «ü¥O¼ÒÀÀ¶Ü? ¤°»ò¬O§ó¦W°lÂÜ¾¹¡B««ª½
        ¼g¤JÀËÅç¡B¦ñÀHÅçÃÒªk? ·d¥X³o¨Ç¦W°ó¸ò¥»´N¬O­n¥L­Ìªº²£«~, Åý¤@
        ¨Ç¤@µL©Òª¾ªº user ²£¥Í¤@ºØ°²¹³... »¡«ü¥O¼ÒÀÀ? ¤]¤£¬O«D±`¦³®Ä
        ²v! »¡§ó¦W°lÂÜ¾¹? ²{¦b»¡¤]¤Ó±ß¤F, ¨ººØ¬r³£¥X²{¦n´X¦~¤F... ¦Ó
        ««ª½¼g¤J¤]¥u¤£¹L¬O¨¾¤îª½±µ I/O ªº¸Ë¹¢«~! ¦Ü©ó¦ñÀH«¬ÅçÃÒªk,¤]
        ¤£¹LµL²z¨ú¾x... ¨þ! ¯º¦º§Ú¤]... ;()

        Ãi±o»¡¬O¨º¤@­ÓµP¤l¤F... ¤Ï¥¿´N¬O¹J¨ì¤£¯à¸Ñªº¬r©Î¤£¯à¨¾ªº¬r,
        ´N»°§Ö§ïª©, ¤]¤£ª¾¹D¯u±o¯à¤£¯à¨¾? ­ü!(¤£­n»¡§Ú»z¿à, ¨Æ¹ê¬O´N
        ¬O¦p¦¹) ÁÈ¿úÁÈ¨ì³oºØ¦a¨B... §¢ÒÛ°Ú!

        ³o°¦¤pµ{¦¡¬O±Mªù¥Î¨Ó±½´y X87ME ©Ò²£¥Íªº½d¨ÒÀÉ (t??.com) ! ©Ò
        ¨Ï¥Îªº¤è¦¡³£¬O«D±`´¶³qªº¥\¯à, ¦p¥Î ah,4eh int 21h¡B ah,4fh
        int 21h µ¥¨Ó·j´M«ü©w­n±½ºËªºÀÉ, ¥Î ah,3dh/3fh/3eh int 21h ¨Ó
        §¹¦¨ÅªÀÉ°Ê§@... §Æ±æ¦U¦ì¡y¦P¦n¡z¯à°÷¦³©Ò»â®©? ³o´N¬O§Ú­n·P¹Ä
        ªº¥Øªº...

;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
;  [X87ME] Scanner By Golden Cicada, 1996.
;          Copyright TPVO , 1996.
;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

        .286
        .model tiny
        .code

        org 0100h

begin:
        cld

        mov si,0082h
        mov di,OFFSET para
search_para:
        lodsb
        cmp al,0dh
        jz search_end
        cmp al,61h
        jb lower_case
        sub al,20h
lower_case:
        stosb
        jmp search_para
search_end:
        mov ds:filename_addr,di
        xor ax,ax
        stosb

        call print_version

        mov ah,1ah
        mov dx,OFFSET dta
        int 21h

        mov ah,4eh              ; ·j´MÀÉ®×
        xor cx,cx
        mov dx,OFFSET para
        int 21h
        jc path_err
        pushf
find_next_file:
        popf

        call print_filename

        mov ax,3d02h            ; ¶}ÀÉ
        mov dx,OFFSET para
        int 21h
        jc open_err

        xchg ax,bx

        mov ah,3fh              ; ÅªÀÉ
        mov cx,0200h
        mov dx,OFFSET buffer
        int 21h

        push bx

        call chk_is_x87me       ; ©I¥s¬O¤£¬O³Q x87 ·P¬Vªºµ{¦¡

        pop bx
        pushf

        mov ah,3eh
        int 21h

open_err:
        mov ah,4fh              ; ¦A·j´M
        int 21h
        jnc find_next_file

exit:
        popf
        mov ah,09h
        jc exit_a
        mov dx,OFFSET msg_4
exit_a:
        mov dx,OFFSET msg_5
exit_b:
        int 21h
        mov ax,4c00h
        int 21h
path_err:
        mov ah,09h
        mov dx,OFFSET msg_6
        jmp exit_b

chk_is_x87me:
        mov cx,ax
        mov si,OFFSET buffer
cid_l:
        call cid_s
        jc found_x87me_vir
        jcxz found_x87me_vir
        loop cid_l
found_x87me_vir:
        ret
cid_s:
        lodsw
        dec si
        mov dl,ah
        cmp al,80h
        jz cid_a1
        cmp al,82h
        jz cid_a1
        loop cid_s
        clc
        ret
cid_a1:
        and ah,11000000b
        cmp ah,10000000b
        jz cid_a2
        loop cid_s
        clc
        ret
cid_a2:
        and dl,00000111b
cid_b1:
        lodsb
        mov dh,al
        and al,0f8h
        cmp al,040h
        jz cid_b2
        loop cid_b1
        clc
        ret
cid_b2:
        and dh,00000111b
        mov al,dh
        cbw
        mov di,OFFSET reg_tab
        add di,ax
        mov al,ds:[di]
        cmp al,dl
        jnz cid_b1
cid_c1:
        lodsw
        dec si
        cmp al,81h
        jz cid_c2
        loop cid_c1
        clc
        ret
cid_c2:
        cmp ah,0fch
        ja cid_c3
        cmp ah,0fbh
        jnz cid_c1
cid_c3:
        and ah,00000111b
        cmp ah,dh
        jnz cid_c1

        mov ah,09h
        mov dx,OFFSET msg_3
        int 21h
        stc
        ret

reg_tab db 1000b ; ax
        db 1000b ; cx
        db 1000b ; dx
        db 111b ; bx
        db 1000b ; sp
        db 110b ; bp
        db 100b ; si
        db 101b ; di

print_version:
        mov ah,09h
        mov dx,OFFSET msg_ver
        int 21h
        ret

print_filename:
        mov ah,09h
        mov dx,OFFSET msg_1
        int 21h

        mov si,OFFSET dta+1eh
        mov di,ds:filename_addr
path_end?:
        cmp di,OFFSET para
        jz path_end
        cmp byte ptr ds:[di-01h],'\'
        jz path_end
        dec di
        jmp path_end?
path_end:
        mov dx,OFFSET para
        mov cx,12
not_eon:
        lodsb
        or al,al
        jz eon
        stosb
        loop not_eon
eon:
        mov al,'$'
        stosb
        mov ah,09h
        int 21h

        mov ah,09h
        mov dx,OFFSET msg_2
        int 21h
        ret

print_x87me_vir:
        mov ah,09h
        mov dx,OFFSET msg_3
        int 21h
        ret

msg_ver db 0dh,0ah
        db 'ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»',0dh,0ah
        db 'º    TPVO Scanner  v1.0     By Golden Cicada, 1996.    º',0dh,0ah
        db 'ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼',0dh,0ah
        db 0dh,0ah,'$'

msg_1   db 0dh,'Scanning file [ ','$'
msg_2   db ' ] ... ','$'
msg_3   db 'Found [X87ME] virus!!!',0dh,0ah,'$'
msg_4   db 0dh,78 dup(20h)
msg_5   db 0dh,0ah,'$'
msg_6   db ' Usage : ',0dh,0ah
        db '            C:\> scn c:\*.* ',0dh,0ah
        db '            C:\> scn c:\dos6\*.* ',0dh,0ah,'$'

filename_addr dw ?
file_size dw ?

para    db 80h dup(00h)
dta     db 80h dup(00h)

buffer:

        end begin

