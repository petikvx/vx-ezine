
                                                                     P.003

         TpVOtPVoTpvOTpVOtpVoTPvOTPVOtpVOTPvOtPVOtPVOtPvOTPvOTpVoTPVO
         PT                                                        OT
         VP     ¥x ÆW «Â ¤O ¯f ¬r ²Õ Â´   ¯f¬rÂø»x   ²Ä ‘B ´Á      TP
         oV                                                        PV
         TO                Ææ  ¯f ¬r ´î ªÎ °O  Ææ                  Vo
         pT                                                        OT
         VP                    by Dark Slayer                      VP
         OV                                                        OV
         OVTPVoTpvOtPvoTPVOtPvoTpVotpvoTpVotpvOtPvoTpVOtpvOTPvOTpvOTP


           ¬Ý¨ì³o­Ó¼ÐÃD¤]³\§A·|·P¨ì°g´b¡A¬°¤°»ò­nÀ°¯f¬r´îªÎ¡S«ç»òÀ°¯f¬r
       ´îªÎ¡S¦]¬°¶Vºë¤pªº¬r¶V¤£®e©ö³Qµo²{¡A¨º¨Çµu¤pºë®«ªº¬rÁ`¬O«Ü°g¤Hªº
       ¡A´î¤Ö¯f¬rªº size¡A¦³³\¦h¦n³B¡A¦p¡R´î¤Ö°O¾ÐÅé»PºÏºÐªÅ¶¡ªº¦û¥Î¶q
       ¡A¬Û¹ïªº¡A¤]´îµu¤F¦bºÏºÐÅª¼g®É©Ò»Ýªº®É¶¡¡A©Ò¥H... §Ú­Ìªº¥Øªº´N¬O
      ¡y¥H§ó¤pªº size ¼g¥X¥\¯à¬Û¦Pªº¬r¡z¡C

       ©³¤U´N¬O¼g¥X§ó¤pªº¬r©Ò­nª`·Nªº¡R

        1. ¦pªG al/ax ¦³¡uªÅ¡vªº¸Ü¡A´N¾¨¶q¨Ï¥Î¥¦¡T
           ¦³¼g¹LÅÜÅé¤ÞÀºªº¤H¤@©wÁA¸Ñ¡A¦b 80x86 ªº«ü¥O¶°¸Ì¡A¹³¡R

             05 34 12   add ax,1234h
             2c 10      sub al,10h
             35 78 56   xor ax,5678h

           ¤§Ãþªº«ü¥O¡A¤ñ¹ï¨ä¥¦¼È¦s¾¹°µ¬Û¦Pªº¹Bºâ©Ò²£¥Í¥X¨Óªºµ{¦¡½X¤p¡C

        2. ¦pªG¬O mov reg,ax ©Î mov ax,reg¡A¨Ã¥B mov ¤§«á¡A¨Ó·½¹Bºâ¤¸ªº
           ­È´N¤£¦A¨Ï¥Î¤F¡A¨º»ò§ï¦¨ xchg reg,ax ·|§ó¦n¡T

           ¦p¡R¦b¶}ÀÉ®É...
             mov ax,3dxxh
             int 21h
             xchg bx,ax        ; §â handle ¶Çµ¹ bx¡A¥Î xchg ¤ñ¥Î mov ¤p

        3. ¦pªG¬O mov reg,bx/bp/si/di¡Aadd reg,xxxx¡A¨º­Ë¤£¦p¨Ï¥Î...
           lea reg,[bx/bp/si/di+xxxx]

           ¦p¡Rmov cx,si
               add cx,9876h
               = lea cx,[si+9876h]¡A¦ý¬O¨Ï¥Î lea ¸û¤p¡C

        4. ¨úª½±µ¦ì§}µ¹¼È¦s¾¹®É¡A¥Î mov reg,offset ¡A¦Ó¤£¥Î lea reg,¡T

           ¦p¡R¨Ï¥Î mov bx,offset var1 ¤ñ lea bx,ds:var1 Àu¡C

        5. ¹ï¼È¦s¾¹¥[/´î 1¡ã2 ®É¡A±Ä¥Î inc/dec ¦Ó¤£­n¥Î add/sub¡A¦Ó¹ï°O
           ¾ÐÅé¦Ó¨¥¡A«h¬O¦b¥[/´î 1 ®É¡A±Ä¥Î inc/dec¡A¬Æ¦Ü¹ï si/di ¥[/´î
           1¡ã4 ®É¡A¥Î lodsb/w¡Bscasb/w ¨Ó¹ï si/di ¥[/´î¡A¦ý¬O­n¦Ò¼{¨ì
           ¤è¦VºX¼Ð©M al/ax ¬O§_¯à§ïÅÜ (¦b¨Ï¥Î lodsb/w ®É)¡C

           ¦p¡R­n¹ï di ¥[ 3¡A¥i¥H¥Î scasw scasb (½T©w¬O¦b cld ªºª¬ªp¤U)
               ¡AÁöµM¦³¨â¹D«ü¥O¡A¦ý¬O«o¤ñ¤@¹D«ü¥O add di,3 ¤p¡T

        6. ¦pªG¤@­Ó­È¤£»Ý­nªø¤[ªº«O¦s¤U¨Ó¡A¦Ó¥u¬O¼È®Éªº«O¦s/¨ú¥X¡A¨º»ò
           ¤£»Ý­n¦b°O¾ÐÅé¤º¦h³]¤@­ÓÅÜ¼Æ¨Ó«O¦s/¨ú¥X¡A¥u»Ý¥Î push/pop §Y
           ¥i¡C

           ¦p¡R¦b·P¬VÀÉ®×¤§«e¡A©Ò­n°µªº ¨ú±oÄÝ©Ê -> «O¦s¦¹ÄÝ©Ê -> ³]ÄÝ
               ©Ê¬°¥iÅª¼g -> ·P¬V -> ¨ú¥X­ìÄÝ©Ê -> ³]¦^

                 mov ax,4300h
                 int 21h
                 push cx                  ; *
                 mov ax,4301h
                 xor cx,cx
                 int 21h
                    .
                    .  (·P¬VÀÉ®×)
                    .
                 pop cx                   ; *
                 mov ax,4301h
                 int 21h

        7. ­n±N¤@­Ó¼È¦s¾¹³]¬° 0 ®É¡A¥Î xor/sub reg,reg ¤ñ mov reg,0 ¦n¡T
           ¦pªG­n±N ax ³]¬° 0¡A¥B§A¤S½T©w al = 0¡A«h¥Î cbw¡A©Î¬O¥u­nÅý
           ah = 0 ´N¦n¡A«h­n½T©w al <= 7fh §_«h·|¨Ï ah = 0ffh¡A¦P¼Ëªº¹D
           ²z... ·QÅý dx = 0¡A«h¥Î cwd¡T

           ¦p¡RÅýÀÉ®×Åª¼g«ü¼Ð²¾¨ìÀÉ§À...
                 mov ax,4202h     ; ax = 4202h <= 7fffh
                 xor cx,cx        ; cx = 0
                 cwd              ; dx = 0
                 int 21h

        8. ¾¨¶q¥R¥÷ªº§Q¥Î¼È¦s¾¹¡A¦Ó¤Ö¥Î°O¾ÐÅéÅÜ¼Æ¡A³q±`¹ï°O¾ÐÅé¹Bºâªº«ü
           ¥O·|¤ñ¹ï¼È¦s¾¹¹Bºâªº«ü¥O­n¨Óªº¤p¡T

        9. ¦³¤@ÂI§ÚÄ±±o«Ü©_©Ç¡A¬Y¨Ç¤H·|¦³¤@ºØ²ßºD¡A¨º´N¬O¦b... ±N°O¾ÐÅé
           ÅÜ¼Æªº­È·hµ¹°Ï¬q¼È¦s¾¹®É¡A·|¥Î...

             mov ax,ds:memory
             mov ds,ax

           ·|¤°»ò¤£ª½±µ¥Î³o­Ó«ü¥O©O¡S

             mov ds,ds:memory

           ¥i¯à¥L»{¬°­n§ïÅÜ ds ªº¦P®É¤S±q ds ªº°Ï¬q¤º¨ú¥X¸ê®Æ·|µo¥Í¿ù»~
           ¡A¦ý¬O³o¼Ëªº¦Ò¼{¬O¦h¾lªº¡T

           ·QÅý¤@­Ó°Ï¬q¼È¦s¾¹ªº­È·h¨ì¥t¤@­Ó°Ï¬q¼È¦s¾¹¡A¥Î push seg_reg2
           pop seg_reg1 §Y¥i¡C

           ¦p¡R­nÅý ds = cs «h¥Î...

                 push cs
                 pop  ds

               ¦Ó¤£­n¥Î...

                 mov ax,cs
                 mov ds,ax

        10.¦s¨úÅÜ¼Æ®É¾¨¶q¥Î ds ·í°Ï¬q¡A¦Ó¤£¥Î cs es ss¡T

           ¦p¡R mov ax,cs:memory

               ³Ì¦n¥Î...

                mov ax,ds:memory        ; ¦b ds = cs ®É

        11.¨ú double word ®É¥Î lseg¡T

           ¦p¡R mov ax,ds:memory
                mov dx,ds:memory[2]

               ³Ì¦n¥Î...

                les ax,ds:memory ; ¦b es ­ÈµL¥Îªº±¡ªp¤U¡A©Ò¥H¥i¥ô·N§ïÅÜ
                mov dx,es

        12.¦b rep xxxsb/xxxsw ©Î loop °j°é¤§«á¡Acx = 0 ³oÂI¥iµ½¥[§Q¥Î¡A
           ¬Ù±¼¤@­Ó±N¼È¦s¾¹³]¬° 0 ªº°Ê§@¡C

           ¦p¡R rep movsb       ; ±N¬r·h¨ì°ª°O¾ÐÅé°Ï¤§«á
                mov ds,cx       ; §Q¥Î cx ¨Ï ds = 0
                                ; ds = 0 (¤¤Â_¦V¶qªí)¡AµM«áÄd¤¤Â_

        13.­n±N¼È¦s¾¹­¼/°£ 2 ªº n ¦¸¤è®É¡A¥Î shl/shr ¤ñ div/mul ¦n¡T

           ¦p¡R­n±N ax ­¼ 2¡A«h...

                 shl ax,1

               ¦Ó¤£­n¥Î...

                 mov bx,2
                 mul bx

        14.§ïÅÜ«ü¥O¥»¨­¡A¦ý¬O¦pªG³Q§ïÅÜªº«ü¥O¦b´X¹D«ü¥O«á´N·|³Q°õ¦æªº¸Ü
           ¡A«h­n¦Ò¼{¨ì cpu ·|¹w´£«ü¥Oªº°ÝÃD¡A¥¦ÁöµM¬O anti-trace ªº¤è¡@
           ¤u¨ã¡A¦ý¬O¦³®É¥ç¬O²£¥Í bugs ªº­ì¦](¦b pentium ¤W¦³«ü¥O¾n¦C¦^
           ¦sªº¥\¯à¡A©Ò¥H¨S¦³³o­Ó°ÝÃD¡A¦ý¬O¬Û¹ïªº¡A¤]¤£¯à¦A¨Ï¥Î³o­Ó¤èªk
           ¨Ó anti-trace ¤F¡T)

           ¦p¡R   mov memory,ax
                       .
                       .
                  mov ax,memory

                ¸û¦nªº¼gªk¬O...

                  mov memory,ax
                       .
                       .
                         db 0b8h   ; 0b8h = mov ax,xxxx ªº opcode
                  memory dw ?

                ©Î...

                  mov memory,ax
                       .
                       .
                  mov ax,0
                  org $-2
                  memory dw ?

                ¥ç¥i...

                ¨Ï¥Î¨ì jmp dword ptr xxxx¡A¦p¦b¯f¬rªº int 21h ¤º¡A·í¯f¬r
                ­n jmp far ¨ì dos ªº int 21h ®É¡A¥i¥H¥Î...

                  jmp dword ptr cs:dos21

                ¦ý¬O¸û¦nªº¼gªk¬O

                        db 0eah ; jmp xxxx:xxxx ªº opcode
                  dos21 dd ?

        15.¦pªG¤@¬qµ{¦¡½X¨Ï¥Î¦b«Ü¦h¦a¤è¡A«h±N¥¦¼gµ{°Æµ{¦¡¡A­n¨Ï¥Î®É...
           «h¥Î call ¨Ó©I¥s (¦ý¬O¨Ã¤£¬Oµ´¹ïªº¡A¦³¥i¯à³o¬qµ{¦¡½X¤Óµu¡A©Ò
           ¥H¼g¦¨µ{°Æµ{¦¡¤Ï¦Ó¤£¦Eºâ¡A¤@¯ë¨ÓÁ¿¡A¦pªG¤j©ó 4 bytes ¥H¤W¡A¨Ã
           ¥B¦b³\¦h¦a¤è³£¥Î¨ì¡A«h¥i¼g¦¨°Æµ{¦¡)

        16.±Ä¥Î tasm ¨Ó½sÄ¶¡C¥Ñ©ó tasm ¦³ multiple passes (tasm ¥[ /m °Ñ
           ¼Æ)¡A¨Ã¥Bµ{¦¡½X³Ì¨Î¤Æ¡A©Ò¥H«Ø·N§A¨Ï¥Î tasm¡C

           ¤W­±¼gªº´N¬O±Nµ{¦¡ÁY¤pªº°ò¥»·§©À¡A¦ý¬O³o¨Ç·§©À¨Ã¤£¬Oµ´¹ïªº¡A
       ¥i¯à¦b¬Y­Ó±¡ªp¤U¡A¥Î§Oªº¤èªk·|§ó¦n¡A³o§¹¥þ­n¾a§A­Ó¤HªºÀ³¥Î¤F¡A¨Æ
       ¹ê¤WÁÙ¦³³\¦hªF¦è­n¾a§A¦Û¤v¥h±´¯Á¡A³z¹L¹ï 80x86 «ü¥O½s½X®æ¦¡ªº²`
       ¤JÁA¸Ñ¡A¤~¯à¼g¥X¸û¤pªºµ{¦¡¡A¥h¼g´X­Ó¦h§Îµ{¦¡¡A´N¥i¥HÁA¸Ñ 80x86
       ªº«ü¥O®æ¦¡¤F¡C

           ¦b³Ì¤p¤Æ§Aªºµ{¦¡½X¤§«e¡A³Ì¦n±N­ì©lµ{¦¡¥ý³Æ¥÷¡A¦]¬°©Î³\­×§ï«á
       ªºµ{¦¡¨Ã¤£¤ñ­ì¨Óªº¤p¡C·í§AÃhºÃ¥H¬Y­Ó«ü¥O¨ú¥N­ì¥ýªº«ü¥O¥i¯à·|¤ñ¸û
       ¤p¡A¦ý¬O§A¨Ã¤£½T©w¡A«hÀ³¸Ó¥Î debug ¿é¤J«ü¥O¡A¦A¤ñ¸û¬Ý¥Î¨º­Ó¦n¡C

           ³q±`¤ñ¸û¤jªº¬r¯à¤O¬O¤ñ¸û±jªº¡A¦ý¬O size ¸û¤j¡A¬Û¤Ïªº¡A¤p¬r¯à
       ¤O®z¡A¦ý¬O size ¤p¡A¦Ó¦p¦ó¦b¯à¤O»P size ¤§¶¡¨ú±o¤@­Ó¾A·íªºÂI¡A«h
       ¬Ý§A¦Û¤vÅo¡T

                                                                 - DS -

