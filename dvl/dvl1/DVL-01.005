Magazine "Duke's Virus Labs"          Number 01          File 005
 ▄▄▄▄▄▄  ▄▄▄▄▄    ▄       ▄  ▄▄▄                  ▄▄▄▄▄   ▄▄▄▄▄▄
          █  ▀█▄  █       █   █          █  █       █
 ▀▀▀▀▀▀   █    █  ▀█     █▀   █        ▀▀█▀▀█▀▀     █     ▀▀▀▀▀▀
 ▄▄▄▄▄▄   █    █   ██   ██    █        ▄▄█▄▄█▄▄     █     ▄▄▄▄▄▄
          █  ▄█▀    █▄ ▄█     █    ▄█    █  █       █
 ▀▀▀▀▀▀  ▀▀▀▀▀       ▀▀▀     ▀▀▀▀▀▀▀              ▀▀▀▀▀   ▀▀▀▀▀▀

                 Небольшое пособие по ANSI-бомбам
                        (c) by Duke/SMF

Содержание:

1. От автора
2. Основная идея ANSI-бомб
3. Коротко об ANSI
4. Переименование клавиш
5. Выполнение DOS-команд
6. Обзор конструкторов ANSI-бомб
7. Защита от ANSI-бомб
8. Библиография

.................................................................

                     1.  О Т   А В Т О Р А

   Ни одного более-менее полного пособия по ANSI-бомбам я не  ви-
дел. Поэтому решил написать эту статью. С командами ANSI  я  зна-
ком не по наслышке - как-никак являюсь автором ANSI-редактора DAR.
   Бомбы используются или для шуток, или для мести, или из  любо-
пытства. Написать бомбу проще, чем написать вирус, тем  более  на
нее антивирусы не реагируют.
.................................................................

                2. ОСНОВНАЯ ДЕЯТЕЛЬНОСТЬ ANSI-БОМБ

   Все, чем занимаются ANSI-бомбы, можно  охарактеризовать  двумя
предложениями:

1) переименование значений клавиш клавиатуры;
2) установка выполнения DOS-команды при нажатии  на  определенную
клавишу.
.................................................................

               3.  К О Р О Т К О   О Б   A N S I

   ANSI предназначены (в первую очередь) для создания цветных ри-
сунков в режиме псевдографики (этим занимаются ANSI-артисты), для
вывода музыки на PC-Speaker (это очень напоминает аналогичный вы-
вод в BASIC'е), перепрограммирования клавиатуры (создания клавиа-
турных макросов) и выполнения DOS-команд.  Выполнение  всех  этих
операций обеспечивается ANSI-драйвером ANSI.SYS,  который  должен
загружаться из файла CONFIG.SYS.
   При редком  использовании  ANSI-команд  загружать  драйвер  не
имеет смысла, можно воспользоваться эмулятором ANSI-драйвера фай-
лом ANSI.COM или просмотрщиком ANSI-графики ANSVIEW (одна из вер-
сий этого просмотрщика написана мной), ACIDVIEW, APV или другим.
   Привожу основные команды ANSI-стандарта.  Строка  "ESC"  заме-
няет в этом файле символ 27h (скан-код клавиши "Escape") - учита-
вайте это при создании ANSI. Везде ниже символ "#"  должен  заме-
няться на соответствующее число.

Перемещение курсора в нужную позицию:

     ESC[#;#H       в строку # столбец #
     ESC[#;#f       в строку # столбец #
     ESC[#A         на # строк вверх
     ESC[#B         на # строк вниз
     ESC[#C         на # символов вперед
     ESC[#D         на # символов назад

Управление курсором:

     ESC[#;#R       сообщается текущая курсорная строка и столбец
     ESC[s          сохраняет текущую позицию курсора для
                    последующего возврата
     ESC[u          возврат на сохраненную позицию курсора

Функции очистки:

     ESC[2J         очистка экрана и установка курсора в верхний
                    левый угол
     ESC[K          очистка символов до конца строки

Графические установки:

     ESC[#;....;#m  установка экранных атрибутов, где # -
                        0 для нормального дисплея (Normal Video)
                        1 жирный шрифт включен (High Video)
                        4 подчеркивание (только mono-режим)
                        5 мигание включено
                        7 негативное изображение включено
                        8 непоказываемое (невидимое) изображение
                        30 черный цвет символов
                        31 красный цвет символов
                        32 зеленый цвет символов
                        33 желтый цвет символов
                        34 синий цвет символов
                        35 пурпурный цвет символов
                        36 цианистый цвет символов
                        37 белый цвет символов
                        40 черный фон
                        41 красный фон
                        42 зеленый фон
                        43 желтый фон
                        44 синий фон
                        45 пурпурный фон
                        46 цианистый фон
                        47 белый фон

     ESC[=#;7h или ESC[=h или ESC[=0h или ESC[?7h
                    установка развертки экрана в указанный режим,
                    где # -
                        0 для 40 x 25 черно-белой графики
                        1 для 40 x 25 цветной графики
                        2 для 80 x 25 черно-белой графики
                        3 для 80 x 25 цветной графики
                        4 для 320 x 200 цветной графики
                        5 для 320 x 200 черно-белой графики
                        6 для 640 x 200 черно-белой графики
                        7 для поворота в конце строки

     ESC[=#;7l или ESC[=l или ESC[=0l или ESC[?7l
                    восстанавливает развертку # , переустановлен-
                    ную предыдущей командой

Перепрограммирование клавиатуры:

     ESC[#;#;...p
     ESC["string"p
     ESC[#;"string";#;#;"string";#p
                    Это различные клавиатурные переназначения.
                    Первый ASCII код определяет, какой символ
                    будет изменен.
                    Остальные коды определяют, на что изменяем.

Музыка:
   Все музыкальные команды начинаются с "M" (Music), в том числе
   MF, MB (Music Background - фоновая музыка), MN, ML, MS, M .
   Общий вид команды: ESC[MF O# T# ..... 0Eh, где
     O#  - октава номер #
     T#  - темп номер #, # - трехзначное число
     0Eh - команда всегда заканчивается символом 0Eh
.................................................................

          4.  П Е Р Е И М Е Н О В А Н И Е   К Л А В И Ш

   Создание ANSI-бомб я объясню на конкретных примерах. После пе-
реименования ANSi-бомбой клавиш при нажатии  на  переопределенную
клавишу в буфере клавиатуры окажется скан-код  совершенно  другой
клавиши. Пользователю нелегко будет разобраться с новой  расклад-
кой клавиатуры. Чтобы все вернулось на свои места достаточно  пе-
резагрузить компьютер.
   Например, переименуем клавиши "Q" и "q" в "A" и  "a"  соответ-
ственно, и наоборот. Для этого достаточно записать следующую пос-
ледовательность команд:

     ESC[65;81p     ("A" переименовывается в "Q")
     ESC[97;113p    ("a" переименовывается в "q")
     ESC[81;65p     ("Q" переименовывается в "A")
     ESC[113;97p    ("q" переименовывается в "a")

   Кроме переименования одного символа  на  другой  символ  можно
провести переименование символа на  последовательность  символов.
При нажатии на переименованную клавишу будет выводиться строка. В
качестве примера приведу ANSI-бомбу под названием "FUCKYOU".  Она
выводит на экран слова "FUCK  YOU"  всякий  раз,  когда  нажимают
"ENTER" или "SPACE". Вот эта бомба:

[32;32;70;85;67;75;32;89;79;85;33;94;71;94;71;32;32;70;85;67;75;
32;89;79;85;33;7;7;32p[13;32;70;85;67;75;32;89;79;85;33;94;71;
94;71;32;32;70;85;67;75;32;89;79;85;33;7;7;32p

   Сразу же хочу дать полезный совет. Не на каждом компьютере ус-
тановлен драйвер ANSI. Некоторые люди (и я в том числе) предпочи-
тают просматривать ANS-файлы с помощью просмотрщиков. В этом слу-
чае при просмотре бомбы не экран будут выведены "странные" коман-
ды  ANSI-бомбы,  незнакомые  простому  просмотрщику.    Появление
"странных" строк может показаться подозрительным пользователю, он
уничтожит файл с бомбой, бомба не получит  распространения  и  не
выполнит возложенных на нее функций. Поэтому не принебрегайте ко-
мандой

     ESC[2J

Укажите  ее  после  "странных" строк, и если файл просматривается
просмотрщиком, то эта команда сотрет "странные" строки с экрана.
   В связи с этим советом дам еще один - не распространяйте "чис-
тую" бомбу, а лучше поместите ее в  ANS-файл  с  картинкой.  Этот
трюк скроет бомбу от посторонних глаз, к томуже ANS-файл,  ничего
не выводящий на экран, покажется не менее подозрительным  пользо-
вателю, чем "странные" строки. Самой правильной композицией  фай-
ла-бомбы будет следующая:

     <команды ANSI-бомбы>
     ESC[2J
     <команды ANSI-картинки>

.................................................................

         5.  В Ы П О Л Н Е Н И Е   D O S - К О М А Н Д

   Выполнение DOS-команд производится  аналогично  переименовыва-
нию клавиш.
   Например, переназначим клавишу "F10"  на  команду  "DIR".  Эту
операцию осуществляет команда

     ESC[0;68;"dir";13p

В этой команде "0;68" - расширенный ASCII код для клавиши "F10" и
"13" - ASCII код для возврата каретки (код клавиши "Enter").  Ко-
ды некоторых других клавиш:

        "F1" = 59           "F6" = 64
        "F2" = 60           "F7" = 65
        "F3" = 61           "F8" = 66
        "F4" = 62           "F9" = 67
        "F5" = 63           "F10"= 68

   При использовании подобных команд следует учитывать,  что  ко-
манда должна выполняться независимо от текущей  директории.  Если
вы не уверены, что на компьютере существует некая директория,  то
не стоит использовать ее при указании пути к файлу. Не забывайте,
что некоторых файлов (format.com, debug.exe и т.д.) может не ока-
заться в каталогах переменной PATH.
   После запуска команды "format c:" или "del *.*" появится сооб-
щение и потребуется ответить Yes/No, поэтому  нужно  использовать
команды "echo Y|format c: >nul" или "echo Y|del *.* >nul".  Более
подробно  о  командах  DOS  читайте  в  "BAT  virii  tutorial  by
Duke/SMF".
.................................................................

  6.  О Б З О Р   К О Н С Т Р У К Т О Р О В   A N S I - Б О М Б

   В моем распоряжении оказалось три довольно старых конструктора
ANSI-бомб. Ни один из них не заслуживает высокой оценки, но о су-
ществовании таких конструкторов я вам расскажу.
   1) THE ANSI BOMB KIT  1.1  by dArK kNiGHt
Размер исполнимого файла 48708 байт. Самый  свежий  из  имеющихся
конструкторов. Этот конструктор позволяет добавить  бомбу  к  уже
существующему файлу. Созданный с его помощью бомбы могут лишь пе-
реименовывать клавиши. Прост в работе.
   2) ANSI Bomb Generator  2.00  by The Attitude Adjuster
Размер исполнимого файла 69344 байт. Датирован 7.11.91.  По  сло-
вам автора, предназначен для помощи в сломе  BBS.  Слишком  много
внимания автор уделил дизайну программы.  Возможно  инфицирование
файлов.  Позволяет  просмотреть  созданную  бомбу.   Хорош    для
ANSI-специалистов,  т.к.  в  нем  предусмотрена  опция  самостоя-
тельной работы, своего рода текстовый редактор. Но на мой взгляд,
это излишне - профессионал создаст бомбу и без помощи конструкто-
ра.
   3) AnsiBombMaker  2.00  by LAWS
Размер исполнимого файла 47164 байт. Самая старая разработка, да-
тирована 1991 годом. Помимо переименования клавиш позволяет заме-
нить клавишу на DOS-команду. Я считаю, что  последняя  разработка
окажется более полезной для желающего создать ANSI-бомбу.
   Большие размеры конструкторов можно объяснить только  несовер-
шенством компиляторов в те годы, а вовсе не полезностью программы.
   В этом номере журнала DVL я предлагаю читателям, не имеющим  в
своем распоряжении конструкторов, мой конструктор ANSI-бомб  ABCD
(ANSI Bomb Constructor by Duke) v1.0. Подробнее о нем вы  узнаете
из файла dvl-01.009

.................................................................

              7.  З А Щ И Т А   О Т   A N S I - Б О М Б

   От ANSI-бомб уберечься довольно  легко.  Ниже  рассматриваются
два способа.
   В  журнале  "TOP  Device"  mOSQUITo  советует    просматривать
ANS-файлы на наличие "странных" команд. Хотелось бы  его  немного
поправить.
   1) ANSI-команды могут содержаться не только в ANS-файлах, но и
      в ЛЮБЫХ других. Например, вирус Ansibomb  (так  его  назвал
      Касперский), поражающий COM-файлы, в надежде  на  загружен-
      ный ANSI-драйвер выводит на экран строку

            ESC[13;13;"ECHO Y|DEL.";13P

      Это не единственный пример использования ANSI-команд  не  в
      ANS-файлах.
   2) Современный art в жанре ANSI велик и многообразен.  Мастер-
      ство некоторых авторов (группы ICE,  ACID)  достигло  своих
      высот. Их творения занимают не один экран (я имею в виду по
      длине) и не один десяток килобайт. Шутнику ничего не  стоит
      спрятать внутри этого файла не просто ANSI-бомбу,  а  целый
      ящик бомб ;)
   3) Что именно подразумевал mOSQUITo под словами "странные  ко-
      манды" ? Может ли начинающий пользователь или  малознакомый
      с ANSI человек отличить "нормальные" команды от "странных"?
      Я думаю, что не сможет.
В свете этих недостатков первого метода считаю его  нереальным  и
не дающим 100% гарантии,  а  посему  его  не  стоит  воспринимать
всерьез.
   Второй метод защиты от ANSI-бомб заключается в отказе  от  ис-
пользования драйвера ANSI.SYS. Не стоит  также  использовать  его
эмулятор ANSI.COM, как  недостаточно  исследованный  на  безопас-
ность. Для просмотра ANS-рисунков советую  использовать  просмот-
рщики ANS-файлов, которые не используют "опасные" команды. К  ним
относится моя программа ANSVIEW.  Из  просмотрщиков  можно  также
назвать APV, ACIDVIEW,.... (к сожалению, я  не  тестировал  их  с
ANSI-бомбами).
   Некоторые программы используют собственные ANSI-драйвера, поэ-
тому второй способ 100% гарантии тоже не дает :( , но он  намного
снизит опасность. Следует так же отметить, что некоторые програм-
мы имеют встроенную защиту (например, RAR).
.................................................................

                   8.  Б И Б Л И О Г Р А Ф И Я

   Если вы желаете прочитать  другие  статьи,  которые  были  ис-
пользованы мной при написании этого руководства,  привожу  список
литературы.

1)  "TOP Device" - Underground Hackers 'Zine!
    Issue 2. December 1997. (c) by DRuG
2)  ASCII ART RESOURCES v4.8  by Glen Robbins, 1994
------------------------< end of file >--------------------------
