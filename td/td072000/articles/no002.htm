<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>news</title>
<base target="_self">
</head>

<body topmargin="0" leftmargin="0" bgcolor="#E7BE7B" link="#CC0000" vlink="#993300" alink="#FF9900">

<Table border="0" cellPadding="0" cellSpacing="0" width="100%">
	<Tr>
		<Td valign="top" height="33">
			<Img src="../images/index_08.gif" width="6" height="33"></Td>
		<Td width="100%" background="../images/index_09.gif" valign="top" height="33">
            <img border="0" src="../images/kolesiko.gif" align="absmiddle" width="21" height="33"><font face="Arial" size="2"><b>Стэк и оптимизация
            </b> - 21:07 - <i>by No</i></font>
            </Td>
		<Td valign="top" height="33">
			<Img src="../images/index_10.gif" width="10" height="33"></Td>
     </Tr>
     <Tr>
		<Td background="../images/index_17.gif">
            &nbsp;</Td>
		<Td width="100%" bgcolor="#E7BE7B">
            <font face="Courier" size="3">
<pre>
Полномерно используя стэк вы можете сократить размер
вируса на хуеву тучу байт. Размер стэка по умолчанию
примерно равен 4м килобайтам. Если учесть что вызовы
процедур используют за всю работу максимум 3-4% от всего
стэка, то не сложно догадаться что остальное место
можно потратить на собственные нужды. Вот дешевенький
примерчик: Вы когда-нибудь задумывались сколько байт занимает
всего лишь один вызов api из переменной.

call    [ebp+offset ThisIsAPI1RVA]

вот такого типа вызов равняется 6!ти байтам! Сделаете 10 вызовов -
будет 60 байт! Не экономно это. Если у вас стэк будет выглядеть
вот типа этого:
[API1],[API2],[API3],[API4],[APIX]
 <------------------------------- возрастание адреса стэка
то вы можете очень нихреново сократить размер вируса.

Пусть в EDI адрес стэка APIX. Тогда
call    [edi+4*api_n-1]         ; это если начинать считать с 1цы
такой вызов занимает 3 байта! + то, что вам не придется выделять
место для адресов внутри вируса(если нихрена не понятно, см. исходник)
хах! 20 адресов - 20 DWORD`ов - 20*4 = 80 байтам!!

Но это еще далеко не все приколы. 4 килобайта даны не зря.
Вы можете их использовать под структуры и какое-либо другое дерьмо.
Вообщем, хороший кодер должен выжимать из стэка все, что можно и
чего нельзя. Если вы думаете типа "да похую на оптимизацию, я же
не на Си пишу" а вот и хуй. Неоптимизированный вирус - признак
вирмэйкерского непрофессионализма. Такие вирусы часто встерчаются
у людей из 29a, вы же не хотите быть такими-же ;)
Вирус и огромный размер - вещи несовместимые, не пытайтесь
доказывать обратное.

Возникает заморочка как бы не потерять ту базу, с которой в стэке
идут API адреса.. а не сложно. держите этот адрес в EDI, и сохраняйте
его в стэк в тех местах, где его будут херить API или другое дерьмо.

Это конечно не все, что можно предпринять в целях оптимизации.
Но при использования такого подхода к делу эффект получается
вполне ощутимый.
</pre>
            </font></Td>
		<Td background="../images/index_19.gif">
            &nbsp;</Td>
	</Tr>
	<Tr>
		<Td>
			<Img src="../images/index_44.gif" width="6" height="9"></Td>
		<Td background="../images/index_45.gif" height="9">
            <img border="0" src="../images/spacer.gif" width="9" height="9"></Td>
		<Td>
			<Img src="../images/index_46.gif" width="10" height="9"></Td>
	</Tr>
</Table>
<br>

</Table>
&nbsp;

</body>

</html>
