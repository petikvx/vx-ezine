<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=windows-1251">
<meta name="GENERATOR" content="Microsoft FrontPage Express 2.0">
<title>Top Device</title>
</head>

<body bgcolor="#B1B1B1" text="#000000" topmargin="0"
leftmargin="3">

<p><STYLE> </p>

<p>INPUT { FONT-FAMILY: Tahoma, sans-serif, arial; FONT-SIZE: 8pt
}</p>

<p>SELECT { FONT-FAMILY: Tahoma, sans-serif, arial; FONT-SIZE:
8pt } </p>

<p>OPTION { FONT-FAMILY: Tahoma, sans-serif, arial; FONT-SIZE:
8pt } </p>

<p>TEXTAREA { FONT-FAMILY: Tahoma, sans-serif, arial; FONT-SIZE:
8pt } </p>

<p>FORM { FONT-FAMILY: Tahoma, sans-serif, arial; FONT-SIZE: 8pt
} <br>
BODY { FONT-FAMILY: Tahoma, sans-serif, arial; FONT-SIZE: 8pt } <br>
P { FONT-FAMILY: Tahoma, sans-serif, arial; FONT-SIZE: 8pt }
TABLE { FONT-FAMILY: Tahoma, sans-serif, arial; FONT-SIZE: 8pt
}TR { FONT-FAMILY: Tahoma, sans-serif, arial; FONT-SIZE: 8pt } TD
{ FONT-FAMILY: Tahoma, sans-serif, arial; FONT-SIZE: 10pt
}TEXTAREA { FONT-FAMILY: Tahoma, sans-serif, arial; FONT-SIZE:
8pt } A { COLOR: #005500; TEXT-DECORATION: none }A:hover {
TEXT-DECORATION: underline } A:link { TEXT-DECORATION: none
}A:visited { }text:unknown { FONT-SIZE: 8pt } } </STYLE> </p>

<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td>&nbsp;</td>
        <td valign="top"><div align="center"><center><table
        border="0" cellpadding="0" cellspacing="0" width="100%">
            <tr>
                <td width="100%" bgcolor="#000000"><img
                src="../-.gif" width="1" height="1"></td>
            </tr>
            <tr>
                <td width="100%" bgcolor="#808080"><strong>15.03.2000</strong>
                <font color="#FF0000">DrWeb 4.16 </font><font
                color="#000000">Преобразование
                ознакомительной версии в
                полную</font> [Madd-Maxx]</td>
            </tr>
            <tr>
                <td bgcolor="#000000"><img src="../-.gif"
                width="1" height="1"></td>
            </tr>
            <tr>
                <td><br>
                30 января в свет появилась
                новая версия DrWeb - 4.16.
                Недавно я слил<br>
                его себе и установил на
                винт.<br>
                Запустил, и обнаружил, что
                программа является
                ознакомительной версией и
                без <br>
                регистрационного ключа
                имеет функциональные
                ограничения, в том числе
                одни, <br>
                на мой взгляд, из самых
                важных - проверка архивов,
                включение опции <br>
                &quot;эвристический
                анализ&quot; и лечение
                зараженных объектов, о чем
                в свою очередь <br>
                и предупреждает, выводя
                сообщение при начальной
                загрузке.<p>Вас не
                раздражает вывод подобных
                сообщений, каждый раз при
                новой загрузке ? <br>
                Меня безумно.</p>
                <p>Поэтому я отправился на
                кухню, заварил себе кофе (
                благородный напиток ),<br>
                запасся табаком ( время то
                уже было 2 ночи ) и решил
                подправить прогу и <br>
                включить все и вся.</p>
                <p>Итак, если у вас все
                нужное под рукой,
                приступим.<br>
                А что нам надо :</p>
                <p><font color="#D20000">SoftIce - любой
                версии<br>
                Hiew - тоже любой версии или
                любой другой правщик
                файлов<br>
                WDasm or IDA Pro<br>
                Где найти DrWeb 4.16 :</font><font
                color="#FF0000"> </font><font color="#008000">ftp://ftp.dials.ru</font></p>
                <p>Для начала попробуем
                убрать сообщение об
                ознакомительной версии.<br>
                ( Сразу скажу, что может и
                есть более короткий путь
                для изменения кода, <br>
                но я опишу тот, по которому
                прошел сам ).</p>
                <p>Для этого залезаем в
                отладчик ( Ctl+D ) и ставим
                брекпоинт на сообщение -<br>
                <font color="#0000FF">bpx MessageBoxA<br>
                bpx MessageBoxExA</font></p>
                <p>Запускаем прогу и что мы
                видим? Айс вывалился на &quot;<font
                color="#0000FF">MessageBoxA</font>&quot;. <br>
                F12 - выходим из айса, ok -
                обратно в айс, в вызывающую
                функцию. <br>
                Стираем все брекпоинты - bc *
                и смотрим код. </p>
                <p><font color="#008000">:0044EE74 FF7778 push
                [edi+78]<br>
                :0044EE77 FF7508 push [ebp+08]<br>
                :0044EE7A 50 push eax </font>* Reference To:
                USER32.MessageBoxA, Ord:0195h<br>
                <font color="#008000">:0044EE7B FF1534AA4700 Call
                dword ptr [0047AA34]</font> --------&gt; <font
                color="#D20000">вывод сообщения</font><br>
                <font color="#008000">:0044EE81 891E mov dword
                ptr [esi], ebx<br>
                :0044EE83 837DFC00 cmp dword ptr [ebp-04],
                00000000<br>
                :0044EE87 89450C mov dword ptr [ebp+0C], eax</font></p>
                <p>Ничего интересного,
                кроме каких-то проверок и
                подготовки самого
                сообщения <br>
                для вывода на экран.
                Нажимаем опять F12 и опять
                попадаем в вызывающую <br>
                процедуру.</p>
                <p><font color="#008000">:0044EEBC 8B10 mov edx,
                dword ptr [eax]<br>
                :0044EEBE FF74240C push [esp+0C]<br>
                :0044EEC2 FF9294000000 call dword ptr
                [edx+00000094]</font> ------------&gt; <font
                color="#D20000">процедура,
                описанная выше</font><font
                color="#008000"><br>
                :0044EEC8 C20C00 ret 000C</font> --------&gt; <font
                color="#D20000">сюда возвращается
                айс.</font></p>
                <p>Теперь F10 и снова
                попадаем в вызывающую
                процедуру. </p>
                <p><font color="#008000">:00403ED9 6A30 push
                00000030<br>
                :00403EDB 50 push eax<br>
                :00403EDC E8C9AF0400 call 0044EEAA<br>
                :00403EE1 8D4C2418 lea ecx, dword ptr [esp+18]</font>
                ----------------&gt; <font color="#D20000">сюда
                мы вернулись</font><font
                color="#008000"><br>
                :00403EE5 C684240402000007 mov byte ptr
                [esp+00000204], 07</font></p>
                <p>Опять смотрим код
                чуть-чуть выше места, куда
                нас вернул айс<br>
                И по адресу <font color="#0000FF">00403E82</font><font
                color="#00FF00"> </font>находим
                переход, обходящий
                сообщение:</p>
                <p><font color="#008000">:00403E71 3BF3 cmp esi,
                ebx<br>
                :00403E73 750F jne 00403E84<br>
                :00403E75 A194524700 mov eax, dword ptr
                [00475294]<br>
                :00403E7A 8A8818020000 mov cl, byte ptr
                [eax+00000218]<br>
                :00403E80 84C9 test cl, cl<br>
                :00403E82 746E je 00403EF2</font>
                ------------------&gt; <font color="#D20000">Обходим
                сообщение</font><font color="#FF0000"><br>
                </font><font color="#008000">:00403E84 8D4C2418
                lea ecx, dword ptr [esp+18]<br>
                :00403E88 E825610400 call 00449FB2<br>
                </font></p>
                <p>Но если быть более
                внимательным, то можно
                увидеть, что на 15 байт выше
                есть <br>
                переход, который может нам
                испортить все. Он
                находится по адресу - <font
                color="#0000FF">00403E73</font>.</p>
                <p>Поэтому именно и на него
                мы ставим очередной
                брекпоинт. Загружаем
                заново <br>
                программу и видим, что
                отладчик вывалился на
                нашем брекпоинте. Условие <br>
                перехода - если регистры ESI
                и EBX не равны. Что мы имеем ?
                Флаг ЗЕРО <br>
                опущен, потому-что в EBX - 0 , а
                в ESI - 4. Этот переход все нам
                и портит. <br>
                Поэтому делаем условие не
                выполнимо. Есть 3 варианта :</p>
                <p>1. меняем CMP ESI, EBX на CMP ESI, ESI
                или CMP EBX, EBX<br>
                2. делаем переход на
                следующую строчку ( JNE 00403E84
                меняем на <br>
                JNE 00403E75 ) - что я и сделал<br>
                3. забиваем переход
                командой NOP </p>
                <p>Далее трассируем и видим,
                что по адресу <font color="#0000FF">00403E7A</font>
                в CL копируется 0 и <br>
                условие нужного нам
                перехода положительное.<br>
                Нажимаем F5 и ........
                Сообщение исчезло. Первый
                этап выполнен.<br>
                Но чтобы быть точно
                уверенным, можно и здесь
                поставить безусловный
                переход.<br>
                Продолжаем ...<br>
                Лезим в DrWeb, в настройки, и
                пробуем включить опцию
                скажем <br>
                &quot; Эвристический
                анализ&quot;. </p>
                <p>Ну как вышло ?<br>
                Не хочет он совсем
                включатся ..... :-((<br>
                Опять ставим брекпоинт на <font
                color="#0000FF">MessageBoxA.</font></p>
                <p><font color="#0000FF">bpx MessageBoxA<br>
                bpx MessageBoxExA</font></p>
                <p>F5 - выходим из отладчика и
                снова пробуем включить эту
                опцию. Выскакивает <br>
                айс, --&gt; F12, --&gt; messagebox, --&gt; OK,
                --&gt; мы в айсе, в модуле
                DrWeb32w.exe.<br>
                Все та же функция для
                сообщения ( <font color="#0000FF">0044EE7B</font>
                ), все тот же выход на
                команду <br>
                RET по адресу <font color="#0000FF">0044EEC8
                <br>
                </font>( см. выше ). Еще раз F10 и
                мы выходим в нужные нам
                просторы ...... :-))<br>
                Снова и снова прокручиваем
                чуть-чуть вверх и смотрим
                код. Вот вся процедура <br>
                с момента входа в неё <br>
                </p>
                <p><font color="#008000">:0041A970 A194524700 mov
                eax, dword ptr [00475294]<br>
                :0041A975 56 push esi<br>
                :0041A976 8BF1 mov esi, ecx<br>
                :0041A978 8A8820020000 mov cl, byte ptr
                [eax+00000220]<br>
                :0041A97E 84C9 test cl, cl </font>-----------------------------&gt;
                <font color="#D20000">проверка
                условия перехода</font><font
                color="#008000"><br>
                :0041A980 7521 jne 0041A9A3 </font>---------------------------&gt;
                <font color="#D20000">нужный нам
                переход</font><font color="#FF0000"><br>
                </font><font color="#008000">:0041A982
                8B0D18524700 mov ecx, dword ptr [00475218]<br>
                :0041A988 6A00 push 00000000<br>
                :0041A98A 6A30 push 00000030<br>
                :0041A98C 8B91B4060000 mov edx, dword ptr
                [ecx+000006B4]<br>
                :0041A992 52 push edx<br>
                :0041A993 E812450300 call 0044EEAA</font>
                -----------------&gt; <font color="#D20000">MessageBox
                о недоступной опции</font><font
                color="#FF0000"><br>
                </font><font color="#008000">:0041A998 6A00 push
                00000000<br>
                :0041A99A 8BCE mov ecx, esi<br>
                :0041A99C E8A0E60200 call 00449041<br>
                :0041A9A1 5E pop esi<br>
                :0041A9A2 C3 ret<br>
                </font></p>
                <p>Можно конечно было бы по
                адресу <font color="#0000FF">0041A980</font>
                поставить безусловный
                переход, <br>
                выйти из функции,
                посмотреть результат, и
                изменить еще переход или
                переходы, <br>
                что бы все включилось, но я
                пошел по другому пути. Ведь
                без регистрационного <br>
                ключа очень много опций
                недоступно, поэтому каждая
                может иметь подобный <br>
                участок проверки и вывода
                сообщения. Менять каждую
                долго, хотя здесь кому как <br>
                нравится ......<br>
                Итак, я сделал вот как ....<br>
                По адресу <font color="#0000FF">0041A978</font>
                в регистр CL заносится
                число из стека с адресом <br>
                [eax+00000220] ....<br>
                Ставим брекпоинт на
                строчку - <br>
                <font color="#008000">0041A976 8BF1 mov esi, ecx<br>
                </font>и снова пробуем
                включить опцию ....</p>
                <p>Выскакивает Айс, мы
                делаем шаг на следующую
                строчку ( F10 ) и смотрим <br>
                адрес, из которого
                происходит занос числа в CL.
                Это - <font color="#0000FF">0070F298.<br>
                </font>Адрес этот запомним
                или лучше запишем .... В
                дальнейшем наверняка
                пригодится, <br>
                если придётся ставить
                брекпоинт, на участок
                памяти, по этому адресу ....<br>
                Теперь попробуем узнать,
                где и в каком месте
                программа заносит сюда 0 и
                при <br>
                каких условиях.... <br>
                Для начала
                дизассемблируем файл
                drweb32w.exe и поищем, нет ли еще
                где-то в <br>
                файле строчки - <font color="#0000FF">byte</font>
                <font color="#0000FF">ptr [eax+00000220] </font>и
                не заносится ли где 0 при не
                <br>
                выполнении определенных
                условий....<br>
                Включаем поиск и ищем .....<br>
                Сразу, после первого же
                нажатия, программа
                показывает код :<br>
                <br>
                * Referenced by a (U)nconditional or
                (C)onditional Jump at Address: 00403B3A(C)<br>
                <font color="#008000">:00403CA3 3BF3 cmp esi, ebx<br>
                :00403CA5 7465 je 00403D0C<br>
                :00403CA7 8B1594524700 mov edx, dword ptr
                [00475294]</font> --------&gt;<font
                color="#D20000"> в EDX адрес</font><font
                color="#FF0000"><br>
                </font>:<font color="#008000">00403CAD
                C6821902000000 mov byte ptr [edx+00000219], 00 </font>-------------&gt;
                <font color="#D20000">по адресу из
                EDX+00000219 занести 0</font><font
                color="#FF0000"><br>
                </font><font color="#008000">:00403CB4 A194524700
                mov eax, dword ptr [00475294]</font>
                ---------&gt; <font color="#D20000">снова
                адрес</font><font color="#FF0000"><br>
                </font><font color="#008000">:00403CB9
                C6801A02000000 mov byte ptr [eax+0000021A], 00 </font>----------------&gt;<font
                color="#D20000"> и снова занести 0</font><font
                color="#FF0000"><br>
                </font><font color="#008000">:00403CC0
                8B0D94524700 mov ecx, dword ptr [00475294] </font>-----------&gt;
                <font color="#D20000">и так далее ...</font><font
                color="#FF0000"><br>
                </font><font color="#008000">:00403CC6
                C6811B02000000 mov byte ptr [ecx+0000021B], 00<br>
                :00403CCD 8B1594524700 mov edx, dword ptr
                [00475294]<br>
                :00403CD3 C6821C02000000 mov byte ptr
                [edx+0000021C], 00<br>
                :00403CDA A194524700 mov eax, dword ptr
                [00475294]<br>
                :00403CDF C6801D02000000 mov byte ptr
                [eax+0000021D], 00<br>
                :00403CE6 8B0D94524700 mov ecx, dword ptr
                [00475294]<br>
                :00403CEC C6811E02000000 mov byte ptr
                [ecx+0000021E], 00<br>
                :00403CF3 8B1594524700 mov edx, dword ptr
                [00475294]<br>
                :00403CF9 C6821F02000000 mov byte ptr
                [edx+0000021F], 00<br>
                :00403D00 A194524700 mov eax, dword ptr
                [00475294]<br>
                :00403D05 C6802002000000 mov byte ptr
                [eax+00000220], 00</font> -----------&gt; <font
                color="#D20000">а вот и заносится
                0,<br>
                для дальнейшей проверки на
                опцию &quot;эвристический
                анализ&quot;</font><font color="#FF0000"><br>
                </font><font color="#008000">:00403D05
                C6802002000000 mov byte ptr [eax+00000220], 00<br>
                :00403D0C 8B0D94524700 mov ecx, dword ptr
                [00475294]<br>
                :00403D12 8A8119020000 mov al, byte ptr
                [ecx+00000219]<br>
                :00403D18 84C0 test al, al<br>
                :00403D1A A198454700 mov eax, dword ptr
                [00474598]<br>
                <br>
                </font>Но нам надо
                просмотреть все места,
                поэтому продолжаем поиск
                ... Еще одно место,<br>
                где есть такая строчка -
                адрес - <font color="#0000FF">0041A978</font>.<br>
                Ну как знакомое число ?
                Конечно !!! Это то место, где
                выполняется проверка, и в <br>
                зависимости от результата
                становится доступен или
                нет &quot;эвристический
                анализ&quot;. <br>
                Больше в файле подобных
                мест нет. Если взять любой
                другой адрес, скажем <font
                color="#0000FF"><br>
                00403CEC</font>, то узнаем,
                повторив все выше
                перечисленное, что этот
                адрес отвечает <br>
                за возможность
                &quot;проверки архивов&quot;.<br>
                Итак, место, что все нам
                портит и не дает нормально
                настроить DrWEB найдено.<br>
                Теперь записываем адрес ( <font
                color="#0000FF">00403CAC </font>- на него
                мы поставим брекпоинт ), и <br>
                загружаем drweb32w.exe. Далее,
                как вам угодно, попадите в
                отладчик и <br>
                поставьте брекпоинт на <font
                color="#0000FF">00403CAC</font>.<br>
                Выпав при загрузке drweb32w.exe
                на этом месте, мы увидим,
                что программа не <br>
                переходит на следующей
                строчке по адресу <font
                color="#0000FF">00403D0C, </font>а
                продолжает выполнять <br>
                процедуру, записывая нули
                по знакомым нам уже
                адресам.<br>
                Итак, все, что нам надо
                было, найдено !<br>
                Теперь мы по адресу <font
                color="#0000FF">00403CA5</font> делаем
                безусловный переход (
                забиваем командой <br>
                NOP или меняем на <font
                color="#0000FF">je 00403CA7</font> ) и
                далее каждый 00 меняем на 01.<br>
                Снимаем все брекпоинты (bc *
                ) и запускаем программу
                заново. Лезем в <br>
                настройки и ........... WOW ! Все
                включается и работает на
                все 100%.<br>
                Ну чтож, задача решена !!!<br>
                Запускайте DrWEB 4.16 и
                принимайтесь искать
                какой-нибудь Windows CIH, <br>
                словленный где-то в сети
                ...... :-)) Шутка !!!<br>
                Времени у меня ушло на все
                про все минут 30. Вам думаю
                не больше <br>
                понадобится, если вы хоть
                чуть-чуть знакомы с
                отладчиком.<br>
                Свои отзывы и предложения
                можно присылать на <a
                href="mailto:maxx_inet2@hotmail.com">maxx_inet2@hotmail.com</a></p>
                <p><br>
                Только убедительная
                просьба мусором мыло не
                засорять !!!! <br>
                P.S. Модуль Spider.exe мною не
                изучался, хотя и имеет
                точно такие же <br>
                ограничения без
                регистрационного ключа, в
                силу того, чтобы экономить
                память. <br>
                Вам также не советую
                вешать эту штуку в память
                машины, тем более, если у
                вас <br>
                ее мало. Лучше каждый
                стрёмный файл проверить
                сканером, и его же
                запускать<br>
                скажем раз в неделю на
                проверку всего винта.<br>
                Удачи и весёлого
                времяпровождения !!!<br>
                - Madd Maxx -<br>
                Moscow<br>
                Russia</p>
                </td>
            </tr>
            <tr>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>&nbsp;</td>
            </tr>
        </table>
        </center></div></td>
        <td>&nbsp;</td>
    </tr>
</table>

<p>&nbsp;</p>
</body>
</html>
