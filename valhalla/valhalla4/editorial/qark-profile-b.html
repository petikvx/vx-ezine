<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1252">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice 4.0.0  (Win32)">
	<META NAME="CREATED" CONTENT="0;0">
	<META NAME="CHANGEDBY" CONTENT="The Soul Manager">
	<META NAME="CHANGED" CONTENT="20131027;10545014">
	<STYLE TYPE="text/css">
	<!--
		@page { margin: 2cm }
		PRE { font-family: "Times New Roman", serif }
		A:link { so-language: zxx }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-AU" DIR="LTR">
<a name="top">
<PRE><FONT SIZE=6><B>Virus Writer Profile: Qark</B></FONT>

<FONT SIZE=5>Written by Jpanic.</FONT>

<FONT SIZE=5><U><B>Table of Contents:</B></U></FONT>
        
       <FONT SIZE=5><a href="#about">About Qark.</a></FONT>
       <FONT SIZE=5><a href="#vlad1">VLAD Issue 1 (July 1994).</a></FONT>
       <FONT SIZE=5><a href="#daddy">Virus: Daddy</a></FONT>
       <FONT SIZE=5><a href="#mummy">Virus: Mummy</a></FONT>
       <FONT SIZE=5><a href="#sister">Virus: Sister</a></FONT>
       <FONT SIZE=5><a href="#brother">Virus: Brother</a></FONT>
       <FONT SIZE=5><a href="#vlad2">VLAD Issue 2 (November 1994).</a></FONT>
       <FONT SIZE=5><a href="#vladvirus">Virus: VLAD Virus</a></FONT>
       <FONT SIZE=5><a href="#republic">Virus: Republic</a></FONT>
       <FONT SIZE=5><a href="#bios">Virus: BIOS Meningitis</a></FONT>
       <FONT SIZE=5><a href="#vlad3">VLAD Issue 3 (February 1995).</a></FONT>
       <FONT SIZE=5><a href="#hemlock">Virus: Hemlock</a></FONT>
       <FONT SIZE=5><a href="#megastealth">Virus: Megastealth</a></FONT>
       <FONT SIZE=5><a href="#vlad4">VLAD Issue 4 (April 1995).</a></FONT>
       <FONT SIZE=5><a href="#winsurfer">Virus: Winsurfer</a></FONT>
       <FONT SIZE=5><a href="#goodtimes">Virus: Goodtimes</a></FONT>
       <FONT SIZE=5><a href="#vlad5">VLAD Issue 5 (August 1995).</a></FONT>
       <FONT SIZE=5><a href="#horsa">Virus: Horsa</a></FONT>
       <FONT SIZE=5><a href="#ph33r">Virus: Ph33r</a></FONT>
       <FONT SIZE=5><a href="#vlad6">VLAD Issue 6 (February 1996)</a></FONT>
       <FONT SIZE=5><a href="#vip">VIP (VLAD Infinite Polymorphy)</a></FONT>
       <FONT SIZE=5><a href="#vste">VSTE (VLAD Surface Tracing Engine)</a></FONT>
       <FONT SIZE=5><a href="#gilgamesh">Virus: Gilgamesh</a></FONT>
       <FONT SIZE=5><a href="#tracevir">Virus: Tracevir</a></FONT>
       <FONT SIZE=5><a href="#v386">Virus: 386</a></FONT>
       <FONT SIZE=5><a href="#vladaf">VLAD April Fools Edition (April 1996).</a></FONT>
       <FONT SIZE=5><a href="#systa">Virus: SySta</a></FONT>
       <FONT SIZE=5><a href="#asmvirus">Virus: ASMVirus</a></FONT>
       <FONT SIZE=5><a href="#vlad7">VLAD Issue 7 (October 1996).</a></FONT>
       <FONT SIZE=5><a href="#goodbye">Virus: Goodbye</a></FONT>
       <FONT SIZE=5><a href="#padania">Virus: Padania</a></FONT>
       <FONT SIZE=5><a href="#memorial">Virus: Memorial</a></FONT>
       <FONT SIZE=5><a href="#references">References.</a></FONT>

<a name="about">
<FONT SIZE=5><U><B>% About Qark %</B></U></FONT>

<FONT SIZE=5>Qark was an Australian virus writer and member of the virus writing group</FONT>
<FONT SIZE=5>'VLAD' (Virus Labs And Distribution). Qark seemed to be the most prolific</FONT>
<FONT SIZE=5>member of VLAD with a career spanning 1994 to 1997. Qarks published viruses</FONT>
<FONT SIZE=5>were the Incest family (Mummy, Daddy, Sister, Brother), VLAD Virus, Republic,</FONT>
<FONT SIZE=5>BIOS Meningitis, Hemlock, Megastealth, Winsurfer, Good Times (not the hoax),</FONT>
<FONT SIZE=5>Horsa, Ph33r, Gilgamesh, Tracevir, Padania, Goodbye, SySta, ASMVirus and</FONT>
<FONT SIZE=5>Win95.Memorial (co-authored with Quantum). Qark was also the author of the VIP</FONT>
<FONT SIZE=5>(VLAD Infinite Polymorphy) engine and VSTE (VLAD Surface Tunnelling Engine).</FONT>
<FONT SIZE=5>All of Qarks viruses, except Win95.Memorial, were published in VLAD magazine.</FONT>
<FONT SIZE=5>[1]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="vlad1">
<FONT SIZE=5><U><B>% VLAD Issue 1 %</B></U></FONT>

<FONT SIZE=5>In July 1994, VLAD Issue 1 came out, including four viruses by Qark - namely</FONT>
<FONT SIZE=5>the 'Incest' family. All four members of this family (Mummy, Daddy, Sister,</FONT>
<FONT SIZE=5>Brother) cooperated by sharing the original INT 21h vector. If one member of</FONT>
<FONT SIZE=5>this family attempted to go memory-resident when another member was already</FONT>
<FONT SIZE=5>loaded, the already loaded member would pass the original INT 21h vector on to</FONT>
<FONT SIZE=5>the member attempting to go resident. [2]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="daddy">
<FONT SIZE=5><U><B>% Virus: Daddy %</B></U></FONT>

<FONT SIZE=5>'Daddy' was a memory resident infecter of MS-DOS .COM and .EXE files,</FONT>
<FONT SIZE=5>including command.com. Daddy's features included encryption targeted against</FONT>
<FONT SIZE=5>certain anti-virus products, deletion of anti-virus checksum databases and</FONT>
<FONT SIZE=5>directory stealth. Daddy goes memory resident by reducing the size of MCB</FONT>
<FONT SIZE=5>(Memory Control Block) of the host if this is the last MCB in the chain. Daddy</FONT>
<FONT SIZE=5>then creates its own MCB with owner field set to 0x0008 - command.com and</FONT>
<FONT SIZE=5>hooks the INT 21h vector directly. Daddy's decrypter plays a trick with the</FONT>
<FONT SIZE=5>CPU prefetch to hamper debugging, as well as F-PROT anti-virus and TBCLEAN</FONT>
<FONT SIZE=5>(generic disinfection utility included with Thunder-Byte Anti-Virus). Daddy</FONT>
<FONT SIZE=5>infects files when they are executed or opened, or when their dates or</FONT>
<FONT SIZE=5>attributes are queried. Daddy also executes it directory size stealth on</FONT>
<FONT SIZE=5>FCB findfirst/findnext calls. Daddy uses fairly standard algorithms when</FONT>
<FONT SIZE=5>infecting .COM and .EXE files, and differentiates between these two file</FONT>
<FONT SIZE=5>formats using the file extension The virus seems to only handle upper-case</FONT>
<FONT SIZE=5>extensions. Files were marked as infected by setting the time-stamp value</FONT>
<FONT SIZE=5>equal to the date-stamp Daddy additionally deletes several anti-virus checksum</FONT>
<FONT SIZE=5>databases: 'ANTI-VIR.DAT' (ThunderByte Anti-Virus), 'MSAV.CHK' (Microsoft Anti-</FONT>
<FONT SIZE=5>Virus), 'CHKLIST.CPS' (Central-Point Anti-Virus) and 'CHKLIST.MS (Microsoft</FONT>
<FONT SIZE=5>Anti-Virus). Daddy included the text strings:</FONT>

<FONT SIZE=5><I>[Incest Daddy]</I></FONT>
<FONT SIZE=5><I>by Qark/VLAD</I></FONT>

<FONT SIZE=5>[3]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="mummy">
<FONT SIZE=5><U><B>% Virus: Mummy %</B></U></FONT>

<FONT SIZE=5>'Mummy' was a memory-resident companion infecter - creating an infected .COM</FONT>
<FONT SIZE=5>file containing the virus for every targeted .EXE file. Under MS-DOS if no</FONT>
<FONT SIZE=5>file extension was specified to execute a file, .COM had priority over .EXE.</FONT>
<FONT SIZE=5>These 'infected' .COM files ran the virus, then executed the original .EXE</FONT>
<FONT SIZE=5>file. Mummy first executes the original .EXE file when run and then goes</FONT>
<FONT SIZE=5>resident by directly hooking INT 21h and calling INT 21h, AX=3100h - Terminate</FONT>
<FONT SIZE=5>and Stay Resident. Mummy is encrypted, and also uses a similar prefetch trick</FONT>
<FONT SIZE=5>to the one used by 'Daddy', in an attempt to avoid debugging, F-PROT and </FONT>
<FONT SIZE=5>Thunder-Byte Anti-Virus. Mummy uses an interesting stealth mechanism.</FONT>
<FONT SIZE=5>Companion .COM files are created with the 'hidden' attribute set. When ASCII</FONT>
<FONT SIZE=5>FindFirst is called (INT 21h AH=4Eh) Mummy removes the 'hidden' bit from the</FONT>
<FONT SIZE=5>requested attributes mask so that hidden files are not enumerated. This leads</FONT>
<FONT SIZE=5>to many anti-virus programs not seeing the companion infections. Mummy</FONT>
<FONT SIZE=5>includes the text strings:</FONT>

<FONT SIZE=5><I>[Mummy Incest] by VLAD of Brisbane.</I></FONT>
<FONT SIZE=5><I>Breed baby breed!</I></FONT>

<FONT SIZE=5>[4]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="sister">
<FONT SIZE=5><U><B>% Virus: Sister %</B></U></FONT>

<FONT SIZE=5>'Sister' was a memory-resident encrypted infecter of MS-DOS .EXE files. Sister</FONT>
<FONT SIZE=5>used the same memory allocation method of modifying the MCB's as 'Daddy' (see</FONT>
<FONT SIZE=5>above). Like Daddy, Sister checked files by extension but only seemed to handle</FONT>
<FONT SIZE=5>upper-case extensions. Also like Mummy and Daddy, Sister played the same CPU</FONT>
<FONT SIZE=5>prefetch trick. Once resident, Sister infected files on Execute, Open, Chmod</FONT>
<FONT SIZE=5>and Rename calls. Files were marked as infected by placing a 'magic' value in</FONT>
<FONT SIZE=5>the MZ header. Sister includes the text strings:</FONT>

<FONT SIZE=5><I>[Incest Sister]</I></FONT>
<FONT SIZE=5><I>by VLAD - Brisbane, OZ</I></FONT>

<FONT SIZE=5>[5]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="brother">
<FONT SIZE=5><U><B>% Virus: Brother %</B></U></FONT>

<FONT SIZE=5>'Brother' was a memory-resident encrypted infecter of MS-DOS .COM files,</FONT>
<FONT SIZE=5>including COMMAND.COM. Brother goes resident by reducing the size field of the</FONT>
<FONT SIZE=5>MCB of the host file if it is the last MCB and moving itself to the now</FONT>
<FONT SIZE=5>unallocated space. Once INT 21h is hooked, .COM files are infected on Execute,</FONT>
<FONT SIZE=5>Extended Open, Chmod and Rename calls. Files are marked as infected by setting</FONT>
<FONT SIZE=5>the 'seconds' field of the time-stamp to 62. Like other members of the 'Incest'</FONT>
<FONT SIZE=5>family, Brother checks for file extension but only handles upper-case Brother</FONT>
<FONT SIZE=5>also attempts to delete Central Point Anti-Virus and Microsoft Anti-Virus</FONT>
<FONT SIZE=5>checksum databases (&quot;chklist.cps&quot; and &quot;chklist.ms&quot;). [6]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="vlad2">
<FONT SIZE=5><U><B>% VLAD Issue 2 %</B></U></FONT>

<FONT SIZE=5>In November 1994, VLAD Issue 2 was released. Three viruses were included by</FONT>
<FONT SIZE=5>Qark: 'VLAD Virus', 'Republic' and 'BIOS Meningitis'.</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="vladvirus">
<FONT SIZE=5><U><B>% Virus: VLAD Virus %</B></U></FONT>

<FONT SIZE=5>'VLAD Virus' was a memory-resident, polymorphic and size-stealthing infecter</FONT>
<FONT SIZE=5>of MS-DOS .COM and .EXE files including COMMAND.COM. VLAD Virus goes memory</FONT>
<FONT SIZE=5>resident by reducing size of MCB of the host if it is last MCB in the chain,</FONT>
<FONT SIZE=5>and moves itself into the newly created space. The virus also reduces 16-bit</FONT>
<FONT SIZE=5>WORD at offset 2 of the PSP - Top Of Memory. The virus then hooks INT 21h</FONT>
<FONT SIZE=5>vector directly. VLAD Virus is mildly polymorphic and seems to named 'VIP 0.1'</FONT>
<FONT SIZE=5>(VLAD Infinite Polymorphy) by the author, Qark. VLAD Virus uses a similar CPU</FONT>
<FONT SIZE=5>prefetch trick to the one used in above mentioned viruses. VLAD Virus also has</FONT>
<FONT SIZE=5>some stealth features: on FCB and ASCII FindFirst/FindNext the virus corrects</FONT>
<FONT SIZE=5>returned size field of infected file to original file size. The virus uses an</FONT>
<FONT SIZE=5>interesting infection marker. That is, lower five bits of low order byte of</FONT>
<FONT SIZE=5>the infected files time-stamp is set to lower five bits of high order byte of</FONT>
<FONT SIZE=5>the infected files time-stamp Like other viruses by Qark, VLAD virus checks</FONT>
<FONT SIZE=5>for .COM or .EXE file extension. This virus now uses INT 21h AH=60h (MS-DOS</FONT>
<FONT SIZE=5>Get Qualified Filename), which among other things converts the filename to</FONT>
<FONT SIZE=5>upper-case Thus this virus does not infect only handle files with upper-case</FONT>
<FONT SIZE=5>extensions like some of the above mentioned viruses. VLAD Virus uses INT 2Fh</FONT>
<FONT SIZE=5>(MS-DOS Multiplex) calls to get the SFT (System File Table) entry for the</FONT>
<FONT SIZE=5>victim file. The virus uses this system structure to bypass some operating</FONT>
<FONT SIZE=5>system calls including lseek, chmod and setting/getting file date/time stamps.</FONT>
<FONT SIZE=5>Use of the SFT also allows for infecting read-only files, without modifying</FONT>
<FONT SIZE=5>the files attributes. VLAD Virus attempts to delete anti-virus checksum</FONT>
<FONT SIZE=5>databases used by Thunder-Byte, Central Point and Microsoft anti-viruses.</FONT>
<FONT SIZE=5>These database files are: 'ANTI-VIR.DAT', 'MSAV.CHK', 'CHKLIST.CPS', and</FONT>
<FONT SIZE=5>'CHKLIST.MS'. When memory-resident, VLAD Virus infects files on execute, open,</FONT>
 <FONT SIZE=5>chmod and rename calls. The virus avoids infecting files beginning with</FONT>
 <FONT SIZE=5>'SCAN', 'TB', 'F-PR' and 'DV.E' as these files may be self-checking. VLAD</FONT>
 <FONT SIZE=5>Virus includes the text strings:</FONT>

<FONT SIZE=5><I>[VLAD virus]</I></FONT>
<FONT SIZE=5><I>by VLAD!</I></FONT>
<FONT SIZE=5><I>[VIP v0.01]</I></FONT>

<FONT SIZE=5>[7]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="republic">
<FONT SIZE=5><U><B>% Virus: Republic %</B></U></FONT>

<FONT SIZE=5>'Republic' was a memory-resident MS-DOS .COM and .EXE encrypted stealth</FONT>
<FONT SIZE=5>infecter, including COMMAND.COM. Republic shared many features in common with</FONT>
<FONT SIZE=5>the above mentioned 'VLAD Virus'. The infection schemes, memory-residence, CPU</FONT>
<FONT SIZE=5>prefetch trick, use of SFT entries and infection marker are all near</FONT>
<FONT SIZE=5>identical The viruses both use INT 21h AH=60h to create an upper-case full</FONT>
<FONT SIZE=5>pathname for the victim and share the same FCB/ASCII FindFirst/FindNext size</FONT>
<FONT SIZE=5>stealth. The encryption of Republic seems to be mainly aimed at evading TBSCAN</FONT>
<FONT SIZE=5>(Thunder-Byte Anti-Virus). The virus implements a 'stealth' scheme: Files are</FONT>
<FONT SIZE=5>disinfected on 'open' calls and infected on 'close', chmod, exec and rename.</FONT>
<FONT SIZE=5>Republic includes the text strings:</FONT>

<FONT SIZE=5><I>Go the Republic! Fuck off Royal Family!</I></FONT>
<FONT SIZE=5><I>Qark/VLAD of the Republic of Australia</I></FONT>

<FONT SIZE=5>[8]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="bios">
<FONT SIZE=5><U><B>% Virus: BIOS Meningitis %</B></U></FONT>

<FONT SIZE=5>'BIOS Meningitis' was a floppy boot-sector, hard drive MBR and Flash BIOS</FONT>
<FONT SIZE=5>stealth infecter. This virus seems to be the first Flash BIOS infecter but</FONT>
<FONT SIZE=5>according to the source code this feature was never tested. When loading from</FONT>
<FONT SIZE=5>an infected floppy or hard disk the virus goes memory resident - allocating 1k</FONT>
<FONT SIZE=5>of memory by by decreasing the 16-bit WORD at 40h:13h (BIOS Data Area, size of</FONT>
<FONT SIZE=5>conventional memory in kilobytes) and hooking INT 13h (BIOS Disk Services)</FONT>
<FONT SIZE=5>directly in the IVT (interrupt vector table). The INT 13h handler carries out</FONT>
<FONT SIZE=5>both infection and stealth routines. If an attempt is made to read sector 1,</FONT>
<FONT SIZE=5>cylinder 0, head 0 (the first physical sector - MBR or boot sector) action is</FONT>
<FONT SIZE=5>taken. If the disk is uninfected the disk is infected, if the disk is already</FONT>
<FONT SIZE=5>infected stealth takes place. The stealth algorithm simply reads in the</FONT>
<FONT SIZE=5>original sector instead of the infected one, making the disk appear 'clean'</FONT>
<FONT SIZE=5>when the virus is ready in memory. When infecting the hard drive, the original</FONT>
<FONT SIZE=5>MBR sector is stored in physical sector 2 which is normally unused in an</FONT>
<FONT SIZE=5>MS-DOS installation. In the case of floppy disks, sector 14, cylinder 0, head</FONT>
<FONT SIZE=5>1 is used - this is the last directory of the root directory on 5.25 inch</FONT>
<FONT SIZE=5>1.2mb floppies, but will cause corruption on any other type of floppy disk.</FONT>
<FONT SIZE=5>The virus overwrites the partition table of the infected MBR meaning that</FONT>
<FONT SIZE=5>booting from an uninfected floppy or running a 'FDISK /mbr' will leave the</FONT>
<FONT SIZE=5>hard drive inaccessible When infecting the Flash BIOS, BIOS Meningitis uses</FONT>
<FONT SIZE=5>various INT 16h AH=E0h (BIOS Flash routines) calls to manipulate the Flash</FONT>
<FONT SIZE=5>memory. The virus first searches the ROM BIOS from segments 0F000h to 0FFF0h</FONT>
<FONT SIZE=5>for a 1kb cave of 0 bytes. If such cave is found the virus copies itself to</FONT>
<FONT SIZE=5>this space, and patches first 5 bytes of the original INT 19h (BIOS Boot Strap</FONT>
<FONT SIZE=5>Loader) handler with a JMP FAR (EAh ssss:oooo) pointing to its own INT 19h</FONT>
<FONT SIZE=5>routine. The viruses INT 19h copies the virus to 0000:7C00h (standard boot</FONT>
<FONT SIZE=5>sector load address), emulates an infected MBR execution and then does the job</FONT>
<FONT SIZE=5>of a standard INT 19h handler - boot from floppy or hard drive. The INT 19h</FONT>
<FONT SIZE=5>handler of BIOS Meningitis is very minimal and may not behave in the same</FONT>
<FONT SIZE=5>manner as the original BIOS INT 19h handler. The virus may also overwrite the</FONT>
<FONT SIZE=5>chipset when infecting the Flash BIOS leading to unpredictable results. BIOS</FONT>
<FONT SIZE=5>Meningitis includes the text string:</FONT>

<FONT SIZE=5><I>VLAD</I></FONT>

<FONT SIZE=5>[9]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="vlad3">
<FONT SIZE=5><U><B>% VLAD Issue 3 %</B></U></FONT>

<FONT SIZE=5>In February 1995 VLAD Issue 3 came out. Two viruses were included by Qark:</FONT>
<FONT SIZE=5>'Hemlock' and 'Megastealth'. In the source code to Hemlock, Qark states:</FONT>

<FONT SIZE=5>&quot;Hemlock is the poison that killed Socrates and the way I figure it, what's</FONT>
<FONT SIZE=5>good for one Greek philosopher is good enough for another.&quot;</FONT>

<FONT SIZE=5>This seems to be a reference to 'Aristotle', the VX BBS sysop who turned over</FONT>
<FONT SIZE=5>the personal details of at least one North American virus writer to authorities</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="hemlock">
<FONT SIZE=5><U><B>% Virus: Hemlock %</B></U></FONT>

<FONT SIZE=5>'Hemlock' was a polymorphic, full stealth and multipartite infecter of the</FONT>
<FONT SIZE=5>MBR, floppy boot sectors and MS-DOS .COM, .EXE and .SYS files. When loading</FONT>
<FONT SIZE=5>from an infected boot sector or MBR, the virus takes several actions. First </FONT>
<FONT SIZE=5>the virus sets up its own stack. Next the virus allocated 8 kilobytes of</FONT>
<FONT SIZE=5>memory by reducing the 16-bit WORD at 40h:13h (this is the amount of</FONT>
<FONT SIZE=5>conventional memory available to the machine according to the BIOS). Hemlock</FONT>
<FONT SIZE=5>then attempts to read the 7 sectors containing the virus code to this newly</FONT>
<FONT SIZE=5>allocated memory - the virus will go into an (infinite) loop until this read</FONT>
<FONT SIZE=5>succeeds. Upon reading the virus, 3 variables are reset related to the hooking</FONT>
<FONT SIZE=5>of INT 21h later on and INT 13h (BIOS Disk Services) and INT 09h (Keyboard IRQ</FONT>
<FONT SIZE=5>Handler) are hooked directly in the IVT (Interrupt Vector Table). The entire</FONT>
<FONT SIZE=5>IVT (Interrupt Vector Table) and the original video mode are also saved. This</FONT>
<FONT SIZE=5>is done in an attempt to survive a warm reboot: When CTRL+ALT+DEL is pressed</FONT>
<FONT SIZE=5>Hemlock restores the original video mode and IVT, makes sure the machine is</FONT>
<FONT SIZE=5>not in protected mode and then issues an INT 19h (BIOS Boot Strap Loader). The</FONT>
<FONT SIZE=5>INT 13h hook provides 3 functions - boot sector infection, boot sector/MBR</FONT>
<FONT SIZE=5>stealth and hooking INT 21h when MS-DOS is loaded. When attempting to read</FONT>
<FONT SIZE=5>physical sector 1 of a disk (boot sector/MBR) if the disk is infected stealth</FONT>
<FONT SIZE=5>action is taken, if the disk is uninfected the disk is infected. The boot</FONT>
<FONT SIZE=5>sector/MBR stealth mechanism simply redirects reading of the infected boot</FONT>
<FONT SIZE=5>sector to the sector containing the original uninfected sector. When infecting</FONT>
<FONT SIZE=5>disks the original boot sector/MBR is replaced with the virus boot loader that</FONT>
<FONT SIZE=5>takes action as described above. In the case of MBR (hard drive) infection,</FONT>
<FONT SIZE=5>the original MBR and virus body are saved in the 8 sectors starting from</FONT>
<FONT SIZE=5>physical sector 3 - this space should be unused on a machine running MS-DOS.</FONT>
<FONT SIZE=5>When infecting a floppy disk boot sector the virus takes some strange actions:</FONT>
<FONT SIZE=5>the virus calculates and allocates the last cylinder of the floppy using the</FONT>
<FONT SIZE=5>BPB (BIOS Parameter Block). The virus body is saved to the last cylinder of</FONT>
<FONT SIZE=5>the diskette but the original boot sector is placed at sector 14, cylinder 0,</FONT>
<FONT SIZE=5>head 1. This leads to the same problem as the afore mentioned 'BIOS</FONT>
<FONT SIZE=5>Meningitis' - floppy types other than 5.25 inch 1.2mb may be corrupted. On</FONT>
<FONT SIZE=5>infecting the MBR the virus attempts to bypass anti-virus software by using</FONT>
<FONT SIZE=5>'tunnelled' INT 13h and INT 15h vectors. The virus attempts to retrieve the</FONT>
<FONT SIZE=5>original INT 15h address by checking a hard-coded value in the ROM BIOS: </FONT>
<FONT SIZE=5>F000h:F859h. The virus searches segment F000h as well for 5-byte signature of</FONT>
<FONT SIZE=5>most AMI-BIOS's INT 13h handler. The INT 13h handler is additionally used to</FONT>
<FONT SIZE=5>hook INT 21h when MS-DOS is loaded when boot from an infected disk - four</FONT>
<FONT SIZE=5>conditions are used to decide when to hook INT 21h. The first condition to</FONT>
<FONT SIZE=5>hook INT 21h is if any write attempt is made to disk. The second is if INT 13h</FONT>
<FONT SIZE=5>is called with Hemlocks residency check - this will always come from a file</FONT>
<FONT SIZE=5>since infected sectors are not re-executed due to the INT 13h stealth</FONT>
<FONT SIZE=5>mechanism. The third is if AUTOEXEC.BAT seems to be read - the virus checks</FONT>
<FONT SIZE=5>for the read of a sector starting with '@EC' (case insensitive). The fourth</FONT>
<FONT SIZE=5>method to check for MS-DOS loading is the read of the first MZ header - or the</FONT>
<FONT SIZE=5>tenth if QEMM (Quarterdeck Expanded Memory Manager) is found to be present.</FONT>
<FONT SIZE=5>When infecting .SYS, .COM and .EXE files the virus checks the extension (case</FONT>
<FONT SIZE=5>insensitive) but differentiates .COM and .EXE files by checking for MZ marker.</FONT>
<FONT SIZE=5>When run from an infected .SYS checks if the virus is already resident and if</FONT>
<FONT SIZE=5>the MBR is is already infected and hits the MBR if not. The tunnelled INT 13h</FONT>
<FONT SIZE=5>and INT 15h vectors are used as described above. Hemlock does not go memory</FONT>
<FONT SIZE=5>resident from infected .SYS files. When run from an infected .COM or .EXE file</FONT>
<FONT SIZE=5>Hemlock performs the same actions as with .SYS files and then installs itself</FONT>
<FONT SIZE=5>memory resident. The virus allocates memory by ensuring the MCB (Memory</FONT>
<FONT SIZE=5>Control Block) of the host file is the last block in the chain and then</FONT>
<FONT SIZE=5>reduces its size by the amount required and adjusts the PSP 'top of memory'</FONT>
<FONT SIZE=5>field (offset 02h). The virus copies itself to this newly allocated space and</FONT>
<FONT SIZE=5>hooks INT 21h and INT 13h directly. The virus then returns to the host. When</FONT>
<FONT SIZE=5>infecting .EXE files Hemlock adjusts the 'maxmen' field of the MZ header to</FONT>
<FONT SIZE=5>avoid some anti-virus programs self-check (specifically Thunder-Byte). Apart</FONT>
<FONT SIZE=5>from this, .SYS, .COM and .EXE files are infected in a standard manner.</FONT>
<FONT SIZE=5>The virus increases the date-stamp of infected files by 100 years as an</FONT>
<FONT SIZE=5>infection marker. Hemlocks INT 21h handler is used both for file infection and</FONT>
<FONT SIZE=5>stealth. On open, execute, chmod and rename calls files are infected. On</FONT>
<FONT SIZE=5>'open' calls special 'stealth' action is taken too: Hemlock retrieves the SFT</FONT>
<FONT SIZE=5>(System File Table) entry for the infected file and reduces the file length</FONT>
<FONT SIZE=5>field to the uninfected size to stop programs reading past the original end</FONT>
<FONT SIZE=5>of file and into the virus body. On 'execute' calls special action is taken</FONT>
<FONT SIZE=5>too. If the program to be executed is a known archiver (PKZIP, ARJ or LHA)</FONT>
<FONT SIZE=5>stealth is disabled to allow the virus to spread - infecting files to be added</FONT>
<FONT SIZE=5>to the archive. The same action is taken in the case of disk checking programs</FONT>
<FONT SIZE=5>(CHKDSK, NDD, SCANDISK) - this is done to stop these programs reporting file</FONT>
<FONT SIZE=5>system corruption because space allocated on disk does not correspond to the</FONT>
<FONT SIZE=5>'stealthed' length of the file. When 'TBSCAN' is run Hemlock appends &quot;co nm&quot;</FONT>
<FONT SIZE=5>to the command line. This stops TBSCAN from scanning memory and detecting</FONT>
<FONT SIZE=5>the virus. When WIN is run (MS-Windows) Hemlock appends &quot;/d:f&quot; to the command</FONT>
<FONT SIZE=5>line. This disables 32-bit disk access, allowing Hemlocks INT 13h handler to</FONT>
<FONT SIZE=5>stay active. On 'read' calls Hemlock checks if the read attempt is in the first</FONT>
<FONT SIZE=5>24 byes of the file and is it is redirects the read to the original file</FONT>
<FONT SIZE=5>header making the file appear uninfected. On FCB/ASCII FindFirst/FindNext</FONT>
<FONT SIZE=5>calls Hemlock implements 'size stealth' substituting the infected length of the</FONT>
<FONT SIZE=5>file with the uninfected length and also hides the viruses date-stamp marker.</FONT>
<FONT SIZE=5>On an attempt to retrieve the date-stamp of an infected file, the date-stamp</FONT>
<FONT SIZE=5>marker is also removed. Hemlock attempts to disable anti-virus and other</FONT>
<FONT SIZE=5>software from single-step tunnelling through its INT 21h and INT 13h handlers</FONT>
<FONT SIZE=5>by disabling the Trace Flag. Hemlock is polymorphic in all file infections.</FONT>
<FONT SIZE=5>Hemlock includes the text string:</FONT>

<FONT SIZE=5><I>Hemlock by [qark/VLAD]</I></FONT>

<FONT SIZE=5>[10]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="megastealth">
<FONT SIZE=5><U><B>% Virus: Megastealth %</B></U></FONT>

<FONT SIZE=5>'Megastealth' was a memory resident stealth multipartite infecter of MS-DOS</FONT>
<FONT SIZE=5>.COM files, floppy boot sectors and the MBR. The main feature of this virus</FONT>
<FONT SIZE=5>was 'hardware' level stealth. When loading from an infected sector</FONT>
<FONT SIZE=5>'Megastealth' sets up the stack and then allocates 2 kilobytes of memory.</FONT>
<FONT SIZE=5>Like 'Hemlock' and 'BIOS Meningitis' memory is allocated by reducing the</FONT>
<FONT SIZE=5>16-bit value at 40h:13h (amount of conventional memory installed) by 2.</FONT>
<FONT SIZE=5>Megastealth then reads in two sectors containing the virus body and hooks</FONT>
<FONT SIZE=5>INT 13h, clears a flag to mark if INT 21h has been hooked and if the virus</FONT>
<FONT SIZE=5>is a 80286+ (AT) hooks INT 76h (IDE Controller IRQ). Megastealth the issues an</FONT>
<FONT SIZE=5>INT 19h (BIOS Bootstrap Loader) to continue with the boot process. The INT 76h</FONT>
<FONT SIZE=5>handler is used to implement stealth of the MBR at the hardware level. When</FONT>
<FONT SIZE=5>the IRQ occurs, Megastealth checks if it is a read from physical sector 1</FONT>
<FONT SIZE=5>(the MBR) by querying values of the IDE Controller (ports 1F0h - 1F7h). If it</FONT>
<FONT SIZE=5>is a read of the MBR, Megastealth reads in data of original read attempt from</FONT>
<FONT SIZE=5>the IDE data port and then sends values and command to the IDE controller to</FONT>
<FONT SIZE=5>read in physical sector 4 (the original uninfected MBR). This algorithm means</FONT>
<FONT SIZE=5>that even when using the original ROM BIOS INT 13h handler, the MBR is</FONT>
<FONT SIZE=5>stealthed while INT 76h handler is in place. Megastealth disables the INT 76h</FONT>
<FONT SIZE=5>handler while infecting a disk. Megastealths INT 13h handler serves three</FONT>
<FONT SIZE=5>purposes: to infect boot sectors, to stealth boot sectors and to hook INT 21h</FONT>
<FONT SIZE=5>when booting from an infected disk. The INT 13h handler function is very</FONT>
<FONT SIZE=5>similar to that of 'Hemlock' (see above). When reading the boot sector/MBR of</FONT>
<FONT SIZE=5>a disk, if the disk is infected, the read is stealthed. If the disk is not</FONT>
<FONT SIZE=5>infected the disk is infected. Megastealth shares the same peculiarity with</FONT>
<FONT SIZE=5>'Hemlock': the track to store the virus body on when infected is calculated</FONT>
<FONT SIZE=5>using the BIOS Parameter Block, but the last sector of the root directory used</FONT>
<FONT SIZE=5>to store the original uninfected sector is hard-coded, leading to corruption</FONT>
<FONT SIZE=5>of all floppies other than 5.25 in 1.2mb ones. Megastealths INT 13h hooks</FONT>
<FONT SIZE=5>INT 21h on loading from an infected disk when the first 'MZ' header is read</FONT>
<FONT SIZE=5>in. When executed from an infected .COM file, Megastealth first checks if it</FONT>
<FONT SIZE=5>is already present in memory and goes resident if not. Memory is allocated in</FONT>
<FONT SIZE=5>the same manner as 'Hemlock': if the host MCB is the last in the chain, it and</FONT>
<FONT SIZE=5>the 'Top Of Memory' field of the host PSP (Program Segment Prefix) are reduced</FONT>
<FONT SIZE=5>in size, and the virus copies itself to the newly created space. Megastealth</FONT>
<FONT SIZE=5>then hooks INT 13h, issues a read of the MBR (to infect MBR by INT 13h</FONT>
<FONT SIZE=5>handler) and then hooks INT 21h. After this Megastealth restores and returns </FONT>
<FONT SIZE=5>control to the host. INT 76h is not hooked when loading from an infected .COM</FONT>
<FONT SIZE=5>file. The INT 21h handler is used primarily for one purpose: infecting .COM</FONT>
<FONT SIZE=5>files. .COM files are infected on open, execute, chmod and rename calls. The</FONT>
<FONT SIZE=5>INT 21h handler also seems to have a debugging feature: on each INT 21h call</FONT>
<FONT SIZE=5>the handler displays a '&quot;' (double quote) character in the corner of the</FONT>
<FONT SIZE=5>screen if the VGA controller is in a text mode. Megastealth includes the text</FONT>
<FONT SIZE=5>string:</FONT>

<FONT SIZE=5><I>[MegaStealth] by qark/VLAD</I></FONT>

<FONT SIZE=5>[11]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="vlad4">
<FONT SIZE=5><U><B>% VLAD Issue 4 %</B></U></FONT>

<FONT SIZE=5>VLAD Issue 4 was released in April 1995. Two virus by Qark were included:</FONT>
<FONT SIZE=5>Winsurfer (co-authored with Quantum of VLAD) and Good Times. &quot;Good Times&quot; was</FONT>
<FONT SIZE=5>named after the &quot;Good Times&quot; email virus hoax, perhaps in an effort to create</FONT>
<FONT SIZE=5>some publicity.</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="winsurfer">
<FONT SIZE=5><U><B>% Virus: Winsurfer %</B></U></FONT>

<FONT SIZE=5>'Winsurfer' was a memory-resident win16 infecter of NE (NewEXE - Win16</FONT>
<FONT SIZE=5>executables). Winsurfer was written by both Qark and Quantum of VLAD.</FONT>
<FONT SIZE=5>According to the source code the Interrupt Service Routine (ISR) was written</FONT>
<FONT SIZE=5>by Quantum with the infection code written by Qark. Additionally the source</FONT>
<FONT SIZE=5>code mentions some situation in which the NE infection may fail. Although a </FONT>
<FONT SIZE=5>win16 virus, Winsurfer used a mix of INT 21h (MS-DOS API), INT 2Fh (MS-DOS </FONT>
<FONT SIZE=5>Multiplex) and INT 31h (DPMI - DOS Protected Mode Interface calls). INT 2Fh is</FONT>
<FONT SIZE=5>called only once to determine if DPMI/INT 31h is present. INT 21h is called</FONT>
<FONT SIZE=5>for file I/O such as open/read/lseek/write/close. INT 31h is used to change</FONT>
<FONT SIZE=5>segment protection and to hook INT 21h globally The INT 21h handler serves two</FONT>
<FONT SIZE=5>purposes: to provide the viruses residency check and to find NE files to</FONT>
<FONT SIZE=5>infect. 'NE' files are infected on INT 21h/AX=4B00h - Execute. Under all</FONT>
<FONT SIZE=5>infections Winsurfer calls INT 2Fh to check if DPMI is present, INT 31h to </FONT>
<FONT SIZE=5>make its code segment writeable and INT 21h to check if the virus is already</FONT>
<FONT SIZE=5>resident in memory. When run from a regular NE executable Winsurfer attempts</FONT>
<FONT SIZE=5>a direct-action infection of the Win16 shell (usually Program Manger). This</FONT>
<FONT SIZE=5>executable is targeted because it can be relied on as being resident at all</FONT>
<FONT SIZE=5>times for the virus to stay resident. The shell is located in three steps: </FONT>
<FONT SIZE=5>First the 'windir' environment variable is found. The virus locates this in</FONT>
<FONT SIZE=5>the environment segment given by the PSP (Program Segment Prefix) of the host</FONT>
<FONT SIZE=5>at offset 2Ch. Next the virus attempts to open an read 'system.ini' in the</FONT>
<FONT SIZE=5>Windows directory. Finally the virus attempts to locate the shell by searching</FONT>
<FONT SIZE=5>system.ini for the 'shell=' key. When run from the windows shell the virus</FONT>
<FONT SIZE=5>goes resident in memory: The virus needs to take no special action to allocate</FONT>
<FONT SIZE=5>memory as it stays loaded with the windows shell. INT 31h is used to retrieve</FONT>
<FONT SIZE=5>the current real mode INT 21h vector and then set it to the Winsurfers own</FONT>
<FONT SIZE=5>INT 21h handler. Winsurfer introduce the 'VLAD' method of infecting NE</FONT>
<FONT SIZE=5>executables. This method basically worked by moving the NE header back 8 bytes</FONT>
<FONT SIZE=5>making space to add an extra 8 byte entry to the 'Segment Table'. The virus is</FONT>
<FONT SIZE=5>appended to the end of the file and the extra Segment Table entry points to</FONT>
<FONT SIZE=5>this appended code. Winsurfer first checks the MZ header of the file: Is the</FONT>
<FONT SIZE=5>'MZ' marker there? Is the 'Offset of First Relocation Item' (MZ header offset</FONT>
<FONT SIZE=5>+18h) 40h or more? (This is a sign of a NE). Is the pointer to the NE header</FONT>
<FONT SIZE=5>at offset +3Ch of the MZ header exactly 400h? The victim is deemed to be a </FONT>
<FONT SIZE=5>NewEXE file, but no test of the NE header is performed before infection</FONT>
<FONT SIZE=5>starts. This could lead to corruption of other types of executables such as</FONT>
<FONT SIZE=5>PE, LE, LX etc. The first immediately reduces the pointer to the NE header</FONT>
<FONT SIZE=5>at absolute offset +3Ch and the MZ header SP field by 8. Next Winsurfer reads</FONT>
<FONT SIZE=5>512 of the NE header from hard coded absolute offset of +400h. The virus reads</FONT>
<FONT SIZE=5>the Segment table offset (NE +22h) and adjust several values of the NE header</FONT>
<FONT SIZE=5>by 8 if they occur after the start of this table. Values adjusted are: offset</FONT>
<FONT SIZE=5>to 'Entry Table' (NE +04h), offset to 'Relocation Table' (NE +24h),  offset to</FONT>
<FONT SIZE=5>'Resident Names Table (NE +26h), offset to 'Module Reference Table' (NE +28h)</FONT>
<FONT SIZE=5>and offset to 'Imported Names Table' (NE +2Ah). Winsurfer reads then</FONT>
<FONT SIZE=5>increments the 'Segment Count' field (NE +1Ch) making the assumption there are</FONT>
<FONT SIZE=5>less than 256 segments. Winsurfer saves the original CS:IP combination for use</FONT>
<FONT SIZE=5>in its single relocation item and then sets CS:IP entry point in the NE header</FONT>
<FONT SIZE=5>to future segment index and offset of the appended virus. Winsurfer uses the </FONT>
<FONT SIZE=5>'Segment Count' and 'Segment Table Offset' (NE +22h) to calculate the end of</FONT>
<FONT SIZE=5>the new Segment Table and move all of the NE header before this location back</FONT>
<FONT SIZE=5>8 bytes in 512 byte chunks. Winsurfer uses the 'File Alignment Shift' value </FONT>
<FONT SIZE=5>(NE +32h) to calculate the new position of the appended virus and creates a</FONT>
<FONT SIZE=5>new Segment Table entry to contain the appended virus code. The new Segment</FONT>
<FONT SIZE=5>Table entry has physical and memory size set to the size of the virus, file</FONT>
<FONT SIZE=5>offset pointing to appended virus code and adjusted by File Alignment Shift</FONT>
<FONT SIZE=5>value and Segment Attributes: 'NonMovable+Relocations'. Winsurfer then writes</FONT>
<FONT SIZE=5>the new Segment Table back to the NE header on disk. Winsurfer appends the</FONT>
<FONT SIZE=5>virus to the end of the file at the position previously calculated and then</FONT>
<FONT SIZE=5>appends a single relocation item for the virus segment after that. The</FONT>
<FONT SIZE=5>relocation item is of type '3' (PTR) and flags value 'additive'. Infection of</FONT>
<FONT SIZE=5>the NewEXE victim is then complete. [12]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="goodtimes">
<FONT SIZE=5><U><B>% Virus: Good Times %</B></U></FONT>

<FONT SIZE=5>'Good Times' was a polymorphic memory-resident infecter of MS-DOS .COM and</FONT>
<FONT SIZE=5>.EXE files. The source code of Good Times includes a small portion of the</FONT>
<FONT SIZE=5>'Good Times' hoax email. Good Times obtains its polymorphic ability by using</FONT>
<FONT SIZE=5>the 'RHICE' polymorphic engine by Rhincewind, another member of VLAD. Good</FONT>
<FONT SIZE=5>Times used some anti-heuristic structures to avoid heuristic detection. Good</FONT>
<FONT SIZE=5>Times used fairly standard methods of infecting .COM and .EXE files, with one</FONT>
<FONT SIZE=5>exception: When infecting .COM files the virus would follow and JMP NEAR</FONT>
<FONT SIZE=5>(E9h), JMP SHORT (EBh) and CALL (E8h) instructions in an attempt to place the</FONT>
<FONT SIZE=5>jump to the virus further inside the file. Only these 3 instructions were</FONT>
<FONT SIZE=5>followed. When infecting .EXE files Good Times would avoid overlay files, .EXE</FONT>
<FONT SIZE=5>files whos 'maxmem' field was not 0FFFFh and Windows executables. .EXE files</FONT>
<FONT SIZE=5>were marked as infected by setting offset 12h (checksum value) of the MZ</FONT>
<FONT SIZE=5>header to 'BV' (VB). This caused the virus to avoid infecting files that had</FONT>
<FONT SIZE=5>been generically disinfected by the 'Virus Buster' anti-virus. When an</FONT>
<FONT SIZE=5>infected executable is run the Good Times checks if it is already resident in</FONT>
<FONT SIZE=5>memory, goes memory-resident if not and then returns control to the host. To</FONT>
<FONT SIZE=5>allocate memory Goodtimes uses Qarks standard method by reducing the size of</FONT>
<FONT SIZE=5>the MCB of the host if it is the last in the chain, as well as the 'top of</FONT>
<FONT SIZE=5>memory' field of the host PSP. The virus copies itself to this allocated block</FONT>
<FONT SIZE=5>of memory and hooks INT 21h. Good Times INT 21h handler handles the viruses</FONT>
<FONT SIZE=5>residency check and infect files on open, execute, rename and chmod calls.</FONT>
<FONT SIZE=5>Only files with extensions beginning with 'c', 'C', 'e' or 'E' are infected.</FONT>
<FONT SIZE=5>Good Times differentiates between .COM and .EXE files by checking for presence</FONT>
<FONT SIZE=5>of MZ header. Good Times included the text string:</FONT>

<FONT SIZE=5><I>Good Times by Qark/VLAD </I></FONT>

<FONT SIZE=5>[13]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="vlad5">
<FONT SIZE=5><U><B>% VLAD Issue 5 %</B></U></FONT>

<FONT SIZE=5>VLAD Issue 5 was released in August 1995 and feature two more viruses by Qark:</FONT>
<FONT SIZE=5>'Horsa' and 'Ph33r'.</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="horsa">
<FONT SIZE=5><U><B>% Virus: Horsa %</B></U></FONT>

<FONT SIZE=5>'Horsa' was a direct-action infecter of the firs uninfected MS-DOS .COM file</FONT>
<FONT SIZE=5>in the current directory. What made Horsa was unusual was the use of direct</FONT>
<FONT SIZE=5>sector reads and writes (INT 25h/INT 26h) when working with files and</FONT>
<FONT SIZE=5>directories instead of using the usual INT 21h calls. This allowed it to</FONT>
<FONT SIZE=5>bypass many anti-virus programs. When an infected .COM file was run Horsa</FONT>
<FONT SIZE=5>restored the first 3 bytes of the host program, saved the DS register and then</FONT>
<FONT SIZE=5>realigned CS:IP so that the virus was realigned to cs:0. This avoided the uses</FONT>
<FONT SIZE=5>of delta offset operations through out the virus and also meant that Horsa</FONT>
<FONT SIZE=5>be aligned on a paragraph (16-byte) boundary when appended to a victim .COM</FONT>
<FONT SIZE=5>file. Once realigned Horsa sets the DTA (Disk Transfer Area) to the heap of</FONT>
<FONT SIZE=5>the virus and used an INT 21h AH=4Eh/AH=4Fh (ASCII FindFirst/FindNext) to</FONT>
<FONT SIZE=5>find the first uninfected .COM file. Horsa marked files as infected by</FONT>
<FONT SIZE=5>setting the low byte of the victims time-stamp so that the low 5-bits were</FONT>
<FONT SIZE=5>10h. After this FindFirst/FindNext loop, only INT 25h (logical sector read)</FONT>
<FONT SIZE=5>and INT 26h (logical sector write) are used to manipulate files and</FONT>
<FONT SIZE=5>directories. Horsa uses the ASCII FindFirst/Next entry to obtain the drive,</FONT>
<FONT SIZE=5>first cluster and cluster count of the victim file. Next Horsa obtains the DPB</FONT>
<FONT SIZE=5>(Disk Parameter Block) of the drive using INT 21h AH=32h. This provides Horsa</FONT>
<FONT SIZE=5>with all the information it needs on the logical drive. Horsa determines</FONT>
<FONT SIZE=5>whether the drive is FAT12 or FAT16 by looking at the total number of clusters</FONT>
<FONT SIZE=5>of the drive: If there are 0FF8h or more clusters the drive is FAT16,</FONT>
<FONT SIZE=5>otherwise it is FAT12. Horsa obtains the cluster containing the directory</FONT>
<FONT SIZE=5>entry for the victim file. That is used to update the victims size and mark</FONT>
<FONT SIZE=5>the time-stamp as infected. A special case routine is used if the victim is in</FONT>
<FONT SIZE=5>the root directory. Horsa reads the first cluster of the victim and stores the</FONT>
<FONT SIZE=5>first 3 bytes in the virus body. Horsa appends the virus to the end of the</FONT>
<FONT SIZE=5>.COM file (on a 16-byte boundary) allocating clusters and updating the FAT</FONT>
<FONT SIZE=5>(File Allocation Table) as needed. Horsa then patches the first three bytes</FONT>
<FONT SIZE=5>of the file with a JMP to the appended virus and re-writes the first cluster.</FONT>
<FONT SIZE=5>On exiting Horsa flushes the MS-DOS buffers (INT 21h AH=0Dh), restores the</FONT>
<FONT SIZE=5>original address of the DTA, restores the segment registers to their original</FONT>
<FONT SIZE=5>values and returns control to the host. Horsa has some short comings as noted</FONT>
<FONT SIZE=5>by Qark in the virus source code. Firstly, Horsa does not handle the case when</FONT>
<FONT SIZE=5>a FAT12 entry spans 2 sectors so 1 in 256 infections on a FAT12 drive will</FONT>
<FONT SIZE=5>fail. Secondly, no buffering is used. This can make infection quite slow</FONT>
<FONT SIZE=5>especially on floppy disks. Lastly, infecting only the first uninfected .COM</FONT>
<FONT SIZE=5>file causes the virus to propagate quite slowly. [14]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="ph33r">
<FONT SIZE=5><U><B>% Virus: Ph33r %</B></U></FONT>

<FONT SIZE=5>'Ph33r' was a memory-resident MS-DOS/Win16 infecter of MS-DOS .COM and .EXE</FONT>
<FONT SIZE=5>files, and Win16 NE (NewEXE) files. Ph33r was the first cross-platform</FONT>
<FONT SIZE=5>infecter running under both MS-DOS and Windows. MS-DOS .COM and .EXE files are</FONT>
<FONT SIZE=5>infected in the standard manner, Win16 NE executables are infected using the</FONT>
<FONT SIZE=5>same infection scheme as 'Winsurfer' described above. Like 'Winsurfer', Ph33r</FONT>
<FONT SIZE=5>uses a mix of INT 21h (MS-DOS API) and INT 31h (DOS Protected Mode Interface)</FONT>
<FONT SIZE=5>calls. When run from a MS-DOS .COM or .EXE file Ph33r goes memory-resident in</FONT>
<FONT SIZE=5>the standard way: If host MCB is the last in the chain then the size of the</FONT>
<FONT SIZE=5>MCB and 'top of memory' field in the host PSP are reduced to allocate memory,</FONT>
<FONT SIZE=5>and INT 21h is hooked directly. When run from an infected Win16 file, Ph33r</FONT>
<FONT SIZE=5>uses a different method of residency: Rather than direct-action infection of</FONT>
<FONT SIZE=5>the windows shell to stay resident, INT 31h calls are used. Ph33r uses INT 31h</FONT>
<FONT SIZE=5>to allocated a block of linear memory, align a selector to it, and set its size</FONT>
<FONT SIZE=5>and protection attributes. This means that Ph33r can go resident off any</FONT>
<FONT SIZE=5>infected file. INT 31h calls are then also used to hook INT 21h. When run from</FONT>
<FONT SIZE=5>an MS-DOS .COM or .EXE, Ph33r takes two unusual actions. First a call is made</FONT>
<FONT SIZE=5>to INT 16h to disable MSAV (Microsoft Anti-Virus). Secondly the virus attempts</FONT>
<FONT SIZE=5>to find the original INT 21h vector by taking advantage of internal MS-DOS </FONT>
<FONT SIZE=5>structures: Ph33r gets the MS-DOS data segment by retrieving the &quot;List of</FONT>
<FONT SIZE=5>Lists&quot; (INT 21h AH=52h). The virus then checks for a &quot;NOP, NOP, CALL NEAR&quot;</FONT>
<FONT SIZE=5>sequence (90h, 90h, E8h) at offset 109Eh of the MS-DOS data segment. If these</FONT>
<FONT SIZE=5>are found the virus assumes the INT 21h vector to be at offset 10A0h of the</FONT>
<FONT SIZE=5>same segment. This is a check for the A20 line enable code when MS-DOS is</FONT>
<FONT SIZE=5>loaded in &quot;high memory&quot;. However the hard-coded values mean it may only work</FONT>
<FONT SIZE=5>with certain versions of MS-DOS. The infection code used INT 21h file I/O</FONT>
<FONT SIZE=5>calls and is shared by both the MS-DOS and Win16 INT 21h handler - this</FONT>
<FONT SIZE=5>reduces the size of the virus. Ph33r still however uses a different INT 21h</FONT>
<FONT SIZE=5>handler under MS-DOS and Win16. The two INT 21h handlers only have a small</FONT>
<FONT SIZE=5>difference: The Win16 handler does not infect on INT 21h AH=6Ch (extended</FONT>
<FONT SIZE=5>open), as this is generally not called under windows. The MS-DOS handler does</FONT>
<FONT SIZE=5>not infect on INT 21h AH=3Dh (open) as Qark notes that this causes Windows to</FONT>
<FONT SIZE=5>crash on loading. Other than this, both INT 21h handlers handle Ph33rs</FONT>
<FONT SIZE=5>residency checks and infect on open (either 3Dh or 6Ch), execute, rename and</FONT>
<FONT SIZE=5>chmod. Ph33r checks the extension of the victim file and only infects if it is</FONT>
<FONT SIZE=5>.CO? (.COM), .EX? (.EXE) or .DL? (.DLL). The virus still examines MZ and NE</FONT>
<FONT SIZE=5>headers to decide inner format of the victim file. Ph33r does not infect files</FONT>
<FONT SIZE=5>with names ending in 'AN' (*SCAN, *CLEAN), 'AV' (*AV), 'DV' (DV.EXE, DV.COM)</FONT>
<FONT SIZE=5>and 'OT' (F-PROT). This is to avoid self-checking anti-virus files. Ph33r</FONT>
<FONT SIZE=5>also does not infect files ending in '86' (Win386/Win286.EXE - part of the</FONT>
<FONT SIZE=5>Win16 kernel) as this causes windows to crash. All these checks are not case</FONT>
<FONT SIZE=5>sensitive. Ph33r includes the text strings:</FONT>

<FONT SIZE=5><I>=Ph33r=</I></FONT>
<FONT SIZE=5><I>Qark/VLAD</I></FONT>

<FONT SIZE=5>[15]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="vlad6">
<FONT SIZE=5><U><B>% VLAD Issue 6 %</B></U></FONT>

<FONT SIZE=5>In February 1996 VLAD Issue 6 was released with 5 contributions by Qark: 2</FONT>
<FONT SIZE=5>engines were included - VIP (VLAD Infinite Polymorphy) and VSTE (VLAD Surface</FONT>
<FONT SIZE=5>Tracing Engine). Qark also published 3 viruses in this issue: 'Gilgamesh',</FONT>
<FONT SIZE=5>'Tracevir' and '386 Virus'.</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="vip">
<FONT SIZE=5><U><B>% VIP - VLAD Infinite Polymorphy %</B></U></FONT>

<FONT SIZE=5>'VIP' (VLAD Infinite Polymorphy) 1.0 was a 16-bit stand-alone polymorphic</FONT>
<FONT SIZE=5>engine written by Qark, and was used in his 'Gilgamesh' virus (discussed</FONT>
<FONT SIZE=5>below). VIP 1.0 was a 'slow-polymorphic' engine, initialising its random</FONT>
<FONT SIZE=5>number generator with the current days date and a 16-bit word from the ROM</FONT>
<FONT SIZE=5>BIOS. This made it more difficult for the anti-virus companies to create</FONT>
<FONT SIZE=5>large sets of samples to test their scanners. VIP 1.0 used four standard</FONT>
<FONT SIZE=5>loop types: 'Standard' which was a classic decrypter loop, 'Call 1' in which</FONT>
<FONT SIZE=5>the decrypter recursively called itself each iteration, 'Call 2' in which the</FONT>
<FONT SIZE=5>decrypter called the loop after setting up registers and 'Stack' which set SP</FONT>
<FONT SIZE=5>to the end of the virus, popped it, decrypted it and pushed it back. The</FONT>
<FONT SIZE=5>'Stack' methods were less flexible then other methods: the pointer register</FONT>
<FONT SIZE=5>was always 'SP', the decryption operation was always an 'XOR' with no change</FONT>
<FONT SIZE=5>made to the decryption key register. Beside 'Stack' method, other decrypter</FONT>
<FONT SIZE=5>types used random registers: one or two pointer registers depending on</FONT>
<FONT SIZE=5>addressing mode chosen, and a random key register. Besides 'Stack' methods</FONT>
<FONT SIZE=5>other decrypter types any addressing modes (besides 06h immediate) were used:</FONT>
<FONT SIZE=5>[bx+si], [bx+di], [bp+si], [bp+di], [bx], [bp], [si] and [di]. In the case of</FONT>
<FONT SIZE=5>dual register addressing modes both registers were initialised, but only the</FONT>
<FONT SIZE=5>first register was incremented/decremented and compared for the loop. The loop</FONT>
<FONT SIZE=5>method was always a compare of the pointer register with the offset of the</FONT>
<FONT SIZE=5>last word to be decrypted. The loop branch could be a 'JNZ' or a 'JB'. Apart</FONT>
<FONT SIZE=5>from 'Stack' method encryption was always an XOR/ADD/SUB of the word pointed</FONT>
<FONT SIZE=5>to with the key register and then and XOR/ADD/SUB of the key register with an</FONT>
<FONT SIZE=5>immediate constant. The 'Stack' method was only used in .COM infections, the</FONT>
<FONT SIZE=5>other 3 methods were used in both .COM and .EXE infections. Apart from the</FONT>
<FONT SIZE=5>'Stack' method, decryption was always forward and on 16-bit words. Qark took</FONT>
<FONT SIZE=5>some care to avoid heuristic detection of the decrypter loops: VIP 1.0 always</FONT>
<FONT SIZE=5>used correct encoding, for example in instructions addressing AX or AL. Certain</FONT>
<FONT SIZE=5>junk instructions were not emitted for the first 'n' bytes, for example no</FONT>
<FONT SIZE=5>INC/DEC instructions were emitted in the first 15 bytes of the decrypter. Junk</FONT>
<FONT SIZE=5>instructions created included: INC/DEC reg16, ADD/OR/AND/ADC/SBB/SUB/XOR/CMP</FONT>
<FONT SIZE=5>&lt;reg8/reg16&gt; mem/immediate, MOV reg8/re16 immediate, XCHG reg8/16 reg8/16.</FONT>
<FONT SIZE=5>According to the source code, Qark says VIP 1.0 decrypters in about 1 in 300</FONT>
<FONT SIZE=5>cases due to a 16-bit memory access at 0FFFFh. Some of the comments in the VIP</FONT>
<FONT SIZE=5>1.0 source code seem incorrect, for example: INC/DEC  is not emitted in the</FONT>
<FONT SIZE=5>first 15 bytes although the source code comments say 20. VIP included the text</FONT>
<FONT SIZE=5>string:</FONT>

<FONT SIZE=5><I>VIP V1.0 by Qark/VLAD</I></FONT>

<FONT SIZE=5>[16]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="vste">
<FONT SIZE=5><U><B>% VSTE - VLAD Surface Tracing Engine %</B></U></FONT>

<FONT SIZE=5>'VSTE' (VLAD Surface Tracing Engine) by Qark was an early attempt at an EPO</FONT>
<FONT SIZE=5>(Entry-Point Obscuring) virus. VSTE was used in Qarks 'TraceVir' (discussed</FONT>
<FONT SIZE=5>below. VSTE worked very much like a length disassembler to trace the targeted</FONT>
<FONT SIZE=5>file until a point was found to patch the victim. VSTE took as arguments a</FONT>
<FONT SIZE=5>file handler to the victim file and a pointer to a temporary 300 byte buffer</FONT>
<FONT SIZE=5>to read the file contents. VSTE returned a file pointer to the instruction to</FONT>
<FONT SIZE=5>be patched and pointer to a buffer containing the first byte of that</FONT>
<FONT SIZE=5>instruction on. VSTE did not read the entire file into memory at once (that</FONT>
<FONT SIZE=5>kind of memory was not always available under MS-DOS) but lseeked around the </FONT>
<FONT SIZE=5>file, following the code and reading 300 bytes at a time. Files accessed by</FONT>
<FONT SIZE=5>VSTE were treated as 'raw' with no formatting and the first instruction being</FONT>
<FONT SIZE=5>at the very start of the file. This worked for .COM files, but did not</FONT>
<FONT SIZE=5>support other formats like MZ .EXE files. VSTE only supported 8086</FONT>
<FONT SIZE=5>instructions and stopped at anything 80286+. It is worth noting that VSTE</FONT>
<FONT SIZE=5>treated opcode 0Fh as 'POP CS' not an extended opcode, which was only the case</FONT>
<FONT SIZE=5>with the 8086 (remember VSTE was released in 1996). Beside following</FONT>
<FONT SIZE=5>instructions by their length, VSTE followed JMP/CALL NEAR and JMP SHORT</FONT>
<FONT SIZE=5>instructions. Other than 80286+ instructions, VSTE also terminated on</FONT>
<FONT SIZE=5>conditional jumps (07xh), JMP/CALL FAR and RET/IRET instructions. [17]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="gilgamesh">
<FONT SIZE=5><U><B>% Virus: Gilgamesh %</B></U></FONT>

<FONT SIZE=5>'Gilgamesh' was a tunnelling, polymorphic, memory-resident retro virus infecting</FONT>
<FONT SIZE=5>MS-DOS .COM and .EXE files. Polymorphy is achieved by using the VIP (VLAD</FONT>
<FONT SIZE=5>Infinite Polymorphy) engine also by Qark in this issue (discussed above).</FONT>
<FONT SIZE=5>Gilgamesh contains some anti-heuristic and anti-debugging structures, and also</FONT>
<FONT SIZE=5>attempts to avoid infecting 'bait' files. The first thing done when an</FONT>
<FONT SIZE=5>infected file is executed is to issue an INT 21h, AX=5253h. This call serves</FONT>
<FONT SIZE=5>4 purposes: It is the viruses residency check. It retrieves the MS-DOS 'List</FONT>
<FONT SIZE=5>Of Lists' (used later to tunnel INT 21h). It places IP on the stack to</FONT>
<FONT SIZE=5>retrieve 'delta offset' of the virus. Lastly it serves as an anti-debugging</FONT>
<FONT SIZE=5>trick since the IP on the stack will be over written if the virus is being</FONT>
<FONT SIZE=5>traced. Gilgamesh uses an unusual method of tunnelling The virus retrieves</FONT>
<FONT SIZE=5>the INT 21h vector from the IVT (Interrupt Vector Table) and scans the first</FONT>
<FONT SIZE=5>1000 bytes for 0EAh (JMP FAR) or 9Ah (CALL FAR). If either instruction is</FONT>
<FONT SIZE=5>found Gilgamesh moves on to the destination of the JMP/CALL and begins that</FONT>
<FONT SIZE=5>1000 byte scan again. This is done until the virus reaches the MS-DOS data</FONT>
<FONT SIZE=5>segment (returned by INT 21h AH=52h) or until no JMP/CALL is found. As</FONT>
<FONT SIZE=5>Gilgamesh scans byte-by-byte this may sometimes be unreliable. After this</FONT>
<FONT SIZE=5>the virus goes memory-resident. Residency is achieved using the standard method</FONT>
<FONT SIZE=5>by Qark: If the host MCB is the last in the chain it is reduce along with the</FONT>
<FONT SIZE=5>'top of memory' field in the host PSP, and INT 21h is hooked directly. .COM</FONT>
<FONT SIZE=5>files are infected in a quite standard manner. When infecting .EXE files the</FONT>
<FONT SIZE=5>virus checks for overlays, 'New Executables' such as NE files and that the</FONT>
<FONT SIZE=5>'maxmem' field of the header is 0FFFFh. Some checks are made before infecting</FONT>
<FONT SIZE=5>the victim. Gilgamesh will not infect files created on the current data or</FONT>
<FONT SIZE=5>files containing numerical digits in their names - this is to avoid bait</FONT>
<FONT SIZE=5>files. Gilgamesh also will not infect files beginning with: &quot;SC&quot; (scan,</FONT>
<FONT SIZE=5>scandisk), &quot;TB&quot; (all programs in the ThunderByte Anti-Virus sweet), &quot;F-&quot;</FONT>
<FONT SIZE=5>(F-Prot), &quot;GU&quot; (Dr Solomans 'Guard'), &quot;AV&quot; (AVP and others), &quot;DV&quot; (dv.exe,</FONT>
<FONT SIZE=5>dv.com), &quot;CH&quot; (chk*) and &quot;PR&quot; (progman - windows program manager). INT 21h</FONT>
<FONT SIZE=5>AH=60h is used to create standardise, full upper-case path of victim. Gilgamesh</FONT>
<FONT SIZE=5>checks for .COM or .EXE extension but differentiates file formats by checking</FONT>
<FONT SIZE=5>for MZ marker. When infecting files Gilgamesh deletes checksum databases</FONT>
<FONT SIZE=5>belonging to ThunderByte Anti-Virus, Central-Point Anti-Virus, Microsoft</FONT>
<FONT SIZE=5>Anti-Virus, AVP (Anti-Virus Pro), Invircible, as well as &quot;chklist.tav&quot; and</FONT>
<FONT SIZE=5>&quot;smartchk.cps&quot;. Full list of checksum databases deleted is: 'ANTI-VIR.DAT',</FONT>
<FONT SIZE=5>'CHKLIST.CPS', 'CHKLIST.MS', 'CHKLIST.TAV', 'SMARTCHK.CPS', 'AVP.CRC' and</FONT>
<FONT SIZE=5>'IVB.NTZ' The INT 21h handler of Gilgamesh is quite standard. It performs the </FONT>
<FONT SIZE=5>residency check and infects files on open and execute calls. Gilgamesh included</FONT>
<FONT SIZE=5>the text string:</FONT>

 <FONT SIZE=5><I>=Gilgamesh= by Qark - A VLAD Australia Production</I></FONT>

<FONT SIZE=5>[18]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="tracevir">
<FONT SIZE=5><U><B>% Virus: TraceVir %</B></U></FONT>

<FONT SIZE=5>'TraceVir' was a simple memory-resident infecter of MS-DOS .COM files written</FONT>
<FONT SIZE=5>to test Qarks VSTE engine (discussed above). When executed TraceVir began by</FONT>
<FONT SIZE=5>saving the flags and all registers due to its EPO (Entry-Point Obscuring)</FONT>
<FONT SIZE=5>nature. After testing if it was already memory-resident, TraceVir allocated</FONT>
<FONT SIZE=5>memory using Qarks standard method of reducing the hosts MCB if it was the</FONT>
<FONT SIZE=5>last MCB in the chain, and the 'top of memory' field of the hosts PSP. INT 21h</FONT>
<FONT SIZE=5>was then hooked directly. TraceVir then restores the flags and registers,</FONT>
<FONT SIZE=5>restores the hosts patched bytes and returns control. Besides handling</FONT>
<FONT SIZE=5>TraceVirs residency check, the INT 21h handler infects .COM files on 'execute'</FONT>
<FONT SIZE=5>calls. TraceVir does not check file extensions and instead detects .COM files</FONT>
<FONT SIZE=5>by absence of MZ marker. TraceVir uses the VSTE engine to place a 'JMP NEAR'</FONT>
<FONT SIZE=5>to the virus somewhere in the middle of the host instead of the start, and</FONT>
<FONT SIZE=5>appends the virus to the end of file. Files are marked as infected by setting</FONT>
<FONT SIZE=5>the low 5 bits of the time-stamp to 02h. The virus is not encrypted. TraceVir</FONT>
<FONT SIZE=5>included the text strings:</FONT>

<FONT SIZE=5><I>TraceVir by Qark/VLAD</I></FONT>
<FONT SIZE=5><I>This virus tests the VSTE engine</I></FONT>

<FONT SIZE=5>[17]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="v386">
<FONT SIZE=5><U><B>% Virus: 386 Virus %</B></U></FONT>

<FONT SIZE=5>'386 Virus' was a memory-resident infecter of MS-DOS .EXE files. The primary</FONT>
<FONT SIZE=5>feature of this virus was use of 80386 instructions and registers. When</FONT>
<FONT SIZE=5>executed the virus first checks for the presence of an 80386+ processor: I/O</FONT>
<FONT SIZE=5>Privilege Level bits of the flags register are set to 01h (2000h) and if </FONT>
<FONT SIZE=5>when flags are set by POPF instruction these bits are non-zero, CPU is 80386+.</FONT>
<FONT SIZE=5>Next the 386 Virus checks if it is already memory-resident: INT 21h is called</FONT>
<FONT SIZE=5>with EAX='VLAD' if EAX='ROCK' is returned the virus is memory-resident. The </FONT>
<FONT SIZE=5>virus goes resident and restores control to the host. Memory-residency is</FONT>
<FONT SIZE=5>achieved through standard Qark code. If the hosts MCB was the last MCB in the</FONT>
<FONT SIZE=5>chain the virus reduces the MCB and the 'top of memory' field of the hosts PSP.</FONT>
<FONT SIZE=5>INT 21h is then hooked directly. Apart from the residency-check, the INT 21h</FONT>
<FONT SIZE=5>handler infects .EXE files on 'execute' calls. The 386 Virus does not check</FONT>
<FONT SIZE=5>file extensions but instead checks the file for 'MZ' header. Files with the</FONT>
<FONT SIZE=5>'maxmem' field of the MZ header not set to 0FFFFh and NewEXE files are</FONT>
<FONT SIZE=5>avoided. Files are marked as infected by placing 'VL' in the MZ checksum field</FONT>
<FONT SIZE=5>(offset +12h). [19]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="vladaf">
<FONT SIZE=5><U><B>% VLAD April Fools Edition %</B></U></FONT>

<FONT SIZE=5>In April 1996 VLAD did something different and released a special 'April</FONT>
<FONT SIZE=5>Fools' edition, mainly with 'joke' viruses and articles. Two joke viruses were</FONT>
<FONT SIZE=5>published by Qark: 'SySta' and 'ASMVirus'.</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="systa">
<FONT SIZE=5><U><B>% Virus: SySta %</B></U></FONT>

<FONT SIZE=5>'SySta' was a direct-action infecter of MS-DOS .SYS files. SySta infected</FONT>
<FONT SIZE=5>MS-DOS .SYS files (MS-DOS Device Drivers) by appending the virus and</FONT>
<FONT SIZE=5>pointing the WORD at offset +08h (Interrupt Routine) of the SYS header to the</FONT>
<FONT SIZE=5>virus code. Victim files were determined to be valid .SYS files by checking if</FONT>
<FONT SIZE=5>the first WORD of the file (+00h - Offset Address of Next Driver) was 0FFFFh.</FONT>
<FONT SIZE=5>.SYS files supported multiple drivers in a single file by allowing chained</FONT>
<FONT SIZE=5>.SYS headers with the address of the next drivers header held in the first</FONT>
<FONT SIZE=5>32-bits of the .SYS header. A value of 0FFFFh indicated that .SYS header was</FONT>
<FONT SIZE=5>the last in the list, and most .SYS files contained only a single driver, </FONT>
<FONT SIZE=5>hence SyStas check for 0FFFFh at the start of file. When an infected .SYS file</FONT>
<FONT SIZE=5>is run SySta sets up a JMP NEAR (0E9h) instruction pointing to the original</FONT>
<FONT SIZE=5>Interrupt Routine (saved at infection time) and infected all .SYS files in the</FONT>
<FONT SIZE=5>current directory. This is achieved by saving the address of the original DTA</FONT>
<FONT SIZE=5>(Disk Transfer Area), setting the DTA to the SyStas heap and entering a ASCII</FONT>
<FONT SIZE=5>FindFirst/FindNext loop (INT 21h AH=4Eh/4Fh) for &quot;*.sys&quot;. SySta identified</FONT>
<FONT SIZE=5>already infected .SYS files by checking if the original Interrupt Routine was</FONT>
<FONT SIZE=5>with 1k of the end of the file. SySta included the text string:</FONT>

<FONT SIZE=5><I>SySta by Qark/VLAD</I></FONT>

<FONT SIZE=5>[20]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="asmvirus">
<FONT SIZE=5><U><B>% Virus: ASMVirus %</B></U></FONT>

<FONT SIZE=5>'ASMVirus' was a direct-action infecter of .ASM (Assembler Source Code) files.</FONT>
<FONT SIZE=5>When an infected file (executable assembler from infect .ASM file) is run,</FONT>
<FONT SIZE=5>ASMVirus immediately enters a ASCII FindFirst/FindNext (INT 21h AH=4Eh/4Fh)</FONT>
<FONT SIZE=5>loop searching for &quot;*.asm&quot;. Only the first uninfected file is infected. The</FONT>
<FONT SIZE=5>infection process begins by renaming the victim file to '*.as0' and setting</FONT>
<FONT SIZE=5>its attributes to 'hidden'. A new .ASM file containing the virus is created in</FONT>
<FONT SIZE=5>its place. This new .ASM file begins with a 2-byte comment: &quot;;~&quot;. This is the</FONT>
<FONT SIZE=5>infection marker, files beginning with these 2 bytes will be considered</FONT>
<FONT SIZE=5>infected. Next is the rest of the Assembler header: a code segment is declared</FONT>
<FONT SIZE=5>and all segment registers are 'assumed' to be this segment, org 100h directive</FONT>
<FONT SIZE=5>is given (the starting address of the assemble file) and the 'radix' is set to</FONT>
<FONT SIZE=5>10 (decimal). A label 'start:' is emitted, and then the virus itself is added</FONT>
<FONT SIZE=5>to the .ASM files in the form of 'db' (declare byte) statements. 10 bytes of</FONT>
<FONT SIZE=5>virus are emitted per line in base 10 (decimal). Once the virus body is</FONT>
<FONT SIZE=5>complete, ASMVir ends the .ASM file with and 'ends' directive to end the</FONT>
<FONT SIZE=5>segment and an 'end start' to conclude the program and declare the 'start'</FONT>
<FONT SIZE=5>label as the entrypoint to the assemble executable. According to Qark, these</FONT>
<FONT SIZE=5>.ASM files run under MASM, TASM and a86, and run as both .COM and .EXE files.</FONT>
<FONT SIZE=5>ASMVirus included the text string:</FONT>

<FONT SIZE=5><I>ASMVirus by Qark/VLAD</I></FONT>

<FONT SIZE=5>[21]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="vlad7">
<FONT SIZE=5><U><B>% VLAD Issue 7 %</B></U></FONT>

<FONT SIZE=5>VLAD Issue 7 was released in October 1996 and was the last edition of the</FONT>
<FONT SIZE=5>ezine. Two virus from Qark were included: 'Goodbye' and 'Padania'. Qark</FONT>
<FONT SIZE=5>declared his retirement from virus writing at this time, hence the name</FONT>
<FONT SIZE=5>'Goodbye'. 'Padania' was dedicated to the Padanian cause: A Northern Italian</FONT>
<FONT SIZE=5>region that want independence from Italy. This cause was made well known to</FONT>
<FONT SIZE=5>the virus writing community by the Padanian group iKx (international knowledge</FONT>
<FONT SIZE=5>exchange).</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="goodbye">
<FONT SIZE=5><U><B>% Virus: Goodbye %</B></U></FONT>

<FONT SIZE=5>'Goodbye' was a memory-resident infecter of MS-DOS .COM and .EXE files. An</FONT>
<FONT SIZE=5>interesting feature of Goodbye was the use of CRC16 algorithm to perform</FONT>
<FONT SIZE=5>compares and to mark infected files. Goodbye begins with a strange sequence</FONT>
<FONT SIZE=5>of SUB/MOV/DEC/DIV/ADD/XCHG instructions. The purpose of this code is unknown.</FONT>
<FONT SIZE=5>When an infected file is run this sequence of instructions is executed, the</FONT>
<FONT SIZE=5>virus checks if it is already memory-resident and goes resident if not, and</FONT>
<FONT SIZE=5>then control is passed on back to the host. When going memory-resident</FONT>
<FONT SIZE=5>Goodtimes uses a slightly different method of allocating memory then most of</FONT>
<FONT SIZE=5>the other viruses by Qark. Goodtimes still reduces the size of the host MCB</FONT>
<FONT SIZE=5>and &quot;top of memory&quot; field of the host PSP if the host is in the last MCB.</FONT>
<FONT SIZE=5>However, after this Goodtimes modifies the host MCB so it is no longer last in</FONT>
<FONT SIZE=5>the chain, and creates its own MCB with owner field of 0008h (COMMAND.COM/</FONT>
<FONT SIZE=5>System). This stops the UMB (Upper Memory Block) MCB from disappearing leaving</FONT>
<FONT SIZE=5>UMB memory inaccessible to MS-DOS. After this INT 21h is hooked directly. The</FONT>
<FONT SIZE=5>INT 21h handler handles the already-resident check and infects files on open,</FONT>
<FONT SIZE=5>execute, and chmod calls. Files are not infected on 'extended open' but the</FONT>
<FONT SIZE=5>infection code still has a check for this. When infecting files Goodbye uses</FONT>
<FONT SIZE=5>INT 21h AH=60h to normalise, complete and upper-case the filename. Goodbye</FONT>
<FONT SIZE=5>checks for .COM or .EXE extension using CRC16 of the last 4 bytes of the</FONT>
<FONT SIZE=5>filename, but differentiates between file formats by checking for 'MZ'/'ZM'</FONT>
<FONT SIZE=5>marker (also done with CRC16). Goodbye also avoids infecting files:</FONT>
<FONT SIZE=5>tbscan.exe, avp.exe, f-prot.exe, scan.exe, dv.exe and progman.exe. These</FONT>
<FONT SIZE=5>filename checks are done with CRC16 as well .COM and .EXE files are infected</FONT>
<FONT SIZE=5>in the standard manner, although Goodbye uses an interesting infection marker.</FONT>
<FONT SIZE=5>In .COM files, Goodbye stores the CRC16 of the 3-byte JMP to the virus</FONT>
<FONT SIZE=5>immediately after the JMP instruction - this gives the first 5 bytes a CRC16</FONT>
<FONT SIZE=5>of 0 (zero). The virus does similar with .EXE files: Goodbye sets the</FONT>
<FONT SIZE=5>'checksum' field (+12h) of the MZ header to the 18 bytes preceding it to give</FONT>
<FONT SIZE=5>the first 20 bytes of the MZ header a CRC16 of zero as well When infecting</FONT>
<FONT SIZE=5>.EXE files Goodtimes avoids infecting NewEXE files and files with the MZ</FONT>
<FONT SIZE=5>'maxmem' not equal to 0FFFFh. Goodtimes calculates CRC16s a byte at a time </FONT>
<FONT SIZE=5>using an 8-bit lookup table, generated at virus start-up Goodbye included the</FONT>
<FONT SIZE=5>text strings:</FONT>

<FONT SIZE=5><I>Goodbye everyone!</I></FONT>
<FONT SIZE=5><I>Viruses were fun, but I've got other things I'd like to do</I></FONT>
<FONT SIZE=5><I>Qark/VLAD</I></FONT>

<FONT SIZE=5>[22]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="padania">
<FONT SIZE=5><U><B>% Virus: Padania %</B></U></FONT>

<FONT SIZE=5>'Padania' was a memory-resident and direct-action polymorphic stealth infecter</FONT>
<FONT SIZE=5>of MS-DOS .COM and .EXE files. Padania used some anti-heuristic and retro</FONT>
<FONT SIZE=5>(anti-anti-virus) code. When executed, infected files immediately call INT 21h</FONT>
<FONT SIZE=5>AH=52h (DOS List of Lists). The virus retrieves the segment of the first MCB</FONT>
<FONT SIZE=5>(Memory Control Block) and walks the MCB chain. Walking of the MCB chain</FONT>
<FONT SIZE=5>serves 3 purposes: First Padania checks for MCBs with owner name beginning</FONT>
<FONT SIZE=5>with 'TB' (ThunderByte Anti-Virus) or 'NE' (Nemesis) and immediately returns</FONT>
<FONT SIZE=5>control to the host if either anti-virus is found. Secondly, MCBs are checked</FONT>
<FONT SIZE=5>to see if Padania is already resident. If the last MCB in the chains owner</FONT>
<FONT SIZE=5>name begins with 'DO' (DOS) Padania is already resident and returns control to</FONT>
<FONT SIZE=5>the host. Note that 'DOS' owner of is not used by MS-DOS (MS-DOS marks system</FONT>
<FONT SIZE=5>MCBs by setting the PSP segment field to 0008h), this is just the name of the</FONT>
<FONT SIZE=5>MCB that Padania decides to use. Thirdly, the last MCB is used to go memory-</FONT>
<FONT SIZE=5>resident. When going resident Padania allocates memory by reducing the size</FONT>
<FONT SIZE=5>of the last MCB and owner PSP 'top of memory' field, marks the affected MCB</FONT>
<FONT SIZE=5>as not the last in the chain, and creates a new MCB for itself. This allows</FONT>
<FONT SIZE=5>UMBs (Upper Memory Blocks) to still be accessible. When creating the new MCB</FONT>
<FONT SIZE=5>Padania marks the MCB as the last in the chain, sets owner PSP field to 0008h</FONT>
<FONT SIZE=5>(system) and sets the MCB name to 'DOS'. Padania then copies itself to the</FONT>
<FONT SIZE=5>newly allocated memory, passes control to the new copy of the virus and hooks</FONT>
<FONT SIZE=5>INT 21h directly. Once Padania is resident it immediately issues an INT 21h</FONT>
<FONT SIZE=5>AX=4B00h (execute) this stops some memory-resident anti-viruses from warning</FONT>
<FONT SIZE=5>that the INT 21h vector had changed. Padania then infects all files with a</FONT>
<FONT SIZE=5>.COM extension in the current directory, but not if the current directory is</FONT>
<FONT SIZE=5>on a floppy disk. This direct-action infection is achieved by an ASCII</FONT>
<FONT SIZE=5>FindFirst/FindNext (INT 21h AH=4Eh/4Fh) loop that calls INT 21h AX=4300h</FONT>
<FONT SIZE=5>(chmod) on the files, causing the memory-resident virus to infect them. After</FONT>
<FONT SIZE=5>this control is returned to the host. Padanias INT 21h handler starts with a</FONT>
<FONT SIZE=5>code stub very similar to that of the MS-DOS INT 21h handler in an attempt to</FONT>
<FONT SIZE=5>fool some people. Padanias INT 21h handler serves 3 purposes: Infection,</FONT>
<FONT SIZE=5>stealth and retro abilities. Files are infected on open, execute, chmod and</FONT>
<FONT SIZE=5>delete calls. Files are marked as infected by setting the 'seconds' field of</FONT>
<FONT SIZE=5>the victims time-stamp to 62. Stealth abilities are implemented on handle read</FONT>
<FONT SIZE=5>(INT 21h AH=3Fh), handle lseek (INT 21h AH=42h) calls, ASCII/FCB FindFirst/</FONT>
<FONT SIZE=5>FindNext calls (INT 21h AH=11h/12h/4Eh/4Fh) calls and get file time-stamp</FONT>
<FONT SIZE=5>(AX=5700h) calls. In the case of read calls, if the read begins in the first</FONT>
<FONT SIZE=5>28 bytes of the infected file (modified header) the original uninfected header</FONT>
<FONT SIZE=5>is substituted. If the read goes past the original end of the file into the</FONT>
<FONT SIZE=5>virus body the read is terminated at the end of the original file. In the case</FONT>
<FONT SIZE=5>of lseek call, if the seek is from the end of the file (origin = 02h) then the</FONT>
<FONT SIZE=5>call is modified to seek from the end of the original file not the end of the</FONT>
<FONT SIZE=5>infected file. In the case of FindFirst/FindNext calls the files size field is</FONT>
<FONT SIZE=5>corrected to the original filesize. Padania also has a retro-routine on</FONT>
<FONT SIZE=5>execution (INT 21h AX=4B00h). If the file to be executed is a known anti-virus</FONT>
<FONT SIZE=5>file (TBSCAN, TBSETUP, AVP, F-PROT, SCAN or AVSCAN), arguments are added to</FONT>
<FONT SIZE=5>the command line to disable scanning of memory. Padania takes some intelligent</FONT>
<FONT SIZE=5>action concerning its stealth routines. The virus fetches the name of the host</FONT>
<FONT SIZE=5>program from the name field of its MCB using INT 21h AH=51h (Get Current PSP).</FONT>
<FONT SIZE=5>FCB FindFirst/FindNext stealth is only implemented if current process is</FONT>
<FONT SIZE=5>&quot;??MM&quot; (COMMAND.COM). This allows for stealthing of 'dir' command without</FONT>
<FONT SIZE=5>'chkdsk.exe' reporting errors. In the case of several archiving, backup and</FONT>
<FONT SIZE=5>communications software, read and lseek stealth is disabled, putting the </FONT>
<FONT SIZE=5>virus in 'fast-infection' mode. Programs checked for with this feature</FONT>
<FONT SIZE=5>include: 'PK' (PKZIP), 'AR' (ARJ), 'UU' (UUENCDOE), 'BA' (BACKUP), 'LH' (LHA),</FONT>
<FONT SIZE=5>'RA' (RAR), 'MO' (MODEM), 'SP' (SPEEDISK), 'DE' (DEFRAG), 'CP' and 'MS' (MS</FONT>
<FONT SIZE=5>Backup and Central Point Backup). When infecting files, Padania checks for</FONT>
<FONT SIZE=5>.CO? or EX? extension. Padania does not infect filenames beginning with:  'AV'</FONT>
<FONT SIZE=5>(several anti-virus utilities), 'TB' (ThunderByte Anti-Virus suite), 'IV'</FONT>
<FONT SIZE=5>(Invircible), 'PR' (Windows progman.exe) and '-V' (old name for AVP). .EXE</FONT>
<FONT SIZE=5>files with NewEXE header or MZ 'maxmem' field not equal to 0FFFFh are not</FONT>
<FONT SIZE=5>infected. Padania is polymorphic in all infections. Polymorphic decrypters are</FONT>
<FONT SIZE=5>padded to a fixed length of 85 bytes to simplify stealth routines. Padania</FONT>
<FONT SIZE=5>includes the following text string:</FONT>

       <FONT SIZE=5><I>Padania Virus by Qark/VLAD</I></FONT>
       <FONT SIZE=5><I>This virus is dedicated to all the people in Padania</I></FONT>
       <FONT SIZE=5><I>(Northern Italy) who seek separation from Southern Italy</I></FONT>
       <FONT SIZE=5><I>and to their party Lega Nord.</I></FONT>
       <FONT SIZE=5><I>Questo virus e' dedicato agli abitanti della Padania, in cerca dell'</I></FONT>
       <FONT SIZE=5><I>indipendenza dal sud italia, ed al loro movimento Lega Nord</I></FONT>

<FONT SIZE=5>[23]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="memorial">
<FONT SIZE=5><U><B>% Virus: Memorial %</B></U></FONT>

<FONT SIZE=5>Although Qark announced his retirement in VLAD issue 7, one more virus came out</FONT>
<FONT SIZE=5>in the second half of 1997. Win9x.Memorial was co-authored by Qark and fellow</FONT>
<FONT SIZE=5>VLAD virus writer 'Quantum'. Memorial was dedicated to Clinton Haines, a young</FONT>
<FONT SIZE=5>deceased Australian virus writer. Memorial was a memory-resident oligmorphic</FONT>
<FONT SIZE=5>infecter of MS-DOS .COM and .EXE files, and Win9x PE (Portable Executables).</FONT>
<FONT SIZE=5>Memorial was the first oligomorphic Win9x virus and also contained retro virus</FONT>
<FONT SIZE=5>(anti-anti-virus) features. Although Memorial infected MS-DOS executables as</FONT>
<FONT SIZE=5>well, it could not be considered truly cross-platform: It required the</FONT>
<FONT SIZE=5>presence of Win9x Operating System to go resident and continue infecting</FONT>
<FONT SIZE=5>files. The heart of Memorial was a 12,413 byte VxD file (Win9x LE Virtual</FONT>
<FONT SIZE=5>Driver). Memorial used a simple packing algorithm to reduce the file in the</FONT>
<FONT SIZE=5>virus body down to 7,508 bytes. When run from an infected MS-DOS .COM file,</FONT>
<FONT SIZE=5>Memorial checks if Windows is running and immediately returns control to the</FONT>
<FONT SIZE=5>host if this case. Otherwise Memorial issues its MS-DOS residency-check and</FONT>
<FONT SIZE=5>takes action if the virus is not already resident. Memorial unpacks its VxD</FONT>
<FONT SIZE=5>body to &quot;C:\CLINT.VXD&quot; and goes memory-resident under MS-DOS. MS-DOS residency</FONT>
<FONT SIZE=5>is achieved by copying a small stub of code to the second-half of the</FONT>
<FONT SIZE=5>Interrupt Vector Table (IVT) at 0:200h and hooks INT 2Fh (MS-DOS Multiplex</FONT>
<FONT SIZE=5>Interrupt). The INT 2Fh handler serves two purposes: It handles Memorials</FONT>
<FONT SIZE=5>residency check and waits for Windows to load (INT 2Fh AX=1605h). When Windows</FONT>
<FONT SIZE=5>loads Memorial initialises a &quot;Win386_Startup_Info_Struc&quot; structure and points</FONT>
<FONT SIZE=5>the &quot;SIS_Virt_Dev_File_Ptr&quot; field to its VxD's filename. This causes the VxD</FONT>
<FONT SIZE=5>to be loaded during Windows start-up and is preferable to modifying</FONT>
<FONT SIZE=5>&quot;system.ini&quot;. The MS-DOS stub is 275 bytes of code, plus packed VxD. When run</FONT>
<FONT SIZE=5>from a MS-DOS .EXE file Memorial attempts to execute basically the same plan</FONT>
<FONT SIZE=5>as with a .COM file but this does not go to plan. Erroneous parameters passed</FONT>
<FONT SIZE=5>to the VxD unpacking code cause Memorial to go into an infinite loop, filling</FONT>
<FONT SIZE=5>up the C: drive. This effectively makes infected MS-DOS .EXE infections dead</FONT>
<FONT SIZE=5>files. When run from an infected PE files, the virus decrypts itself first.</FONT>
<FONT SIZE=5>Memorial then uses internal Windows structures to resolve address of Kernel32</FONT>
<FONT SIZE=5>procedures 'GetModuleHandleA' and 'GetProcAddress'. These functions are used</FONT>
<FONT SIZE=5>to resolve all other Kernel32 and User32 procedures. Next Memorial calls</FONT>
<FONT SIZE=5>Kernel32!GetLocalTime for its activation routine. If the date is April 10th</FONT>
<FONT SIZE=5>(both the day of Clinton Haines birth and death) Memorial calls</FONT>
<FONT SIZE=5>User32!MessageBox displaying a Message box with title:</FONT>

<FONT SIZE=5><I>Clinton Haines Memorial Virus by Quantum/VLAD and Qark/VLAD</I></FONT>

<FONT SIZE=5>and message body:</FONT>

<FONT SIZE=5><I>Clinton Haines, also known as Harry McBungus, Terminator Z and Talon</I></FONT>
<FONT SIZE=5><I>died of a drug overdose on his 21st birthday, April the 10th, 1997.</I></FONT>
<FONT SIZE=5><I>During his time as a virus writer he wrote the No Frills family, X-Fungus,</I></FONT>
<FONT SIZE=5><I>Daemon and 1984 viruses.  He was a good friend to VLAD and so we write</I></FONT>
<FONT SIZE=5><I>this virus in his honour.  We hope it's good enough to do him justice.</I></FONT>
<FONT SIZE=5><I>VLAD Remembers. Rest in Peace</I></FONT>
<FONT SIZE=5><I>R.I.P.</I></FONT>

<FONT SIZE=5>If the date is not April 10th, Memorial uses Kernel32 calls CreateFileA,</FONT>
<FONT SIZE=5>WriteFile, ReadFile, SetFilePointer, CloseHandle and LocalAlloc to unpack and</FONT>
<FONT SIZE=5>write the virus VxD to &quot;C:\CLINT.VXD&quot;, the same as MS-DOS infections. The VxD</FONT>
<FONT SIZE=5>is executed and Memorial passes control back to the PE host. PE infection stub</FONT>
<FONT SIZE=5>is 1,360 bytes + 46 byte oligomorphic decrypter When Memorials VxD is loaded,</FONT>
<FONT SIZE=5>4 control messages are handled: W32_DEVICEIOCONTROL, INIT_COMPLETE,</FONT>
<FONT SIZE=5>SYS_DYNAMIC_DEVICE_INIT and SYS_DYNAMIC_DEVICE_EXIT. In case of first message</FONT>
<FONT SIZE=5>the virus returns 0 signalling it does not want to interact with other Win32 </FONT>
<FONT SIZE=5>applications. In case of second and third message the virus runs its VxD</FONT>
<FONT SIZE=5>initialisation code. In case of the fourth message the virus returns 1 to</FONT>
<FONT SIZE=5>disallow the VxD from being unloaded. Memorials VxD initialisation code begins</FONT>
<FONT SIZE=5>by hooking DOS IFS API (Installable File System) first. This is used to catch</FONT>
<FONT SIZE=5>files to infected. Next Memorial takes retro (anti-anti-virus) action</FONT>
<FONT SIZE=5>deleting several anti-virus registry keys. From </FONT>
<FONT SIZE=5>'\System\CurrentControlSet\Services\Vxd' (statically loaded VxD drivers) it </FONT>
<FONT SIZE=5>deletes keys with values: 'VETMON95', 'VETMACRO', 'NAVAP', 'virusafe' and</FONT>
<FONT SIZE=5>'WIMMUN32'.  From '\SOFTWARE\Microsoft\Windows\CurrentVersion\Run' it deletes</FONT>
<FONT SIZE=5>keys: 'NORTON AUTO-PROTECT', 'TBAV for Windows 95',</FONT>
<FONT SIZE=5>'Anywhere Antivirus Validation', 'Vshwin32EXE' and 'ViruSafe'. From</FONT>
<FONT SIZE=5>'\SOFTWARE\McAfee\ScreenScan' it deletes 'bEnableScreenScan', 'bScanAllFiles'</FONT>
<FONT SIZE=5>and 'bScanSubDirs'. From  '\SOFTWARE\Cybec\VET Antivirus for Win32\' it</FONT>
<FONT SIZE=5>deletes 'Actions\InfectedAction', 'Actions\SuspectAction', 'Memory\Enabled',</FONT>
<FONT SIZE=5>'Resident\FileCheck', 'Resident\InfectedAction', 'Resident\SuspectAction',</FONT>
<FONT SIZE=5>'Scanning\Scan All Files', 'Scanning\Scan Type', 'Scanning\Skip Renamed',</FONT>
<FONT SIZE=5>'Scanning\Subfolders'. From this location it also sets</FONT>
<FONT SIZE=5>'Scanning\Extension List' to 'bin, dll, doc, drv, ovl, sys, dot', omitting</FONT>
<FONT SIZE=5>.COM, .EXE and .SCR. The Memorial VxD file then allocates two buffers. It</FONT>
<FONT SIZE=5>clears the attributes of CLINT.VXD and reads the file into the first buffer,</FONT>
<FONT SIZE=5>closes the file and deletes it. The unpacked VxD images is then pack into</FONT>
<FONT SIZE=5>the second buffer. When infecting .COM files Memorial checks for .COM</FONT>
<FONT SIZE=5>extension and absence of MZ header. Memorial also avoids .COM files ending</FONT>
<FONT SIZE=5>with &quot;NS&quot; - this is to avoid Windows 95 &quot;ENUNS&quot; vaccinated files. When</FONT>
<FONT SIZE=5>infecting MZ/PE files Memorial checks for .EXE or .SCR extension and</FONT>
<FONT SIZE=5>presence of MZ header. MS-DOS .COM and .EXE files are infected by fairly</FONT>
<FONT SIZE=5>standard algorithms. In the case of PE files Memorial creates a new last</FONT>
<FONT SIZE=5>section containing the virus, increases the section count and modifies the</FONT>
<FONT SIZE=5>entrypoint. The 'name' of the last section is 'CLINTON' encrypted with a</FONT>
<FONT SIZE=5>random 8-bit XOR. A checksum byte is appended to the section name to mark the</FONT>
<FONT SIZE=5>PE as infected. Memorial is oligomorphic in PE infections, capable of creating</FONT>
<FONT SIZE=5>96 46-byte long decryptors. Memorials random number generator is initialised</FONT>
<FONT SIZE=5>calling 'IFSMgr_Get_DOSTime' on EXE/SCR infections. [24] [25]</FONT>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

<a name="references">
<FONT SIZE=5><U><B>% References: %</B></U></FONT>

<FONT SIZE=5>[1] VLAD EZine Archives</FONT>
<FONT SIZE=5><A HREF="http://wiw.org/~meta/">http://wiw.org/~meta/</A></FONT>

<FONT SIZE=5>[2] Incest Family Description</FONT>
<FONT SIZE=5>VLAD Issue 1 Article.3_1</FONT>

<FONT SIZE=5>[3] Daddy Source Code</FONT>
<FONT SIZE=5>VLAD Issue 1 Article.3_2</FONT>

<FONT SIZE=5>[4] Mummy Source Code</FONT>
<FONT SIZE=5>VLAD Issue 1 Article.3_3</FONT>

<FONT SIZE=5>[5] Sister Source Code</FONT>
<FONT SIZE=5>VLAD Issue 1 Article.3_4</FONT>

<FONT SIZE=5>[6] Brother Source Code</FONT>
<FONT SIZE=5>VLAD Issue 1 Article.3_5</FONT>

<FONT SIZE=5>[7] VLAD Virus Source Code</FONT>
<FONT SIZE=5>VLAD Issue 2 Article.4_2</FONT>

<FONT SIZE=5>[8] Republic Source Code</FONT>
<FONT SIZE=5>VLAD Issue 2 Article.4_3</FONT>

<FONT SIZE=5>[9] BIOS Meningitis Source Code</FONT>
<FONT SIZE=5>VLAD Issue 2 Article.4_4</FONT>

<FONT SIZE=5>[10] Hemlock Source Code</FONT>
<FONT SIZE=5>VLAD Issue 3 Article.4_2</FONT>

<FONT SIZE=5>[11] Megastealth Source Code</FONT>
<FONT SIZE=5>VLAD Issue 3 Article.5_5</FONT>

<FONT SIZE=5>[12] Winsurfer Source Code</FONT>
<FONT SIZE=5>VLAD Issue 4 Article.4_3</FONT>

<FONT SIZE=5>[13] Good Times! Source Code</FONT>
<FONT SIZE=5>VLAD Issue 4 Article.5_3</FONT>

<FONT SIZE=5>[14] Horsa Source Code</FONT>
<FONT SIZE=5>VLAD Issue 5 Article.4_2</FONT>

<FONT SIZE=5>[15] Ph33r Source Code</FONT>
<FONT SIZE=5>VLAD Issue 5 Article.4_3</FONT>

<FONT SIZE=5>[16] VIP Source Code</FONT>
<FONT SIZE=5>VLAD Issue 6 Article.4_3</FONT>

<FONT SIZE=5>[17] VSTE/TraceVir Source Code</FONT>
<FONT SIZE=5>VLAD Issue 6 Article.5_6</FONT>

<FONT SIZE=5>[18] Gilgamesh Source Code</FONT>
<FONT SIZE=5>VLAD Issue 6 Article.4_2</FONT>

<FONT SIZE=5>[19] 386 Virus Source Code</FONT>
<FONT SIZE=5>VLAD Issue 6 Article.4_7</FONT>

<FONT SIZE=5>[20] SySta Source Code</FONT>
<FONT SIZE=5>VLAD Issue AF  Article.3_2</FONT>

<FONT SIZE=5>[21] ASMVirus Source Code</FONT>
<FONT SIZE=5>VLAD Issue AF Article.4_5</FONT>

<FONT SIZE=5>[22] Goodbye Source Code</FONT>
<FONT SIZE=5>VLAD Issue 7 Article.2_2</FONT>

<FONT SIZE=5>[23] Padania Source Code</FONT>
<FONT SIZE=5>VLAD Issue 7 Article.3_4</FONT>

<FONT SIZE=5>[24] &quot;Junkie Memorial?&quot; - Peter Szor</FONT>
<FONT SIZE=5>Virus Bulletin September 1997</FONT>
<FONT SIZE=5><A HREF="http://www.peterszor.com/memorial.pdf">http://www.peterszor.com/memorial.pdf</A></FONT>

<FONT SIZE=5>[25] Win95.Memorial Description - Peter Szor</FONT>
<FONT SIZE=5><A HREF="http://www.securelist.com/en/descriptions/58957/Virus.Win9x.Memorial">http://www.securelist.com/en/descriptions/58957/Virus.Win9x.Memorial</A></FONT></PRE>

<FONT SIZE=3><a href="#top">Back to top</a></FONT>

</BODY>
</HTML>