<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="./MATER_4_file/filelist.xml">
<title>La curatrice di questo documento non è responsabile in alcun modo del
danneggiamento di dati e sistemi che potrebbe derivare d</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Administrator</o:Author>
  <o:LastAuthor>Administrator</o:LastAuthor>
  <o:Revision>7</o:Revision>
  <o:TotalTime>38</o:TotalTime>
  <o:LastPrinted>2000-11-23T14:26:00Z</o:LastPrinted>
  <o:Created>2000-11-25T12:31:00Z</o:Created>
  <o:LastSaved>2000-12-13T10:47:00Z</o:LastSaved>
  <o:Pages>11</o:Pages>
  <o:Words>4523</o:Words>
  <o:Characters>25786</o:Characters>
  <o:Lines>214</o:Lines>
  <o:Paragraphs>51</o:Paragraphs>
  <o:CharactersWithSpaces>31667</o:CharactersWithSpaces>
  <o:Version>9.2812</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:HyphenationZone>14</w:HyphenationZone>
  <w:DrawingGridHorizontalSpacing>6 pt</w:DrawingGridHorizontalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>2</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:Compatibility>
   <w:FootnoteLayoutLikeWW8/>
   <w:ShapeLayoutLikeWW8/>
   <w:AlignTablesRowByRow/>
   <w:ForgetLastTabAlignment/>
   <w:LayoutRawTableWidth/>
   <w:LayoutTableRowsApart/>
  </w:Compatibility>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:"MS Mincho";
	panose-1:2 2 6 9 4 2 5 8 3 4;
	mso-font-alt:"\FF2D\FF33 \660E\671D";
	mso-font-charset:128;
	mso-generic-font-family:roman;
	mso-font-pitch:fixed;
	mso-font-signature:1 134676480 16 0 131072 0;}
@font-face
	{font-family:"Arial Unicode MS";
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:128;
	mso-generic-font-family:modern;
	mso-font-pitch:variable;
	mso-font-signature:-1 -369098753 63 0 4129023 0;}
@font-face
	{font-family:"\@Arial Unicode MS";
	mso-font-charset:128;
	mso-generic-font-family:modern;
	mso-font-pitch:variable;
	mso-font-signature:-1 -369098753 63 0 4129023 0;}
@font-face
	{font-family:"\@MS Mincho";
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-charset:128;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:1 134676480 16 0 131072 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{margin-right:0cm;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:24.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-font-kerning:18.0pt;
	font-weight:bold;}
h2
	{mso-style-next:Normale;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:18.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"MS Mincho";
	color:white;
	font-weight:bold;}
h3
	{mso-style-next:Normale;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:18.0pt;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"MS Mincho";
	color:white;
	font-weight:bold;}
h5
	{mso-style-next:Normale;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:5;
	font-size:14.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";
	color:white;
	font-weight:bold;}
p.MsoHeading8, li.MsoHeading8, div.MsoHeading8
	{mso-style-next:Normale;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:8;
	font-size:18.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:#CCFFFF;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 240.95pt right 481.9pt;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";}
p
	{margin-right:0cm;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Arial Unicode MS";}
pre
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Courier New";}
@page Section1
	{size:595.3pt 841.9pt;
	margin:1.0cm 1.0cm 1.0cm 2.0cm;
	mso-header-margin:36.0pt;
	mso-footer-margin:36.0pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
@list l0
	{mso-list-id:1043751591;
	mso-list-type:hybrid;
	mso-list-template-ids:-468810070 68157455 68157465 68157467 68157455 68157465 68157467 68157455 68157465 68157467;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1027">
  <o:colormru v:ext="edit" colors="#000082,#000078"/>
  <o:colormenu v:ext="edit" fillcolor="#000078"/>
 </o:shapedefaults></xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body bgcolor="#000078" lang=IT link=blue vlink=purple style='tab-interval:
35.4pt'>

<div class=Section1>

<p class=MsoPlainText align=center style='text-align:center'><b><span
style='font-size:36.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:red'>M</span></b><b><span style='font-size:36.0pt;mso-bidi-font-size:
10.0pt;font-family:"Times New Roman";mso-fareast-font-family:"MS Mincho";
mso-bidi-font-family:"Courier New";color:#CCFFFF'>inima </span></b><b><span
style='font-size:36.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:red'>A</span></b><b><span style='font-size:36.0pt;mso-bidi-font-size:
10.0pt;font-family:"Times New Roman";mso-fareast-font-family:"MS Mincho";
mso-bidi-font-family:"Courier New";color:#CCFFFF'>nonyma </span></b><b><span
style='font-size:36.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:red'>T</span></b><b><span style='font-size:36.0pt;mso-bidi-font-size:
10.0pt;font-family:"Times New Roman";mso-fareast-font-family:"MS Mincho";
mso-bidi-font-family:"Courier New";color:#CCFFFF'>abularia </span></b><b><span
style='font-size:36.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:red'>E</span></b><b><span style='font-size:36.0pt;mso-bidi-font-size:
10.0pt;font-family:"Times New Roman";mso-fareast-font-family:"MS Mincho";
mso-bidi-font-family:"Courier New";color:#CCFFFF'>x </span></b><b><span
style='font-size:36.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:red'>R</span></b><b><span style='font-size:36.0pt;mso-bidi-font-size:
10.0pt;font-family:"Times New Roman";mso-fareast-font-family:"MS Mincho";
mso-bidi-font-family:"Courier New";color:#CCFFFF'>eti<o:p></o:p></span></b></p>

<p class=MsoNormal align=center style='margin-left:18.0pt;text-align:center'><i><span
style='font-size:11.0pt;mso-bidi-font-size:12.0pt;mso-fareast-font-family:"MS Mincho";
color:#99CCFF'>nihil vacuum neque sine signo apud </span></i><i><span
style='font-size:11.0pt;mso-bidi-font-size:12.0pt;mso-fareast-font-family:"MS Mincho";
color:#CCFFCC'>MATER</span></i><i><span style='font-size:11.0pt;mso-bidi-font-size:
12.0pt;mso-fareast-font-family:"MS Mincho";color:#99CCFF'><o:p></o:p></span></i></p>

<h3><a name="_Ref500557024">Liber Quartus</a></h3>

<p class=MsoNormal align=center style='margin-left:18.0pt;text-align:center'><i><span
style='mso-fareast-font-family:"MS Mincho";color:white'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></i></p>

<p class=MsoNormal align=center style='margin-left:18.0pt;text-align:center'><i><span
style='mso-fareast-font-family:"MS Mincho";color:white'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></i></p>

<h2 style='margin-top:0cm;margin-right:30.0pt;margin-bottom:0cm;margin-left:
54.0pt;margin-bottom:.0001pt;text-align:justify'><span style='font-size:9.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial;font-weight:normal'>Salve, vera
Turingus proles. <o:p></o:p></span></h2>

<h2 style='margin-top:0cm;margin-right:30.0pt;margin-bottom:0cm;margin-left:
54.0pt;margin-bottom:.0001pt;text-align:justify'><span style='font-size:9.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial;font-weight:normal'>Questa è la
zine ufficiale di Familia, un gruppo che ha come oggetto di studio la
programmazione virale.<o:p></o:p></span></h2>

<h2 style='margin-top:0cm;margin-right:30.0pt;margin-bottom:0cm;margin-left:
54.0pt;margin-bottom:.0001pt;text-align:justify'><span style='font-size:9.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial;font-weight:normal'>MATER ha come
scopo l’esame delle tecniche di programmazione virale e delle problematiche ad
esse associate. MATER è una raccolta di contributi volontari (e non) di alcuni
code-writers del pianeta, in lingua italiana ed è rivolta soprattutto a chi si
avvicina per la prima volta al mondo dei virus e necessita dei concetti di base
che spesso sono dati per scontati nelle zines reperibili in Rete. Non è,
tuttavia, una esemplificazione discorsiva priva di contenuto tecnico: per
comprendere gli esempi ivi contenuti è necessaria una minima conoscenza
dell’architettura di un elaboratore e del linguaggio assembler.<o:p></o:p></span></h2>

<h2 style='margin-top:0cm;margin-right:30.0pt;margin-bottom:0cm;margin-left:
54.0pt;margin-bottom:.0001pt;text-align:justify'><span style='font-size:9.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial;font-weight:normal'>E’ nostra
convinzione che una migliore conoscenza delle metodologie infettive digitali
sia la principale strada per accrescere la sicurezza degli utenti e fornire un
contributo a chi opera nel settore della programmazione. Ritenendo il vero
nemico della sicurezza la disinformazione, auspichiamo che una più profonda
comprensione in questo campo dissipi i dubbi, aiuti la ricerca e contribuisca
al progresso dell’educazione informatica. Sursum Corda !<span
style="mso-spacerun: yes">  </span><o:p></o:p></span></h2>

<p class=MsoNormal style='margin-top:0cm;margin-right:30.0pt;margin-bottom:
0cm;margin-left:54.0pt;margin-bottom:.0001pt'><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:30.0pt;margin-bottom:
0cm;margin-left:54.0pt;margin-bottom:.0001pt'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<h5 style='margin-top:0cm;margin-right:30.0pt;margin-bottom:0cm;margin-left:
54.0pt;margin-bottom:.0001pt'><span style='font-size:16.0pt;mso-bidi-font-size:
12.0pt'>ATTENZIONE<o:p></o:p></span></h5>

<p class=MsoNormal style='margin-top:0cm;margin-right:30.0pt;margin-bottom:
0cm;margin-left:54.0pt;margin-bottom:.0001pt;text-align:justify'><span
style='font-family:Arial;color:white'>Questa pubblicazione contiene
informazioni e codice sorgente relativi alla sicurezza informatica. </span><span
style='font-family:Arial;mso-fareast-font-family:"MS Mincho";color:white'>Lo
scopo di queste informazioni è di aiutare gli utenti ad accrescere la propria
capacità di programmazione. Questo materiale è a puro scopo didattico e non
include codice distruttivo né documenti attinenti ad alcuna attività illegale.
Si declina ogni responsabilità nel caso chiunque utilizzi le suddette
informazioni per creare, compilare e diffondere intenzionalmente programmi
diretti a danneggiare o interrompere un sistema informatico o telematico,
ovvero a provocarne l'interruzione, totale o parziale, o l'alterazione del suo
funzionamento <i>Art. 615-quinquies (Legge n. 547/93 pubblicata in Gazzetta Ufficiale
n. 305 del 30.12.1993)</i></span><span style='font-family:Arial'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify'><span style='font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;
font-family:"Times New Roman";mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify'><span style='color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoHeading8><b><span style='color:silver'><span style="mso-spacerun:
yes"> </span></span></b><b><span lang=FR style='color:silver;mso-ansi-language:
FR'>§ MATER</span></b><span lang=FR style='color:silver;mso-ansi-language:FR'>
Liber Quartus <b>§</b><o:p></o:p></span></p>

<p class=MsoNormal><span lang=FR style='mso-fareast-font-family:"MS Mincho";
mso-ansi-language:FR'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b><span lang=EN-US
style='font-size:16.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
color:#FFCC00;mso-ansi-language:EN-US'>indice<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-left:36.0pt;text-align:justify;text-indent:
-18.0pt;mso-list:l0 level1 lfo2;tab-stops:list 36.0pt'><![if !supportLists]><span
lang=EN-US style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
color:#CCFFFF;mso-ansi-language:EN-US'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;
font-family:"Times New Roman";color:#CCFFFF'><a href="#_1._API"><span
lang=EN-US style='color:#CCFFFF;mso-ansi-language:EN-US'>API</span></a></span><span
lang=EN-US style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
color:#CCFFFF;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:36.0pt;text-align:justify;text-indent:
-18.0pt;mso-list:l0 level1 lfo2;tab-stops:list 36.0pt'><![if !supportLists]><span
lang=EN-US style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
color:#CCFFFF;mso-ansi-language:EN-US'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;
font-family:"Times New Roman";color:#CCFFFF'><a href="#_2._Hello_world"><span
lang=EN-US style='color:#CCFFFF;mso-ansi-language:EN-US'>Hello World !</span></a></span><span
lang=EN-US style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
color:#CCFFFF;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:36.0pt;text-align:justify;text-indent:
-18.0pt;mso-list:l0 level1 lfo2;tab-stops:list 36.0pt'><![if !supportLists]><span
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
color:#CCFFFF'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;
font-family:"Times New Roman";color:#CCFFFF'><a href="#_4._Alcuni_concetti"><span
style='color:#CCFFFF'>Alcuni concetti</span></a><o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:36.0pt;text-align:justify;text-indent:
-18.0pt;mso-list:l0 level1 lfo2;tab-stops:list 36.0pt'><![if !supportLists]><b><span
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
color:#CCFFFF'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><![endif]><span style='font-size:12.0pt;mso-bidi-font-size:
10.0pt;font-family:"Times New Roman";color:#CCFFFF'><a href="#_5._il_KERNEL32"><span
style='color:#CCFFFF'>5. il KERNEL32</span></a><b><o:p></o:p></b></span></p>

<p class=MsoPlainText style='margin-left:36.0pt;text-align:justify;text-indent:
-18.0pt;mso-list:l0 level1 lfo2;tab-stops:list 36.0pt'><![if !supportLists]><b><span
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
color:#CCFFFF'>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><![endif]><span style='font-size:12.0pt;mso-bidi-font-size:
10.0pt;font-family:"Times New Roman";color:#CCFFFF'><a
href="#_6._Indirizzi_delle"><span style='color:#CCFFFF'>Gli indirizzi delle API</span></a><b><o:p></o:p></b></span></p>

<p class=MsoPlainText style='text-align:justify'><b><i><span style='font-size:
16.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></i></b></p>

<h1><a name="_1._API"></a><span style='font-size:14.0pt;mso-bidi-font-size:
24.0pt;mso-fareast-font-family:"MS Mincho";color:red'>1. API<o:p></o:p></span></h1>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'>Uno dei
cambiamenti più bruschi è tuttavia il passaggio dalle chiamate alle funzioni
del buon vecchio INT21 alle API (Application Program Interface). Cosa sono le API
? Sono delle funzioni che, come dice il loro nome, provvedono a fare un po’ di
tutto. Parlare di API è un po’ come stuzzicare un balena: se cominciassi a
farlo dovrei scrivere un’enciclopedia. Le API sono centinaia. Tanto per darvene
un’idea, ecco le API che trattano le operazioni sui files:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>_hread<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>_hwrite<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>_lclose<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>_lcreat<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>_llseek<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>_lopen<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>_lread<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>_lwrite<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>AreFileApisANSI<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>CopyFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>CreateDirectory<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>CreateDirectoryEx<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>CreateFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>CreateIoCompletionPort<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>DefineDosDevice<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>DeleteFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>FileIOCompletionRoutine<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>FindClose<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>FindCloseChangeNotification<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>FindFirstChangeNotification<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>FindFirstFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>FindNextChangeNotification<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>FindNextFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>FlushFileBuffers<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetBinaryType<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetCurrentDirectory<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetDiskFreeSpace<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetDriveType<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetFileAttributes<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetFileInformationByHandle<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetFileSize<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetFileType<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetFullPathName<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetLogicalDrives<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetLogicalDriveStrings<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetQueuedCompletionStatus<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetShortPathName<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetTempDrive<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetTempFileName<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetTempPath<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>GetVolumeInformation<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>LockFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>LockFileEx<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>MoveFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>MoveFileEx<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>OpenFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>QueryDosDevice<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>ReadFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>ReadFileEx<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>RemoveDirectory<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>SearchPath<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>SetCurrentDirectory<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>SetEndOfFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>SetFileApisToANSI<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>SetFileApisToOEM<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>SetFileAttributes<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>SetFilePointer<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>SetHandleCount<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>SetVolumeLabel<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>UnlockFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>UnlockFileEx<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>WriteFile<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>WriteFileEx<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'>Come potete vedere
siamo ad anni luce di distanza dalle operazioni che eravamo abituati a vedere
con il vecchio INT21. Con questo non voglio dire che il sistema degli interrupt
è sparito. Tutt’altro. Ne avremo modo di riparlarne. Vorrei solo farvi capire
che, se vogliamo studiare del codice che lavora in ambiente win32, dobbiamo
fare i conti con queste benedette API (consiglio vivamente di reperire l’help
ufficiale API, circa 8 Mbytes, ma ne vale la pena).<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h1><a name="_2._Hello_world"></a><span style='font-size:14.0pt;mso-bidi-font-size:
24.0pt;mso-fareast-font-family:"MS Mincho";color:red'>2. Hello world !<o:p></o:p></span></h1>

<p class=MsoPlainText style='text-align:justify'><b><span style='font-size:
12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Ora un tipico
esempio, che rimane sempre un classico. Proviamo a scrivere il programma
&quot;Hello world!&quot; .<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>E’ molto
semplice. Useremo la funzione API &quot;MessageBoxA&quot; , definita con il
comando &quot;extrn&quot; command, inserire i parametri e chiamare la funzione
stessa Le stringhe del messaggio devono essere ASCIIZ (ASCII,0) e che i
parametri vanno inseriti in ordine inverso:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'>.386<span
style="mso-spacerun: yes">                                 </span>; Processore
(386+)<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'>.model
flat<span style="mso-spacerun: yes">                          </span>; Usiamo
registri a 32 bit<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>extrn<span style="mso-spacerun:
yes">          </span>ExitProcess:proc<span style="mso-spacerun: yes">    
</span>; le API che usiamo<span style="mso-spacerun: yes">           </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>extrn<span style="mso-spacerun:
yes">          </span>MessageBoxA:proc<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>Con la direttiva &quot;extrn&quot; indichiamo
l’API che useremo nel programma. ExitProcess è una API usata per ritornare il
controllo al sistema operativo. MessageBoxA è usata per emettere un messaggio
sullo schermo.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>.data<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>szMessage<span style="mso-spacerun:
yes">       </span>db<span style="mso-spacerun: yes">      </span>&quot;Hello
World!&quot;,0<span style="mso-spacerun: yes">            </span>; Messaggio
per MsgBox<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>szTitle<span style="mso-spacerun:
yes">         </span>db<span style="mso-spacerun: yes">      </span>&quot;in
ambiente Win32&quot;,0<span style="mso-spacerun: yes">       </span>; Titolo
del MsgBox<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>(Ricordiamo che
TASM non assembla se non inseriamo almeno un dato)<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'>.code<span
style="mso-spacerun: yes">                    </span>; da qui il codice<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'>HelloWorld:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">               
</span>push<span style="mso-spacerun: yes">    </span>00000000h<span
style="mso-spacerun: yes">               </span>; Stile della MessageBox<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">               
</span></span></b><b style='mso-bidi-font-weight:normal'><span
style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'>push<span
style="mso-spacerun: yes">    </span>offset szTitle<span style="mso-spacerun:
yes">          </span>; Titolo del MessageBox<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">                </span>push<span style="mso-spacerun:
yes">    </span>offset szMessage<span style="mso-spacerun: yes">       
</span>; Il messaggio<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">                </span>push<span style="mso-spacerun:
yes">    </span>00000000h<span style="mso-spacerun: yes">              
</span>; Handle proprietario<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">                </span>call<span style="mso-spacerun:
yes">    </span>MessageBoxA<span style="mso-spacerun: yes">            
</span>; API <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>I campi in
entrata delle funzioni sono:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span></span><span lang=EN-US style='font-size:
12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC;mso-ansi-language:
EN-US'>int MessageBox(<span style="mso-spacerun:
yes">                                                          </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">  
</span>HWND hWnd,<span style="mso-spacerun: yes">              </span>// handle
of owner window<span style="mso-spacerun: yes">                         
</span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">  
</span>LPCTSTR lpText,<span style="mso-spacerun: yes">         </span>//
address of text in message box<span style="mso-spacerun: yes">                
</span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">  
</span>LPCTSTR lpCaption,<span style="mso-spacerun: yes">    </span>// address
of title of message box<span style="mso-spacerun: yes">                </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">  
</span>UINT uType<span style="mso-spacerun: yes">                 </span>//
style of message box<span style="mso-spacerun: yes">            </span><span
style="mso-spacerun: yes">                </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> 
</span>);<span style="mso-spacerun:
yes">                                                                     
</span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">     
</span></span><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;mso-ansi-language:
EN-US'><span style="mso-spacerun: yes">             </span>push<span
style="mso-spacerun: yes">    </span>00000000h<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">               
</span>call<span style="mso-spacerun: yes">    </span>ExitProcess<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";color:#CCFFCC;mso-ansi-language:EN-US;
mso-bidi-font-weight:bold'>e:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun:
yes"> </span>VOID ExitProcess(<span style="mso-spacerun:
yes">                                                        </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">    
</span>UINT uExitCode<span style="mso-spacerun: yes">      </span>// exit code
for all threads<span style="mso-spacerun: yes">           </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> 
</span></span><span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;
font-family:"Times New Roman";mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:
"Courier New";color:#CCFFCC'>);<span style="mso-spacerun:
yes">                                                                     
</span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>end HelloWorld<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b><span style='font-size:
12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>3. Rings<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Il processore ha
4 livelli di privilegi: Ring-0, Ring-1, Ring-2 and Ring-3, l’ultimo dei quali,
il livello utente, è il più restrittivo. Ring-0 è il paradiso del virus coder,
essendo quello che permette la massima libertà di azione. Il DOS, con i suoi
interrupt, era Ring-0. <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Dunque Ring-3 è
lo&quot;user level”. La maggior parte dei virus per Win32, per ora, utilizzano
Ring-3. Ring-0 è il livello che il kernel usa per il suo codice, il
&quot;kernel level”. Qui il programmatore può accedere alle porte ed al altre
cosine. a Ring-0 si può accedere usando uno dei trucchi attualmente conosciuti,
come la IDT<span style="mso-spacerun: yes">  </span>modification, la tecnica
&quot;Call Gate&quot; che SoPinKy/29A mostra<span style="mso-spacerun: yes"> 
</span>29A#3, o il VMM inserting, tecnica usata nel virus Padania o in Fuck
Harry. Qui i programmatori non hanno bisogno delle API, dato che utilizzano i servizi
VxD. Studieremo, più oltre, queste tecniche.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h1><a name="_4._Alcuni_concetti"></a><span style='font-size:14.0pt;mso-bidi-font-size:
24.0pt;mso-fareast-font-family:"MS Mincho";color:red'>4. Alcuni concetti<o:p></o:p></span></h1>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:
"Times New Roman";mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:
"Courier New";color:#CCFFFF'>Selettori<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'>Che cos’è un
selettore ? E’ un segmento molto grande, che forma la memoria di Win32,
chiamata anche<span style="mso-spacerun: yes">  </span>flat memory. Qui
possiamo indirizzare 4 Gigabytes di memoria (4.294.967.295 bytes), solo usando
offsets di 32 bit. Vediamo come è organizzata questa memoria:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>-------------------------------------------
OFFSET = 00000000h &lt;-&gt; 3FFFFFFFh<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">   
</span>Application Code And Data<span style="mso-spacerun:
yes">                               </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>-------------------------------------------
OFFSET = 40000000h &lt;-&gt; 7FFFFFFFh<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">    
</span><span style="mso-spacerun: yes">     </span>Shared Memory<span
style="mso-spacerun: yes">                     </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=DE
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:DE'>-------------------------------------------
OFFSET = 80000000h &lt;-&gt; BFFFFFFFh<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=DE
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:DE'><span style="mso-spacerun:
yes">              </span>Kernel<span style="mso-spacerun:
yes">                         </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=DE
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:DE'><span style="mso-spacerun: yes"> </span></span><span
lang=EN-US style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'>------------------------------------------
OFFSET = C0000000h &lt;-&gt; FFFFFFFFh<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'><span style="mso-spacerun:
yes">          </span>Device Driverz<span style="mso-spacerun:
yes">                     </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span></span><span
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF'>------------------------------------------ Risultato: abbiamo 4
Giga di memoria utilizzabile.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'>NOTA: WinNT tiene
le ultime due sezioni separate dalle prime due.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:
"Times New Roman";mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:
"Courier New";color:#CCFFFF'>VA:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'>sta per indirizzo
virtuale (Virtual<span style="mso-spacerun: yes">  </span>Address). E’ l’indirizzo
di un oggetto in memoria (ricordiamo che in Windows gli oggetti non sono
esattamente uguali in memoria e su disco).<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:
"Times New Roman";mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:
"Courier New";color:#CCFFFF'>RVA:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><span
style="mso-spacerun: yes"> </span>sta per indirizzo virtuale relativo (Relative
Virtual Address). E’ l’ offset<span style="mso-spacerun: yes">  </span>di
qualcosa relativo a dove il file è mappato in memoria (is memory- mapped) (dal
sistema o dall’utente).<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:
"Times New Roman";mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:
"Courier New";color:#CCFFFF'>RAW Data:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'>è il nome che
useremo per i dati fisicamente presenti su disco e come esattamente si
presentano su disco (dati disco != dati ram).<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:
"Times New Roman";mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:
"Courier New";color:#CCFFFF'>Virtual Data:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'>è il nome che diamo
ai dati quando vengono caricati in memoria dal loader del sistema.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:
"Times New Roman";mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:
"Courier New";color:#CCFFFF'>File Mapping:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><span
style="mso-spacerun: yes"> </span>Tecnica, implementata in tutti gli ambienti
Win32, che consiste nella manipolazione dei files più veloce ed economica.
Tutto quello che modifichiamo in memoria viene automaticamente anche modificato
su disco. Il File Mapping è anche il solo modo er scambiare informazioni tra
processi che lavorano in un ambiente Win32.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h1><a name="_5._il_KERNEL32"></a><span style='font-size:14.0pt;mso-bidi-font-size:
24.0pt;mso-fareast-font-family:"MS Mincho";color:red'>5. il KERNEL32<o:p></o:p></span></h1>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'>Quando eseguiamo
un’applicazione, il codice è chiamato da una parte del codice del KERNEL32 (per
la verità è come se il KERNEL facesse una CALL al nostro codice). Quando viene
effettuata una chiamata, l’indirizzo di ritorno è deposto nello stack (che in
memoria è ESP). Vediamo un esempio pratico:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span>.586p<span style="mso-spacerun:
yes">                          </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">  </span><span style="mso-spacerun:
yes">      </span>.model<span style="mso-spacerun: yes">  </span>flat<span
style="mso-spacerun: yes">                    </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span>.data<span style="mso-spacerun:
yes">                           </span>; necessario per TASM32/TLINK32<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'>db<span style="mso-spacerun: yes">      </span>?<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span>.code<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span>start:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFFF'>mov<span style="mso-spacerun: yes">     </span>eax,[esp]<span
style="mso-spacerun: yes">               </span>; ora EAX dovrebbe essere
BFF8XXXXh (se w9X)<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span><span style="mso-spacerun:
yes">                                </span>; da qualche parte l’API
CreateProcess<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'>ret<span style="mso-spacerun:
yes">                             </span>; Return <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'>end<span style="mso-spacerun: yes">    </span>start<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'>Noi abbiamo in
EAX un valore del tipo BFF8XXXX (XXXX non è importante. La piattaforma Win32
usualmente arrotonda superiormente tutto ad una pagina, così noi possiamo
cercare all’inizio di ogni pagina, così l’header KERNEL32 è all’inizio di una
pagina, noi possiamo facilmente verificarlo. Quando troviamo l’header PE, noi
conosciamo l’indirizzo di base del KERNEL32. Come limite dovremmo stabilire 50h
pagine<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'>.586p<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>.model<span style="mso-spacerun: yes">  </span>flat<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span>extrn<span
style="mso-spacerun: yes">  </span>ExitProcess:PROC<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFFF'>.data<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes"> </span>limit<span style="mso-spacerun: yes"> 
</span>equ<span style="mso-spacerun: yes">     </span>5<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span>db<span style="mso-spacerun:
yes">      </span>0<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'>;------------------------------------<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'>; dati
non utilizzati<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'>;------------------------------------<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span>.code<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span>test:<span
style="mso-spacerun: yes">       </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>call<span style="mso-spacerun: yes">    </span>delta<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span>delta:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>pop<span style="mso-spacerun: yes">     </span>ebp<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>sub<span style="mso-spacerun: yes">     </span>ebp,offset delta<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFFF'>mov<span style="mso-spacerun: yes">     </span>esi,[esp]<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'>and<span style="mso-spacerun: yes">    
</span>esi,0FFFF0000h<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>call<span style="mso-spacerun: yes">    </span>GetK32<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>push<span style="mso-spacerun: yes">    </span>00000000h<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>call<span style="mso-spacerun: yes">    </span>ExitProcess<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'>Il primo blocco di
istruzioni è per ricavare il delta offset (già spiegato in<span
style="mso-spacerun: yes">    </span>T_4). Nel secondo blocco noi mettiamo in
ESI l’indirizzo dal quale la nostra applicazione è chiamata, che è l’indirizzo
mostrato da ESP (se non tocchiamo lo stack dopo aver caricato il programma). La
seconda istruzione AND è per ricavare l’inizio della pagina da cui il nostro
codice è stato chiamato. Noi chiamiamo la nostra routine, quindi terminiamo il
processo.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes"> </span>GetK32:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes"> </span>__1:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span>cmp<span style="mso-spacerun:
yes">     </span>byte ptr [ebp+K32_Limit],00h<span style="mso-spacerun: yes">  
</span>; oltrepassiamo i limiti?<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'>jz<span style="mso-spacerun: yes">     
</span>WeFailed<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>cmp<span style="mso-spacerun: yes">     </span>word ptr
[esi],&quot;ZM&quot;<span style="mso-spacerun: yes">             </span>; ZM
file ? <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFFF'>jz<span style="mso-spacerun: yes">      </span>CheckPE<span
style="mso-spacerun: yes">                         </span>; Ok passa oltre<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes"> </span>__2:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span>sub<span style="mso-spacerun:
yes">     </span>esi,10000h<span style="mso-spacerun:
yes">                      </span>; togliamo 10 pagine<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'>dec<span style="mso-spacerun: yes">     </span>byte
ptr [ebp+K32_Limit]<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFFF'>jmp<span style="mso-spacerun: yes">     </span>__1<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'>Per prima cosa
verifichiamo se oltrepassiamo il nostro limite (50<span style="mso-spacerun:
yes">  </span>pagine). Poi controlliamo se all’inizio della pagina (come
dovrebbe essere) ci sono i caratteri MZ. Se ci sono andiamo a controllare se
siamo in un header PE. Altrimenti sottraiamo 10 pagine (10000h bytes),
decrementiamo la variabile del limite e cerchiamo di nuovo.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes"> </span>CheckPE:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span>mov<span style="mso-spacerun:
yes">     </span>edi,[esi+3Ch]<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span>add<span style="mso-spacerun:
yes">     </span>edi,esi<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span>cmp<span style="mso-spacerun:
yes">     </span>dword ptr [edi],&quot;EP&quot;<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span>jz<span style="mso-spacerun:
yes">      </span>WeGotK32<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes">        </span>jmp<span style="mso-spacerun:
yes">     </span>__2<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'><span
style="mso-spacerun: yes"> </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'>WeFailed:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>mov<span style="mso-spacerun: yes">     </span>esi,0BFF70000h<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span>WeGotK32:<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>xchg<span style="mso-spacerun: yes">    </span>eax,esi<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span>ret<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span>K32_Limit<span
style="mso-spacerun: yes">      </span>dw<span style="mso-spacerun: yes">     
</span>limit<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF;mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span></span><span
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFFF'>Leggiamo il valore all’offset 3Ch dall’header MZ<span
style="mso-spacerun: yes">  </span>(prendendo l’indirizzo RVA da dove comincia
l’header<span style="mso-spacerun: yes">  </span>PE), normalizziamo questo
valore con l’indirizzo della pagina e se a questo indirizzo troviamo i
caratteri PE, abbiamo trovato quello che cerchiamo.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><span
style="mso-spacerun: yes"> </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFFF'>end<span
style="mso-spacerun: yes">     </span>test<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFFF'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h1><a name="_6._Indirizzi_delle"></a><span style='font-size:14.0pt;mso-bidi-font-size:
24.0pt;mso-fareast-font-family:"MS Mincho";color:red'>6. Indirizzi delle API<o:p></o:p></span></h1>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Quando indichiamo
una funzione API come extern il file import32.lib ci fornisce l’indirizzo della
funzione ed essa è assemblata nel codice. Tuttavia c’è un problema quando
scriviamo un programma che debba utilizzare tali API. Se noi
“hard-codifichiamo” (hardcode) – nome che diamo quando usiamo un indirizzo
assoluto per chiamare una API – probabilmente accadrà che tale indirizzo non
lavorerà nella prossima versione di Win32.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Cosa potremmo
fare ? Esiste una funzione, GetProcAddress, che ritorna l’offset dell’API
desiderata. Purtroppo GetProcAddress è un’API a sua volta, e quindi non
possiamo ricavare il suo indirizzo corretto.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Ci sono varie
possibilità. ne elenchiamo due:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>1. Cercare GetProcAddress nella tabella di
Exports;<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>2. Quando infettiamo un file, cercare nelle
funzioni importate GetProcAddress.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Il metodo più
facile è la seconda, e sarà quello che illustreremo.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Se diamo
un’occhiata al formato dell’header PE, troviamo all’offset 78h (dell’header)
l’RVA della tabella di exports. Noi abbiamo bisogno di prendere l’indirizzo
della tabella exports del kernel. Per Windows 95/98, il kernel è all’offset
0BFF70000h, e in Windows NT il kernel sembra essere a 077F00000h.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>In Win2k lo troviamo all’offset 077E00000h.
Così, prima di tutto dobbiamo caricare il suo indirizzo nel registro che utilizzeremo
come puntatore. Raccomandiamo di usare ESI, perché possiamo ottimizzare del
codice con l’istruzione LODSD. Quindi controlliamo se<span style="mso-spacerun:
yes">  </span>nell’indirizzo puntato abbiamo l’usuale “MZ” (ricordiamo che
Intel<span style="mso-spacerun: yes">  </span>mantiene i dati rovesciati), dato
che kernel è una libreria DLL, e le librerie hanno l’header PE. Dopodiché
cerchiamo all’offset image_base+[3Ch] (= offset dove il<span
style="mso-spacerun: yes">  </span>the kernel<span style="mso-spacerun: yes"> 
</span>è locato + indirizzo contenuto dall’header PE del KERNEL' a 3Ch), ed
effettuiamo il controllo dei caratteri &quot;PE\0\0&quot;, (PE signature).<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Se tutto è a
posto, procediamo. Abbiamo bisogno dell’RVA della tabella degli export. Lo
troviamo all’offset 78h del PE header. Lo prendiamo ma, come sappiamo, l’RVA
(Relative Virtual Address), come indica il nome, è un indirizzo relativo ad un offset,
in questo caso l’image<span style="mso-spacerun: yes">  </span>base del kernel.
Per “normalizzare” l’indirizzo RVA sommiamo l’offset del kernel al valore
trovato del RVA. In questa maniera siamo nella tabella degli export.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Diamogli
un’occhiata:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>-------------------------------------------
+00000000h <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes">           </span>Export Flags<span
style="mso-spacerun: yes">                  </span>Size : 1 DWORD<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>-------------------------------------------
+00000004h <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        
</span>Time/Date stamp<span style="mso-spacerun: yes">                        
</span>Size : 1 WORD<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>-------------------------------------------
+00000006h <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        
</span><span style="mso-spacerun: yes"> </span>Major version<span
style="mso-spacerun: yes">                             </span>Size : 1 WORD<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>-------------------------------------------
+00000008h<span style="mso-spacerun: yes">  </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun:
yes">          </span>Minor version<span style="mso-spacerun:
yes">                             </span>Size : 1 DWORD<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>-------------------------------------------
+0000000Ch<span style="mso-spacerun: yes">  </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun:
yes">          </span>Name RVA<span style="mso-spacerun:
yes">                                </span>Size : 1 DWORD<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>-------------------------------------------
+00000010h<span style="mso-spacerun: yes">  </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">  
</span>Number Of Exported Functions<span style="mso-spacerun: yes">        
</span>Size : 1 DWORD<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>-------------------------------------------
+00000014h <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">  
</span>Number Of Exported Names<span style="mso-spacerun: yes">            
</span>Size : 1 DWORD<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>-------------------------------------------+00000018h
<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">  
</span>Export Address Table RVA<span style="mso-spacerun: yes">              
</span>Size : 1 DWORD<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>-------------------------------------------
+0000001Ch <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> 
</span>Export Name Pointers Table RVA<span style="mso-spacerun: yes">      
</span>Size : 1 DWORD<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>--------------------------------------------
+00000020h <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes">     
</span>Export Ordinals RVA<span style="mso-spacerun: yes">             
</span>Size : 1 DWORD<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>--------------------------------------------<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun:
yes">                                                 </span>Totale 24h BYTES<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Per noi sono importanti
gli ultimi sei campi. I valori di Address Table RVA, Name Pointers RVA e
Ordinals RVA sono relativi all’indirizzo della base del KERNEL32. Così, il
primo passo per ottenere un indirizzo API consiste nel conoscere la posizione
che quell’API occupa. La via più semplice per saperlo è di cercare
all’offset<span style="mso-spacerun: yes">  </span>indicato da Name Pointers,
confrontare la stringa con il nome dell’API che cerchiamo, e se uguale ne
calcoliamo l’offset.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>A questo punto
avremo un valore nel contatore, che dobbiamo incrementare ogni volta che
controlliamo il nome di una API. Questo contatore avrà il numero dell’API
richiesta. Il contatore dovrebbe essere una<span style="mso-spacerun: yes"> 
</span>word o una dword,<span style="mso-spacerun: yes">  </span>ma non un
byte, perché le API sono più di 255 )<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>NOTA Si assume che si sia salvato nelle
variabili corrispondenti il VA (RVA+kernel image base) dell’indirizzo, del nome
e<span style="mso-spacerun: yes">  </span>dell’Ordinal tables.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Immaginiamo di
avere il nome dell’API desiderata, così abbiamo nel contatore la posizione che
essa occupa nella Name Pointers table. Noi prendiamo il valore del contatore e
con esso andiamo a cercare nella Ordinal Table (un array di<span
style="mso-spacerun: yes">  </span>dwords) l’ordinale della API che vogliamo.
Una volta ottenuto il numero ‘dordine che la API occupa nell’array, dobbiamo
moltiplicare tale valore per 2 (si rammenta che l’array di ordinali è
costituito da words, così noi dobbiamo effettuare il calcolo per lavorare con
words...), e<span style="mso-spacerun: yes">  </span>naturalmente aggiungere ad
esso l’offset dell’inizio della tabella degli ordinali (beginning offset).<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Per riassumere
quanto è stato esposto, si consideri la seguente formula:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>locazione API Ordinale: ( contatore * 2 ) +
Ordinal Table VA<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Il passo
successivo consiste<span style="mso-spacerun: yes">  </span>nel ricavare
l’indirizzo definitivo della API dalla Address Table. Noi abbiamo già
l’ordinale dell’API. Noi dobbiamo solo moltiplicare l’ordinale per 4 (date che
l’array di indirizzi è formato da dwords invece che words, e la misura di una
dword è 4), e sommare ad esso l’offset dell’inizio della Address<span
style="mso-spacerun: yes">  </span>Table, come abbiamo fatto prima con la
tabella degi ordinali. Ed infine abbiamo l’RVA dell’API<span
style="mso-spacerun: yes">  </span>cercata. L’ultima operazione è quella di
normalizzare l’indirizzo ottenuto aggiungendogli offset del kernel, ed è fatta.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>indirizzo API: (
API's Ordinale * 4 ) + indirizzo Table VA + KERNEL32 imagebase<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>---------------------------------------
dato che ricaviamo la posizione che la stringa occupa nella Name Table,<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes">  </span>EntryPoint<span style="mso-spacerun:
yes">     </span>Ordinal<span style="mso-spacerun: yes">    </span>Name<span
style="mso-spacerun: yes">             </span>noi possiamo sapere il suo
ordinale (ogni nome di API ha un <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun:
yes">                                                           
</span>ordinale chel è nella stessa posizione del nome della API), e<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>00005090<span style="mso-spacerun: yes">    
</span>0001<span style="mso-spacerun: yes">   </span>AddAtomA<span
style="mso-spacerun: yes">         </span>conoscendo l’ordinale possiamo saere
il suo indirizzo e il suo RVA<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun:
yes">                                                            </span>di
entrypoint. Normalizzaiamo questo valore ed otteniamo quello<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes">  </span>00005100<span style="mso-spacerun: yes">   
</span>0002<span style="mso-spacerun: yes">   </span>AddAtomW<span
style="mso-spacerun: yes">        </span>di cui abbiamo bisogno, l’indirizzo
API cercato.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun:
yes">                                                           </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes">  </span>00025540<span style="mso-spacerun: yes">   
</span>0003<span style="mso-spacerun: yes">  </span>AddConsoleAliasA<span
style="mso-spacerun: yes">  </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun:
yes">                                                          </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes">  </span>00025500<span style="mso-spacerun: yes">   
</span>0004<span style="mso-spacerun: yes">  </span>AddConsoleAliasW<span
style="mso-spacerun: yes">  </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes">   </span>……..<span style="mso-spacerun:
yes">          </span>….<span style="mso-spacerun: yes">       </span>…………….<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Ed ecco la
routine che esegue tutto questo:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>; GetAPI &amp;
GetAPIs <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>;<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>; Queste
procedure sono divise in due blocchi: GetAPI ricava il nome di una API, mentre
GetAPIs<span style="mso-spacerun: yes">  </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>; ricava gli indirizzi
di tutte le API che vogliamo.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>GetAPI<span style="mso-spacerun:
yes">         </span>proc<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>I parametri sono
I seguenti:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes">                                  </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>INPUT<span style="mso-spacerun: yes">    
</span>- ESI : puntatore al nome dell’API <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>OUTPUT - EAX : indirizzo API<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>mov<span style="mso-spacerun:
yes">     </span>edx,esi<span style="mso-spacerun:
yes">                         </span>; Salvo il ptr al nome API<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>@_1:<span style="mso-spacerun: yes">  
</span>cmp<span style="mso-spacerun: yes">     </span>byte ptr [esi],0<span
style="mso-spacerun: yes">                </span>; carattere Null-terminated ?<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>jz<span style="mso-spacerun:
yes">      </span>@_2<span style="mso-spacerun:
yes">                             </span>; Si, prendiamo<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>inc<span style="mso-spacerun:
yes">     </span>esi<span style="mso-spacerun:
yes">                             </span>; No, continuiamo a cercare<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>jmp<span style="mso-spacerun: yes">  
</span><span style="mso-spacerun: yes">  </span>@_1<span style="mso-spacerun:
yes">                             </span>; <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>@_2:<span style="mso-spacerun: yes">  
</span>inc<span style="mso-spacerun: yes">     </span>esi<span
style="mso-spacerun: yes">                             </span>; <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>sub<span style="mso-spacerun:
yes">     </span>esi,edx<span style="mso-spacerun:
yes">                         </span>; ESI = misura nome API <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>mov<span style="mso-spacerun:
yes">     </span>ecx,esi<span style="mso-spacerun:
yes">                         </span>; ECX = ESI <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Abbiamo in ESI il
puntatore al nome dell’API. Immaginiamo di cercare
&quot;FindFirstFileA&quot;:<span style="mso-spacerun:
yes">                                            </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>FFFA<span style="mso-spacerun:
yes">         </span>db<span style="mso-spacerun: yes">  
</span>&quot;FindFirstFileA&quot;,0<span style="mso-spacerun:
yes">                                     </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun:
yes">                           </span></span><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>^ il puntatore è
qui<span style="mso-spacerun: yes">                                   </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>Abbiamo bisogno di mantenere questo puntatore
a sapere la misura del nome dell’API, così preserviamo<span
style="mso-spacerun: yes">  </span>l’iniziale puntatore al nome dell’ API in un
registro come EDX (che non useremo). Quindi incrementiamo il puntatore in ESI
fino a che [ESI] = 0.<span style="mso-spacerun: yes">  </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>FFFA<span style="mso-spacerun:
yes">         </span>db<span style="mso-spacerun: yes">  
</span>&quot;FindFirstFileA&quot;,0<span style="mso-spacerun:
yes">                                     </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun:
yes">                                                   </span></span><span
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC'>^ il puntatore ora è qui<span style="mso-spacerun:
yes">                </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Dopodichè
sottraiamo il vecchio puntatore al nuovo puntatore ottenendo la misura in caratteri
del nome della API (la misura ci servirà successivamente) e lo salviamo in ECX,
(altro registro che non useremo).<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>xor<span style="mso-spacerun:
yes">     </span>eax,eax<span style="mso-spacerun:
yes">                         </span>; EAX = 0<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>mov<span style="mso-spacerun:
yes">     </span>word ptr [ebp+Counter],ax<span style="mso-spacerun:
yes">       </span>; contatore azzerato<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'>mov<span style="mso-spacerun: yes">    
</span>esi,[ebp+kernel]<span style="mso-spacerun: yes">                </span>;
ricavo kernel's PE head. offset<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFCC'>add<span style="mso-spacerun: yes">     </span>esi,3Ch<span
style="mso-spacerun: yes">                         </span>; ‘PE’ offset<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>lodsw<span style="mso-spacerun:
yes">                                   </span>; da ESI in AX<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>add<span style="mso-spacerun:
yes">     </span>eax,[ebp+kernel]<span style="mso-spacerun:
yes">                </span>; Normalizziamo ‘PE’ offset<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>mov<span style="mso-spacerun:
yes">     </span>esi,[eax+78h]<span style="mso-spacerun:
yes">                   </span>; ricavo RVA della Export Table<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>add<span style="mso-spacerun:
yes">     </span>esi,[ebp+kernel]<span style="mso-spacerun:
yes">                </span>; Ptr a indirizzo RVA Address Table<span
style="mso-spacerun: yes">                             </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>add<span style="mso-spacerun:
yes">     </span>esi,1Ch<span style="mso-spacerun: yes">                   
</span><span style="mso-spacerun: yes">     </span>; saltiamo i dati della
struttura<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Ricordiamo che
l’istruzione lodsw trasferisce in AX la parola indirizzata da ESI, mentre lodsd
(più sotto) carica una doppia parola in EAX. Prima di tutto puliamo EAX, e
azzeriamo la variabile contatore per non incorrere in errori. Ricordate
l’offset 3Ch di un PE file (contando dall’image base, MZ mark) ?. Noi stiamo
lavorando sulla base dell’header del KERNEL32 PE; dato che esso è<span
style="mso-spacerun: yes">  </span>un RVA, lo normalizziamo ed così facendo
otteniamo l’offset dell’header PE. Ciò che dobbiamo fare a questo punto è
ricavare l’indirizzo deòòa Export Table address (in PE Header + 78h),<span
style="mso-spacerun: yes">  </span>e l’indirizzo RVA della Address Table.<span
style="mso-spacerun: yes">                                        </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'>lodsd<span style="mso-spacerun:
yes">                                   </span>; EAX = RVA Address Table <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span><span
style="mso-spacerun: yes">       </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'>add<span
style="mso-spacerun: yes">     </span>eax,[ebp+kernel]<span
style="mso-spacerun: yes">                </span>; Normalizziamo<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'>mov<span style="mso-spacerun: yes">     </span>dword
ptr [ebp+AddressTableVA],eax ; Store it in VA form<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>lodsd<span style="mso-spacerun: yes">                                  
</span>; EAX = RVA Name Ptrz Table <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFCC'>add<span style="mso-spacerun: yes">    
</span>eax,[ebp+kernel]<span style="mso-spacerun: yes">          </span><span
style="mso-spacerun: yes">      </span>; Normalizziamo<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'>push<span style="mso-spacerun: yes">   
</span>eax<span style="mso-spacerun: yes">                             </span>;
mov [ebp+NameTableVA],eax<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>lodsd<span style="mso-spacerun: yes">                                  
</span>; EAX = RVA Ordinal Table <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFCC'>add<span style="mso-spacerun: yes">    
</span>eax,[ebp+kernel]<span style="mso-spacerun: yes">                </span>;
Normalizziamo<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>mov<span style="mso-spacerun:
yes">     </span>dword ptr [ebp+OrdinalTableVA],eax ; salvo in forma di VA <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>pop<span style="mso-spacerun:
yes">     </span>esi<span style="mso-spacerun:
yes">                             </span>; ESI = VA Name Ptrz Table<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Se ricordate, noi
abbiamo in ESI il puntatore<span style="mso-spacerun: yes">  </span>al RVA
dell’ Address Table RVA, così per ricavare tale indirizzo eseguiamo un
LODSD,<span style="mso-spacerun: yes">  </span>che inserisce la DWORD locata da
ESI<span style="mso-spacerun: yes">  </span>nell’accumulatore, che è EAX. dato
che questo è un RVA, dobbiamo normalizzarlo per ottenere il corrispettivo VA<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>Matt Pietrek dice riguardo a questo
campo: &quot;This field is an RVA and points to an array of function addresses.
The function addresses are the entry points (RVA) for each exported function in
this module&quot;.<span style="mso-spacerun:
yes">                                                         </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Naturalmente noi
salviamo tale valore in una variabile.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>Dopodiché ricaviamo<span
style="mso-spacerun: yes">  </span>la Name Pointers Table, della quale Matt
Pietrek dice: &quot;This field is an RVA and points to an array of string
pointers. The<span style="mso-spacerun: yes">  </span>strings are the names of
the exported functions in this module&quot;.<span style="mso-spacerun:
yes">         </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Ma non lo salvo
in una variabile, bensì nello stack, dato che lo useremo presto.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>Finalmente<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'>Matt Pietrek descrive così:: &quot;This
field is an RVA and points to an array of WORDs. The WORDs are the<span
style="mso-spacerun: yes">   </span>export ordinals of all the exported
functions in this module&quot;.<span style="mso-spacerun: yes">          
</span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span></span><span
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC'>Ed è quello che abbiamo fatto.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>@_3:<span style="mso-spacerun: yes">  
</span>push <span style="mso-spacerun: yes">   </span>esi<span
style="mso-spacerun: yes">                             </span>; Salvo ESI per
l8r restore<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>lodsd<span style="mso-spacerun:
yes">                                   </span>; ricavo valore ptr ESI in EAX<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>add<span style="mso-spacerun:
yes">     </span>eax,[ebp+kernel]<span style="mso-spacerun:
yes">                </span>; Normalizziamo<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>mov<span style="mso-spacerun:
yes">     </span>esi,eax<span style="mso-spacerun:
yes">                         </span>; ESI = VA del nome API<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>mov<span style="mso-spacerun:
yes">     </span>edi,edx<span style="mso-spacerun:
yes">                         </span>; EDI = ptr all’API<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>push<span style="mso-spacerun:
yes">    </span>ecx<span style="mso-spacerun: yes">                            
</span>; ECX = misura API <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'>cld<span style="mso-spacerun:
yes">                                     </span>; Clear direction flag<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFCC'>rep<span style="mso-spacerun: yes">     </span>cmpsb<span
style="mso-spacerun: yes">      </span><span style="mso-spacerun:
yes">                     </span>; Confronto i nomi API <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>pop<span style="mso-spacerun:
yes">     </span>ecx<span style="mso-spacerun:
yes">                             </span>; Restore ECX<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>jz<span style="mso-spacerun:
yes">      </span>@_4<span style="mso-spacerun:
yes">                             </span>; Jump se I nomi sono uguali<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>pop<span style="mso-spacerun:
yes">     </span>esi<span style="mso-spacerun:
yes">                             </span>; Restore ESI<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>add<span style="mso-spacerun:
yes">     </span>esi,4<span style="mso-spacerun:
yes">                           </span>; prendo il pross. valore dell’array<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>inc<span style="mso-spacerun:
yes">     </span>word ptr [ebp+Counter]<span style="mso-spacerun:
yes">          </span>; Incremento contatore<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>jmp<span style="mso-spacerun:
yes">     </span>@_3<span style="mso-spacerun:
yes">                             </span>; vai ancora<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Prima di tutto
mettiamo ESI<span style="mso-spacerun: yes">  </span>nello stack (dato che sarà
cambiato dall’istruzione CMPSB) per ripristinarlo più tardi. Poi prendiamo la
DWORD puntata da ESI (Name Pointerz Table) e la mettiamo nell’accumulatre
(EAX), attraverso l’istruzione LODSD. Normalizziamo aggiungendo il kernel base
address.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Ora noi abbiamo
in EAX un puntatore al nome di una API, ma no sappiamo ancora di quale API si
tratta. Per esempio EAX potrebbe puntare a qualcosa come
&quot;CreateProcessA&quot; ma tale PAI non ci interessa. Allora confrontiamo
quella stringa con quella che noi cerchiamo (puntata ora da EDX) con CMPSB.
Così prepariamo i suoi parametri: in ESI mettiamo il puntatore all’inizio
dell’API nella Name Pointers Table, e in EDI mettiamo il puntatore all’API
cercata. In ECX mettiamo la misura della stringa, quindi confrontiamo le due
stringhe byte per byte. Se esse sono uguali viene settato il flag zero, ed
effettuiamo un jump alla routine che ci fornirà l’indirizzo di quella API. Se
falliamo ripristiniamo ESI, e aggiungiamo ad esso la misura di una DWORD per
andare a puntare al prossimo valore nella Name Pointers Table array.
Incrementiamo il contatore e continuiamo a cercare.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>@_4:<span style="mso-spacerun: yes">  
</span>pop<span style="mso-spacerun: yes">     </span>esi<span
style="mso-spacerun: yes">                             </span>; evitando
mondezza nello stack<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>movzx<span style="mso-spacerun:
yes">   </span>eax,word ptr [ebp+Counter]<span style="mso-spacerun: yes">     
</span>; mettiamo il contatore in AX <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>shl<span style="mso-spacerun:
yes">     </span>eax,1<span style="mso-spacerun:
yes">                           </span>; EAX = AX * 2<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>add<span style="mso-spacerun:
yes">     </span>eax,dword ptr [ebp+OrdinalTableVA] ; Normalizziamo <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>xor<span style="mso-spacerun:
yes">     </span>esi,esi<span style="mso-spacerun:
yes">                         </span>; pulisce ESI<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>xchg<span style="mso-spacerun:
yes">    </span>eax,esi<span style="mso-spacerun: yes">                        
</span>; EAX = 0, ESI = ptr to Ord<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>lodsw<span style="mso-spacerun:
yes">                                   </span>; metto Ordinale in AX<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>shl<span style="mso-spacerun:
yes">     </span>eax,2<span style="mso-spacerun:
yes">                           </span>; EAX = AX * 4<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>add<span style="mso-spacerun:
yes">     </span>eax,dword ptr [ebp+AddressTableVA] ; Normalizziamo<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>mov<span style="mso-spacerun:
yes">     </span>esi,eax<span style="mso-spacerun: yes">                </span><span
style="mso-spacerun: yes">         </span>; ESI = ptr all’indirizzo RVA<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>lodsd<span style="mso-spacerun:
yes">                                   </span>; EAX = indirizzo RVA<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>add<span style="mso-spacerun:
yes">     </span>eax,[ebp+kernel]<span style="mso-spacerun:
yes">                </span>; Normaliziamo<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>ret<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Il pop è
semplicemente per pulire lo stack, così non sporchiamo il nome dell’API. MOVZX
(move with aero extend: sposta un operando a 8 o a 16 bit in un registro a 16 o
32 bit, inserendo una serie di 0 nella metà superiore della destinazione) Ha
l’effetto di muovere nella porzione bassa di EAX il valore del contatore (che è
una WORD) e azzerare la parte alta del registro. Noi lo moltiplichiamo per 2,
ottenendo il numero che occupa in tabella (l’array dove cerchiamo è un array di
WORD). <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Ora aggiungiamo
ad esso l’inizio dell’inizio dell’array da cui vogliamo iniziare la ricerca, e
in EAX<span style="mso-spacerun: yes">  </span>abbiamo il puntatore
all’ordinale dell’API che vogliamo. Così mettiamo EAX in ESI per usare quel
puntatore paer ricavare il valore puntato che è l’Ordinale in EAX, con un
semplice LODSW. In questo modo abbiamo<span style="mso-spacerun: yes"> 
</span>l’Ordinal, ma noi vogliamo l’ EntryPoint del codice dell’API, cos’
moltiplichiamo l’ordinale (che contiene la posizione dell’EntryPoint che l’API
cercata occupa nella Address Table) per 4, dato che è una DWORD, e così facendo
otteniamo un valore RVA, relativo cioè al RVA della AddressTable.
Normalizziamo, così abbiamo in EAX il puntatore al valore della EntryPoint
della API nella Address Table.Mettiamo EAX in ESI, e ricaviamo il valore
puntato in EAX. Così avremo in EAX l’EntryPoint (RVA) dell’API cercata.
L’ultima cosa da fare ora è normalizzare tale indirizzo con l’image base di
KERNEL32.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Ed ecco
l’indirizzo dell’API cercata in<span style="mso-spacerun: yes">  </span>EAX<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=DE style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:DE'>GetAPI<span style="mso-spacerun: yes">        
</span>endp<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span lang=DE
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:DE'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=DE
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:DE'>------------------------------------------------------------------------------------------------------------------<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span lang=DE
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:DE'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=DE style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:DE'><span style="mso-spacerun: yes"> </span>GetAPIs<span
style="mso-spacerun: yes">        </span>proc<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span lang=DE
style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:"Times New Roman";
mso-fareast-font-family:"MS Mincho";mso-bidi-font-family:"Courier New";
color:#CCFFCC;mso-ansi-language:DE'><span style="mso-spacerun: yes"> </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Questo è il
codice per ricavare TUTTE le APIs utilizzando la<span style="mso-spacerun:
yes">  </span>procedura descritta più sopra. i parametri sono:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun:
yes">                                                                       
</span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>INPUT<span style="mso-spacerun: yes"> 
</span>- ESI : Puntatore alla prima API cercata (ASCIIz) – è l’indirizzo
dell’array di stringhe <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes">                          </span>contenente i nomi
delle API cercate;<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes">                 </span>EDI : Puntatore alla
variabile che conterrà la prima API – indirizzo dell’array in cui salveremo <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes">                          </span>gli indirizzi delle
API <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>OUTPUT – nulla.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>La struttura per
ricavare i valori è del tipo:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'>ESI
punta a<span style="mso-spacerun: yes">   </span>db<span style="mso-spacerun:
yes">         </span>&quot;FindFirstFileA&quot;,0<span style="mso-spacerun:
yes">                          </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">              </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'>db<span style="mso-spacerun: yes">        
</span>&quot;FindNextFileA&quot;,0<span style="mso-spacerun:
yes">                           </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">             
</span>db<span style="mso-spacerun: yes">        
</span>&quot;CloseHandle&quot;,0<span style="mso-spacerun: yes">     </span><span
style="mso-spacerun: yes">                        </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">             </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFCC'>[...]<span style="mso-spacerun: yes">          </span>[...]<span
style="mso-spacerun: yes">                                                 
</span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">                                        </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">              </span>db<span style="mso-spacerun:
yes">    </span>0BBh ; Marcatore della fine di questo array<span
style="mso-spacerun: yes">                                           </span><span
style="mso-spacerun: yes">                              </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'>EDI
punta a<span style="mso-spacerun: yes">   </span>dd<span style="mso-spacerun:
yes">         </span>00000000h ; Futuro indirizzo di FindFirstFileA <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">              </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'>dd<span style="mso-spacerun: yes">        
</span>00000000h ;<span style="mso-spacerun: yes">     </span>“<span
style="mso-spacerun: yes">      </span>“<span style="mso-spacerun: yes">       
</span>FindNextFileA<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">             
</span>dd<span style="mso-spacerun: yes">         </span>00000000h ;<span
style="mso-spacerun: yes">     </span>“<span style="mso-spacerun: yes">     
</span>“<span style="mso-spacerun: yes">        </span>CloseHandle<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">           </span><span
style="mso-spacerun: yes">  </span>[...]<span style="mso-spacerun:
yes">          </span>[...]<span style="mso-spacerun:
yes">                                                  </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'>-------------------------------------------------------------------------------------<span
style="mso-spacerun:
yes">                                                                                  
</span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span><o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes"> </span>@@1:<span
style="mso-spacerun: yes">   </span>push<span style="mso-spacerun: yes">   
</span>esi<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>push<span style="mso-spacerun: yes">    </span>edi<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>call<span style="mso-spacerun: yes">    </span>GetAPI<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">       
</span>pop<span style="mso-spacerun: yes">     </span>edi<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:EN-US'><span style="mso-spacerun: yes">        </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFCC'>pop<span style="mso-spacerun: yes">     </span>esi<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span>stosd<span style="mso-spacerun:
yes">       </span>; trasferisce la word da EAX (riornante da GetAPI
all’elemento <o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">                    </span>; della stringa
indirizzato da EDI<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>Salviamo nello
stack i valori prima di chiamare la procedura, dopodiché effettuiamo una call
alla GetAPI. Assumiamo che ESI sia un puntatore al nome della API cercata e EDI
il puntatore alla variabile che conterrà<span style="mso-spacerun: yes"> 
</span>il nome della API<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>@@2:<span style="mso-spacerun: yes">  
</span>cmp<span style="mso-spacerun: yes">     </span>byte ptr [esi],0<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:FR'>jz<span style="mso-spacerun: yes">      </span>@@3<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=FR style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:FR'><span style="mso-spacerun: yes">        </span>inc<span
style="mso-spacerun: yes">     </span>esi<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=FR style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:FR'><span style="mso-spacerun: yes">        </span>jmp<span
style="mso-spacerun: yes">     </span>@@2<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=FR style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:FR'><span style="mso-spacerun: yes"> </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFCC'>@@3:<span style="mso-spacerun: yes">   </span>cmp<span
style="mso-spacerun: yes">     </span>byte ptr [esi+1],0BBh<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes">        </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:FR'>jz<span style="mso-spacerun: yes">      </span>@@4<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=FR style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:FR'><span style="mso-spacerun: yes">        </span>inc<span
style="mso-spacerun: yes">     </span>esi<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=FR style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:FR'><span style="mso-spacerun: yes">        </span>jmp<span
style="mso-spacerun: yes">     </span>@@1<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span lang=FR style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC;
mso-ansi-language:FR'><span style="mso-spacerun: yes"> </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='mso-fareast-font-family:"MS Mincho";
color:#CCFFCC'>@@4:<span style="mso-spacerun: yes">   </span>ret<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><b style='mso-bidi-font-weight:
normal'><span style='mso-fareast-font-family:"MS Mincho";color:#CCFFCC'><span
style="mso-spacerun: yes"> </span>GetAPIs<span style="mso-spacerun:
yes">        </span>endp<o:p></o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
"MS Mincho";mso-bidi-font-family:"Courier New";color:#CCFFCC'>In questa maniera
otteniamo gli indirizzi di tutte le API che vogliamo, a prescindere dalla
versione di Windows.<o:p></o:p></span></p>

</div>

</body>

</html>
